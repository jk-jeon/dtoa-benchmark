<html>
<head>
<script src="http://code.jquery.com/jquery-1.8.2.js"></script>
<script src="http://www.google.com/jsapi?autoload={'modules':[{'name':'visualization','version':'1','packages':['controls', 'charteditor']}]}"></script>
<script src="https://web.archive.org/web/20160324220311/http://jquery-csv.googlecode.com/git/src/jquery.csv.js"></script>
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script>
$(function() {
	google.load("visualization", "1", {packages:["corechart"]});

    var csv = $('#textInput').val();
    var data = $.csv.toArrays(csv, {
        onParseValue: $.csv.hooks.castToScalar
    });

    // Convert data for bar chart (summing all digits)
    var timeData = {};	// type -> table
    var funcRowMap;
    var maxDigit = 0;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
      var digit = data[i][2];
   		var time = data[i][3];
   		if (timeData[type] == null) {
   			timeData[type] = [["Function", "Time (ns)"/*, { role: "style" }*/]];
        if (digit != 0)
   			  funcRowMap = {};
   		}

   		var table = timeData[type];
   		
      if (digit != 0) {
     		if (funcRowMap[func] == null)
     			funcRowMap[func] = table.push([func, 0]) - 1;
     		
     		table[funcRowMap[func]][1] += time;
      }
      else 
        table.push([func, time]);

      maxDigit = Math.max(maxDigit, digit);
    }

    // Compute average
    for (var type in timeData) {
      var table = timeData[type];
      for (var i = 1; i < table.length; i++)
        table[i][1] /= maxDigit;
    }

    // Convert data for drawing line chart per random digit
    var timeDigitData = {}; // type -> table
    var funcColumnMap;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
		  var digit = data[i][2];
   		var time = data[i][3];

      if (digit == 0)
        continue;

   		if (timeDigitData[type] == null) {
   			timeDigitData[type] = [["Digit"]];
   			funcColumnMap = {};
   		}

   		var table = timeDigitData[type];

   		if (funcColumnMap[func] == null)
   			funcColumnMap[func] = table[0].push(func) - 1;

   		var row;
   		for (row = 1; row < table.length; row++)
   			if (table[row][0] == digit)
   				break;

    	if (row == table.length)
    		table.push([digit]);

		table[row][funcColumnMap[func]] = time;
	}

	for (var type in timeData) {
		$("#main").append(
      $("<a>", {name: type}),
      $("<h2>", {style: "padding-top: 70px; margin-top: -70px;"}).append(type)
    );

    $("#section").append($("<li>").append($("<a>", {href: "#" + type}).append(type)));

		drawTable(type, timeData[type]);
		drawBarChart(type, timeData[type]);
    if (timeDigitData[type] != null)
		  drawDigitChart(type, timeDigitData[type]);
	}

	$(".chart").each(function() {
		var chart = $(this);
		var d = $("#downloadDD").clone().css("display", "");
		$('li a', d).each(function() {
	        $(this).click(function() {
	            var svg = chart[0].getElementsByTagName('svg')[0].parentNode.innerHTML;
	            svg=sanitize(svg);
	            $('#imageFilename').val($("#title").html() + "_" + chart.data("filename"));
	            $('#imageGetFormTYPE').val($(this).attr('dltype'));
	            $('#imageGetFormSVG').val(svg);
	            $('#imageGetForm').submit();
	        });
	    });		
		$(this).after(d);
	});

  // Add configurations
  var thisConfig = "unknown_win64_vc2019";
  var configurations = ["corei7920@2.67_cygwin32_gcc4.8","corei7920@2.67_cygwin64_gcc4.8","corei7920@2.67_win32_vc2013","corei7920@2.67_win64_vc2013","unknown_mac32_clang7.0","unknown_mac64_clang7.0","unknown_win64_vc2019"];

  for (var i in configurations) {
    var c = configurations[i];
    $("#configuration").append($("<li>", {class : (c == thisConfig ? "active" : "")}).append($("<a>", {href: c + ".html"}).append(c)));
  }
});

function drawTable(type, timeData) {
	var data = google.visualization.arrayToDataTable(timeData);
    data.addColumn('number', 'Speedup');
    data.sort([{ column: 1, desc: true }]);
    var formatter1 = new google.visualization.NumberFormat({ fractionDigits: 3 });
    formatter1.format(data, 1);

	var div = document.createElement("div");
	div.className = "tablechart";
	$("#main").append(div);
    var table = new google.visualization.Table(div);
    redrawTable(0);
    table.setSelection([{ row: 0, column: null}]);

    function redrawTable(selectedRow) {
        // Compute relative time using the first row as basis
        var basis = data.getValue(selectedRow, 1);
        for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
            data.setValue(rowIndex, 2, basis / data.getValue(rowIndex, 1));

        var formatter = new google.visualization.NumberFormat({suffix: 'x'});
        formatter.format(data, 2); // Apply formatter to second column

        table.draw(data);
    }

    google.visualization.events.addListener(table, 'select',
    function() {
        var selection = table.getSelection();
        if (selection.length > 0) {
            var item = selection[0];
            if (item.row != null)
                redrawTable(item.row);
        }
    });

}

function drawBarChart(type, timeData) {
    var defaultColors = ["#3366cc","#dc3912","#ff9900","#109618","#990099","#0099c6","#dd4477","#66aa00","#b82e2e","#316395","#994499","#22aa99","#aaaa11","#6633cc","#e67300","#8b0707","#651067","#329262","#5574a6","#3b3eac","#b77322","#16d620","#b91383","#f4359e","#9c5935","#a9c413","#2a778d","#668d1c","#bea413","#0c5922","#743411"];

	var data = google.visualization.arrayToDataTable(timeData);
	data.addColumn({ type: "string", role: "style" })
	for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
		data.setValue(rowIndex, 2, defaultColors[rowIndex]);

    data.sort([{ column: 1, desc: true }]);
	var options = { 
		title: type,
		chartArea: {'width': '70%', 'height': '70%'},
		width: 800,
		height: 300,
		legend: { position: "none" },
		hAxis: { title: "Time (ns)" }
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_time");
	$("#main").append(div);
	var chart = new google.visualization.BarChart(div);

	chart.draw(data, options);
}

function drawDigitChart(type, timeDigitData) {
	var data = google.visualization.arrayToDataTable(timeDigitData);

	var options = { 
		title: type,
		chartArea: {'width': '70%', 'height': '80%'},
		hAxis: {
			title: "Digit",
			gridlines: { count: timeDigitData.length - 1 },
			maxAlternation: 1,
			minTextSpacing: 0
		},
		vAxis: {
			title: "Time (ns) in log scale",
			logScale: true,
			minorGridlines: { count: 10 },
      baseline: 0
		},
		width: 800,
		height: 600
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_timedigit");
	$("#main").append(div);
	var chart = new google.visualization.LineChart(div);

	chart.draw(data, options);
}

// http://jsfiddle.net/P6XXM/
function sanitize(svg) {
    svg = svg
        .replace(/\<svg/,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1"')
        .replace(/zIndex="[^"]+"/g, '')
        .replace(/isShadow="[^"]+"/g, '')
        .replace(/symbolName="[^"]+"/g, '')
        .replace(/jQuery[0-9]+="[^"]+"/g, '')
        .replace(/isTracker="[^"]+"/g, '')
        .replace(/url\([^#]+#/g, 'url(#')
        .replace('<svg xmlns:xlink="http://www.w3.org/1999/xlink" ', '<svg ')
        .replace(/ href=/g, ' xlink:href=')
    /*.replace(/preserveAspectRatio="none">/g, 'preserveAspectRatio="none"/>')*/
    /* This fails in IE < 8
    .replace(/([0-9]+)\.([0-9]+)/g, function(s1, s2, s3) { // round off to save weight
    return s2 +'.'+ s3[0];
    })*/

    // IE specific
        .replace(/id=([^" >]+)/g, 'id="$1"')
        .replace(/class=([^" ]+)/g, 'class="$1"')
        .replace(/ transform /g, ' ')
        .replace(/:(path|rect)/g, '$1')
        .replace(/<img ([^>]*)>/gi, '<image $1 />')
        .replace(/<\/image>/g, '') // remove closing tags for images as they'll never have any content
        .replace(/<image ([^>]*)([^\/])>/gi, '<image $1$2 />') // closes image tags for firefox
        .replace(/width=(\d+)/g, 'width="$1"')
        .replace(/height=(\d+)/g, 'height="$1"')
        .replace(/hc-svg-href="/g, 'xlink:href="')
        .replace(/style="([^"]+)"/g, function (s) {
            return s.toLowerCase();
        });

    // IE9 beta bugs with innerHTML. Test again with final IE9.
    svg = svg.replace(/(url\(#highcharts-[0-9]+)&quot;/g, '$1')
        .replace(/&quot;/g, "'");
    if (svg.match(/ xmlns="/g).length == 2) {
        svg = svg.replace(/xmlns="[^"]+"/, '');
    }

    return svg;
}
</script>
<style type="text/css">
@media (min-width: 800px) {
  .container {
    max-width: 800px;
  }
}
textarea {
	font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace;
}
.tablechart {
	width: 700px;
	margin: auto;
	padding-top: 20px;
	padding-bottom: 20px;
}
.chart {
	padding-top: 20px;
	padding-bottom: 20px;
}
body { padding-top: 70px; }
</style>
</head>
<body>
<div class="container">
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://github.com/miloyip/dtoa-benchmark"><span class="glyphicon glyphicon-home"></span> dtoa-benchmark</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Configuration <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="configuration">
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Section <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="section">
          </ul>
        </li>
      </ul>
      <p class="navbar-text navbar-right">Developed by <a href="https://github.com/miloyip" class="navbar-link">Milo Yip</a></p>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
<div class="page-header">
<h1 id="title">unknown_win64_vc2019</h1>
</div>
<div id="main"></div>
<h2>Source CSV</h2>
<textarea id="textInput" class="form-control" rows="5" readonly>
Type,Function,Digit,Time(ns)
randomdigit,doubleconv,1,108.617604
randomdigit,doubleconv,2,123.678565
randomdigit,doubleconv,3,123.405061
randomdigit,doubleconv,4,127.194004
randomdigit,doubleconv,5,134.323345
randomdigit,doubleconv,6,129.845171
randomdigit,doubleconv,7,135.523117
randomdigit,doubleconv,8,134.585909
randomdigit,doubleconv,9,136.241521
randomdigit,doubleconv,10,140.551946
randomdigit,doubleconv,11,145.963681
randomdigit,doubleconv,12,152.093820
randomdigit,doubleconv,13,151.751028
randomdigit,doubleconv,14,160.991821
randomdigit,doubleconv,15,153.720258
randomdigit,doubleconv,16,159.040825
randomdigit,doubleconv,17,169.656431
randomdigit,emyg,1,69.878480
randomdigit,emyg,2,76.048733
randomdigit,emyg,3,80.038247
randomdigit,emyg,4,81.868901
randomdigit,emyg,5,83.717789
randomdigit,emyg,6,89.078470
randomdigit,emyg,7,92.105249
randomdigit,emyg,8,91.882799
randomdigit,emyg,9,98.596413
randomdigit,emyg,10,101.375215
randomdigit,emyg,11,103.647123
randomdigit,emyg,12,103.585129
randomdigit,emyg,13,109.241194
randomdigit,emyg,14,112.895209
randomdigit,emyg,15,115.188997
randomdigit,emyg,16,116.370535
randomdigit,emyg,17,122.044834
randomdigit,floaxie,1,47.407381
randomdigit,floaxie,2,54.478375
randomdigit,floaxie,3,61.629596
randomdigit,floaxie,4,71.249648
randomdigit,floaxie,5,78.721780
randomdigit,floaxie,6,84.647703
randomdigit,floaxie,7,92.174536
randomdigit,floaxie,8,100.277552
randomdigit,floaxie,9,108.537377
randomdigit,floaxie,10,115.320279
randomdigit,floaxie,11,116.633099
randomdigit,floaxie,12,114.740450
randomdigit,floaxie,13,120.334521
randomdigit,floaxie,14,120.680960
randomdigit,floaxie,15,118.602328
randomdigit,floaxie,16,125.140900
randomdigit,floaxie,17,121.603580
randomdigit,fmt,1,161.082989
randomdigit,fmt,2,164.952160
randomdigit,fmt,3,172.818139
randomdigit,fmt,4,176.231471
randomdigit,fmt,5,183.988048
randomdigit,fmt,6,182.190214
randomdigit,fmt,7,183.772891
randomdigit,fmt,8,185.760354
randomdigit,fmt,9,184.881494
randomdigit,fmt,10,190.132773
randomdigit,fmt,11,190.792830
randomdigit,fmt,12,196.233739
randomdigit,fmt,13,198.516587
randomdigit,fmt,14,197.222000
randomdigit,fmt,15,203.381313
randomdigit,fmt,16,212.341308
randomdigit,fmt,17,207.881368
randomdigit,fpconv,1,139.815308
randomdigit,fpconv,2,148.789890
randomdigit,fpconv,3,160.280710
randomdigit,fpconv,4,183.575968
randomdigit,fpconv,5,177.981897
randomdigit,fpconv,6,181.639559
randomdigit,fpconv,7,184.633517
randomdigit,fpconv,8,192.630778
randomdigit,fpconv,9,194.862571
randomdigit,fpconv,10,198.334250
randomdigit,fpconv,11,194.023825
randomdigit,fpconv,12,193.695621
randomdigit,fpconv,13,194.249922
randomdigit,fpconv,14,206.553961
randomdigit,fpconv,15,200.226899
randomdigit,fpconv,16,207.739146
randomdigit,fpconv,17,209.580740
randomdigit,grisu2,1,131.402321
randomdigit,grisu2,2,139.570978
randomdigit,grisu2,3,139.410522
randomdigit,grisu2,4,138.841633
randomdigit,grisu2,5,142.152857
randomdigit,grisu2,6,141.861119
randomdigit,grisu2,7,148.414278
randomdigit,grisu2,8,148.308523
randomdigit,grisu2,9,152.589774
randomdigit,grisu2,10,154.157864
randomdigit,grisu2,11,152.950800
randomdigit,grisu2,12,162.848002
randomdigit,grisu2,13,164.372332
randomdigit,grisu2,14,167.154780
randomdigit,grisu2,15,170.239907
randomdigit,grisu2,16,174.061671
randomdigit,grisu2,17,181.526510
randomdigit,jkj,1,38.830292
randomdigit,jkj,2,42.090461
randomdigit,jkj,3,43.385047
randomdigit,jkj,4,45.795531
randomdigit,jkj,5,45.733536
randomdigit,jkj,6,45.675189
randomdigit,jkj,7,48.060145
randomdigit,jkj,8,47.374561
randomdigit,jkj,9,46.761912
randomdigit,jkj,10,46.896840
randomdigit,jkj,11,48.184133
randomdigit,jkj,12,47.195872
randomdigit,jkj,13,48.330002
randomdigit,jkj,14,49.890799
randomdigit,jkj,15,51.477123
randomdigit,jkj,16,51.108804
randomdigit,jkj,17,54.795640
randomdigit,milo,1,64.474039
randomdigit,milo,2,70.516657
randomdigit,milo,3,73.470501
randomdigit,milo,4,75.118819
randomdigit,milo,5,76.384232
randomdigit,milo,6,79.892378
randomdigit,milo,7,83.564627
randomdigit,milo,8,85.220238
randomdigit,milo,9,89.931803
randomdigit,milo,10,85.118130
randomdigit,milo,11,89.271746
randomdigit,milo,12,93.341487
randomdigit,milo,13,93.334194
randomdigit,milo,14,95.679036
randomdigit,milo,15,101.349688
randomdigit,milo,16,100.901141
randomdigit,milo,17,105.207920
randomdigit,milo_only_Grisu2,1,43.505389
randomdigit,milo_only_Grisu2,2,46.710858
randomdigit,milo_only_Grisu2,3,49.449546
randomdigit,milo_only_Grisu2,4,52.279402
randomdigit,milo_only_Grisu2,5,54.926922
randomdigit,milo_only_Grisu2,6,57.742191
randomdigit,milo_only_Grisu2,7,63.741048
randomdigit,milo_only_Grisu2,8,65.932727
randomdigit,milo_only_Grisu2,9,68.394265
randomdigit,milo_only_Grisu2,10,71.421044
randomdigit,milo_only_Grisu2,11,74.415002
randomdigit,milo_only_Grisu2,12,76.741610
randomdigit,milo_only_Grisu2,13,81.205198
randomdigit,milo_only_Grisu2,14,85.439042
randomdigit,milo_only_Grisu2,15,86.802915
randomdigit,milo_only_Grisu2,16,84.986848
randomdigit,milo_only_Grisu2,17,87.616134
randomdigit,null,1,1.393048
randomdigit,null,2,1.393048
randomdigit,null,3,1.389401
randomdigit,null,4,1.393048
randomdigit,null,5,1.393048
randomdigit,null,6,1.389401
randomdigit,null,7,1.389401
randomdigit,null,8,1.393048
randomdigit,null,9,1.393048
randomdigit,null,10,1.393048
randomdigit,null,11,1.393048
randomdigit,null,12,1.393048
randomdigit,null,13,1.393048
randomdigit,null,14,1.393048
randomdigit,null,15,1.393048
randomdigit,null,16,1.393048
randomdigit,null,17,1.393048
randomdigit,to_chars,1,87.889639
randomdigit,to_chars,2,88.137616
randomdigit,to_chars,3,92.025021
randomdigit,to_chars,4,83.666735
randomdigit,to_chars,5,79.859557
randomdigit,to_chars,6,77.886681
randomdigit,to_chars,7,75.983092
randomdigit,to_chars,8,73.824233
randomdigit,to_chars,9,71.741955
randomdigit,to_chars,10,73.656484
randomdigit,to_chars,11,65.232557
randomdigit,to_chars,12,63.587885
randomdigit,to_chars,13,62.001562
randomdigit,to_chars,14,60.586634
randomdigit,to_chars,15,59.390509
randomdigit,to_chars,16,57.884413
randomdigit,to_chars,17,60.484525
</textarea>
</div>
<div class="row" id="downloadDD" style="display: none">
<div class="btn-group pull-right" >
    <button class="btn dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-picture"></span></button>
    <ul class="dropdown-menu">
        <li><a tabindex="-1" href="#" dltype="image/jpeg">JPEG</a></li>
        <li><a tabindex="-1" href="#" dltype="image/png">PNG</a></li>
        <li><a tabindex="-1" href="#" dltype="application/pdf">PDF</a></li>
        <li><a tabindex="-1" href="#" dltype="image/svg+xml">SVG</a></li>
    </ul>
</div>
</div>
<form method="post" action="http://export.highcharts.com/" id="imageGetForm">
    <input type="hidden" name="filename" id="imageFilename" value="" />
    <input type="hidden" name="type" id="imageGetFormTYPE" value="" />
    <input type="hidden" name="width" value="900" />
    <input type="hidden" name="svg" value="" id="imageGetFormSVG" />
</form>
</div>
</body>
</html>