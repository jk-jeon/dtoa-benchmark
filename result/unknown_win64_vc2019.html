<html>
<head>
<script src="http://code.jquery.com/jquery-1.8.2.js"></script>
<script src="http://www.google.com/jsapi?autoload={'modules':[{'name':'visualization','version':'1','packages':['controls', 'charteditor']}]}"></script>
<script src="https://web.archive.org/web/20160324220311/http://jquery-csv.googlecode.com/git/src/jquery.csv.js"></script>
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script>
$(function() {
	google.load("visualization", "1", {packages:["corechart"]});

    var csv = $('#textInput').val();
    var data = $.csv.toArrays(csv, {
        onParseValue: $.csv.hooks.castToScalar
    });

    // Convert data for bar chart (summing all digits)
    var timeData = {};	// type -> table
    var funcRowMap;
    var maxDigit = 0;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
      var digit = data[i][2];
   		var time = data[i][3];
   		if (timeData[type] == null) {
   			timeData[type] = [["Function", "Time (ns)"/*, { role: "style" }*/]];
        if (digit != 0)
   			  funcRowMap = {};
   		}

   		var table = timeData[type];
   		
      if (digit != 0) {
     		if (funcRowMap[func] == null)
     			funcRowMap[func] = table.push([func, 0]) - 1;
     		
     		table[funcRowMap[func]][1] += time;
      }
      else 
        table.push([func, time]);

      maxDigit = Math.max(maxDigit, digit);
    }

    // Compute average
    for (var type in timeData) {
      var table = timeData[type];
      for (var i = 1; i < table.length; i++)
        table[i][1] /= maxDigit;
    }

    // Convert data for drawing line chart per random digit
    var timeDigitData = {}; // type -> table
    var funcColumnMap;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
		  var digit = data[i][2];
   		var time = data[i][3];

      if (digit == 0)
        continue;

   		if (timeDigitData[type] == null) {
   			timeDigitData[type] = [["Digit"]];
   			funcColumnMap = {};
   		}

   		var table = timeDigitData[type];

   		if (funcColumnMap[func] == null)
   			funcColumnMap[func] = table[0].push(func) - 1;

   		var row;
   		for (row = 1; row < table.length; row++)
   			if (table[row][0] == digit)
   				break;

    	if (row == table.length)
    		table.push([digit]);

		table[row][funcColumnMap[func]] = time;
	}

	for (var type in timeData) {
		$("#main").append(
      $("<a>", {name: type}),
      $("<h2>", {style: "padding-top: 70px; margin-top: -70px;"}).append(type)
    );

    $("#section").append($("<li>").append($("<a>", {href: "#" + type}).append(type)));

		drawTable(type, timeData[type]);
		drawBarChart(type, timeData[type]);
    if (timeDigitData[type] != null)
		  drawDigitChart(type, timeDigitData[type]);
	}

	$(".chart").each(function() {
		var chart = $(this);
		var d = $("#downloadDD").clone().css("display", "");
		$('li a', d).each(function() {
	        $(this).click(function() {
	            var svg = chart[0].getElementsByTagName('svg')[0].parentNode.innerHTML;
	            svg=sanitize(svg);
	            $('#imageFilename').val($("#title").html() + "_" + chart.data("filename"));
	            $('#imageGetFormTYPE').val($(this).attr('dltype'));
	            $('#imageGetFormSVG').val(svg);
	            $('#imageGetForm').submit();
	        });
	    });		
		$(this).after(d);
	});

  // Add configurations
  var thisConfig = "unknown_win64_vc2019";
  var configurations = ["corei7920@2.67_cygwin32_gcc4.8","corei7920@2.67_cygwin64_gcc4.8","corei7920@2.67_win32_vc2013","corei7920@2.67_win64_vc2013","unknown_mac32_clang7.0","unknown_mac64_clang7.0","unknown_win64_vc2019"];

  for (var i in configurations) {
    var c = configurations[i];
    $("#configuration").append($("<li>", {class : (c == thisConfig ? "active" : "")}).append($("<a>", {href: c + ".html"}).append(c)));
  }
});

function drawTable(type, timeData) {
	var data = google.visualization.arrayToDataTable(timeData);
    data.addColumn('number', 'Speedup');
    data.sort([{ column: 1, desc: true }]);
    var formatter1 = new google.visualization.NumberFormat({ fractionDigits: 3 });
    formatter1.format(data, 1);

	var div = document.createElement("div");
	div.className = "tablechart";
	$("#main").append(div);
    var table = new google.visualization.Table(div);
    redrawTable(0);
    table.setSelection([{ row: 0, column: null}]);

    function redrawTable(selectedRow) {
        // Compute relative time using the first row as basis
        var basis = data.getValue(selectedRow, 1);
        for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
            data.setValue(rowIndex, 2, basis / data.getValue(rowIndex, 1));

        var formatter = new google.visualization.NumberFormat({suffix: 'x'});
        formatter.format(data, 2); // Apply formatter to second column

        table.draw(data);
    }

    google.visualization.events.addListener(table, 'select',
    function() {
        var selection = table.getSelection();
        if (selection.length > 0) {
            var item = selection[0];
            if (item.row != null)
                redrawTable(item.row);
        }
    });

}

function drawBarChart(type, timeData) {
    var defaultColors = ["#3366cc","#dc3912","#ff9900","#109618","#990099","#0099c6","#dd4477","#66aa00","#b82e2e","#316395","#994499","#22aa99","#aaaa11","#6633cc","#e67300","#8b0707","#651067","#329262","#5574a6","#3b3eac","#b77322","#16d620","#b91383","#f4359e","#9c5935","#a9c413","#2a778d","#668d1c","#bea413","#0c5922","#743411"];

	var data = google.visualization.arrayToDataTable(timeData);
	data.addColumn({ type: "string", role: "style" })
	for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
		data.setValue(rowIndex, 2, defaultColors[rowIndex]);

    data.sort([{ column: 1, desc: true }]);
	var options = { 
		title: type,
		chartArea: {'width': '70%', 'height': '70%'},
		width: 800,
		height: 300,
		legend: { position: "none" },
		hAxis: { title: "Time (ns)" }
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_time");
	$("#main").append(div);
	var chart = new google.visualization.BarChart(div);

	chart.draw(data, options);
}

function drawDigitChart(type, timeDigitData) {
	var data = google.visualization.arrayToDataTable(timeDigitData);

	var options = { 
		title: type,
		chartArea: {'width': '70%', 'height': '80%'},
		hAxis: {
			title: "Digit",
			gridlines: { count: timeDigitData.length - 1 },
			maxAlternation: 1,
			minTextSpacing: 0
		},
		vAxis: {
			title: "Time (ns) in log scale",
			logScale: true,
			minorGridlines: { count: 10 },
      baseline: 0
		},
		width: 800,
		height: 600
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_timedigit");
	$("#main").append(div);
	var chart = new google.visualization.LineChart(div);

	chart.draw(data, options);
}

// http://jsfiddle.net/P6XXM/
function sanitize(svg) {
    svg = svg
        .replace(/\<svg/,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1"')
        .replace(/zIndex="[^"]+"/g, '')
        .replace(/isShadow="[^"]+"/g, '')
        .replace(/symbolName="[^"]+"/g, '')
        .replace(/jQuery[0-9]+="[^"]+"/g, '')
        .replace(/isTracker="[^"]+"/g, '')
        .replace(/url\([^#]+#/g, 'url(#')
        .replace('<svg xmlns:xlink="http://www.w3.org/1999/xlink" ', '<svg ')
        .replace(/ href=/g, ' xlink:href=')
    /*.replace(/preserveAspectRatio="none">/g, 'preserveAspectRatio="none"/>')*/
    /* This fails in IE < 8
    .replace(/([0-9]+)\.([0-9]+)/g, function(s1, s2, s3) { // round off to save weight
    return s2 +'.'+ s3[0];
    })*/

    // IE specific
        .replace(/id=([^" >]+)/g, 'id="$1"')
        .replace(/class=([^" ]+)/g, 'class="$1"')
        .replace(/ transform /g, ' ')
        .replace(/:(path|rect)/g, '$1')
        .replace(/<img ([^>]*)>/gi, '<image $1 />')
        .replace(/<\/image>/g, '') // remove closing tags for images as they'll never have any content
        .replace(/<image ([^>]*)([^\/])>/gi, '<image $1$2 />') // closes image tags for firefox
        .replace(/width=(\d+)/g, 'width="$1"')
        .replace(/height=(\d+)/g, 'height="$1"')
        .replace(/hc-svg-href="/g, 'xlink:href="')
        .replace(/style="([^"]+)"/g, function (s) {
            return s.toLowerCase();
        });

    // IE9 beta bugs with innerHTML. Test again with final IE9.
    svg = svg.replace(/(url\(#highcharts-[0-9]+)&quot;/g, '$1')
        .replace(/&quot;/g, "'");
    if (svg.match(/ xmlns="/g).length == 2) {
        svg = svg.replace(/xmlns="[^"]+"/, '');
    }

    return svg;
}
</script>
<style type="text/css">
@media (min-width: 800px) {
  .container {
    max-width: 800px;
  }
}
textarea {
	font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace;
}
.tablechart {
	width: 700px;
	margin: auto;
	padding-top: 20px;
	padding-bottom: 20px;
}
.chart {
	padding-top: 20px;
	padding-bottom: 20px;
}
body { padding-top: 70px; }
</style>
</head>
<body>
<div class="container">
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://github.com/miloyip/dtoa-benchmark"><span class="glyphicon glyphicon-home"></span> dtoa-benchmark</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Configuration <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="configuration">
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Section <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="section">
          </ul>
        </li>
      </ul>
      <p class="navbar-text navbar-right">Developed by <a href="https://github.com/miloyip" class="navbar-link">Milo Yip</a></p>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
<div class="page-header">
<h1 id="title">unknown_win64_vc2019</h1>
</div>
<div id="main"></div>
<h2>Source CSV</h2>
<textarea id="textInput" class="form-control" rows="5" readonly>
Type,Function,Digit,Time(ns)
randomdigit,doubleconv,1,110.021753
randomdigit,doubleconv,2,114.470760
randomdigit,doubleconv,3,119.539710
randomdigit,doubleconv,4,119.284439
randomdigit,doubleconv,5,123.295839
randomdigit,doubleconv,6,127.489575
randomdigit,doubleconv,7,128.364789
randomdigit,doubleconv,8,131.865647
randomdigit,doubleconv,9,131.610376
randomdigit,doubleconv,10,134.673627
randomdigit,doubleconv,11,131.902115
randomdigit,doubleconv,12,140.581325
randomdigit,doubleconv,13,137.773345
randomdigit,doubleconv,14,149.953413
randomdigit,doubleconv,15,148.640591
randomdigit,doubleconv,16,153.964813
randomdigit,doubleconv,17,160.674790
randomdigit,emyg,1,52.950476
randomdigit,emyg,2,60.061593
randomdigit,emyg,3,63.489517
randomdigit,emyg,4,66.880973
randomdigit,emyg,5,71.220578
randomdigit,emyg,6,76.873005
randomdigit,emyg,7,79.680984
randomdigit,emyg,8,78.951639
randomdigit,emyg,9,81.978422
randomdigit,emyg,10,90.402362
randomdigit,emyg,11,90.292960
randomdigit,emyg,12,94.851369
randomdigit,emyg,13,99.519179
randomdigit,emyg,14,102.691832
randomdigit,emyg,15,103.129439
randomdigit,emyg,16,106.265624
randomdigit,emyg,17,110.568762
randomdigit,fmt,1,148.713526
randomdigit,fmt,2,158.960829
randomdigit,fmt,3,160.127781
randomdigit,fmt,4,162.753425
randomdigit,fmt,5,165.816675
randomdigit,fmt,6,168.369384
randomdigit,fmt,7,171.542037
randomdigit,fmt,8,179.710705
randomdigit,fmt,9,175.845175
randomdigit,fmt,10,179.236631
randomdigit,fmt,11,181.169396
randomdigit,fmt,12,190.796755
randomdigit,fmt,13,187.441766
randomdigit,fmt,14,191.781371
randomdigit,fmt,15,193.130660
randomdigit,fmt,16,195.501033
randomdigit,fmt,17,200.642918
randomdigit,fpconv,1,119.831448
randomdigit,fpconv,2,129.531742
randomdigit,fpconv,3,140.836596
randomdigit,fpconv,4,147.473639
randomdigit,fpconv,5,154.329485
randomdigit,fpconv,6,160.127781
randomdigit,fpconv,7,165.670806
randomdigit,fpconv,8,168.041179
randomdigit,fpconv,9,169.901010
randomdigit,fpconv,10,171.542037
randomdigit,fpconv,11,174.751156
randomdigit,fpconv,12,178.653154
randomdigit,fpconv,13,180.221247
randomdigit,fpconv,14,184.560852
randomdigit,fpconv,15,184.269114
randomdigit,fpconv,16,192.729520
randomdigit,fpconv,17,198.236078
randomdigit,grisu2,1,121.946550
randomdigit,grisu2,2,131.136302
randomdigit,grisu2,3,129.823480
randomdigit,grisu2,4,134.783029
randomdigit,grisu2,5,131.610376
randomdigit,grisu2,6,134.236020
randomdigit,grisu2,7,137.955681
randomdigit,grisu2,8,138.794429
randomdigit,grisu2,9,142.149417
randomdigit,grisu2,10,144.519790
randomdigit,grisu2,11,147.218368
randomdigit,grisu2,12,151.120366
randomdigit,grisu2,13,152.943729
randomdigit,grisu2,14,155.861111
randomdigit,grisu2,15,160.638323
randomdigit,grisu2,16,162.826359
randomdigit,grisu2,17,168.259982
randomdigit,jkl,1,37.816559
randomdigit,jkl,2,36.686073
randomdigit,jkl,3,37.378951
randomdigit,jkl,4,36.868410
randomdigit,jkl,5,36.357868
randomdigit,jkl,6,36.029662
randomdigit,jkl,7,37.524821
randomdigit,jkl,8,37.415419
randomdigit,jkl,9,38.582371
randomdigit,jkl,10,41.937360
randomdigit,jkl,11,43.067846
randomdigit,jkl,12,40.259866
randomdigit,jkl,13,41.900893
randomdigit,jkl,14,42.630238
randomdigit,jkl,15,44.125396
randomdigit,jkl,16,44.088929
randomdigit,jkl,17,47.954460
randomdigit,milo,1,47.480385
randomdigit,milo,2,54.992643
randomdigit,milo,3,55.174979
randomdigit,milo,4,62.103760
randomdigit,milo,5,62.322564
randomdigit,milo,6,65.896356
randomdigit,milo,7,68.266729
randomdigit,milo,8,71.220578
randomdigit,milo,9,78.586966
randomdigit,milo,10,81.394946
randomdigit,milo,11,84.312328
randomdigit,milo,12,83.254777
randomdigit,milo,13,87.156775
randomdigit,milo,14,92.845669
randomdigit,milo,15,95.325443
randomdigit,milo,16,97.404077
randomdigit,milo,17,101.269608
randomdigit,milo_only_Grisu2,1,32.455870
randomdigit,milo_only_Grisu2,2,35.664990
randomdigit,milo_only_Grisu2,3,40.004595
randomdigit,milo_only_Grisu2,4,42.885509
randomdigit,milo_only_Grisu2,5,46.495769
randomdigit,milo_only_Grisu2,6,50.725972
randomdigit,milo_only_Grisu2,7,54.044494
randomdigit,milo_only_Grisu2,8,56.961875
randomdigit,milo_only_Grisu2,9,59.806322
randomdigit,milo_only_Grisu2,10,62.249629
randomdigit,milo_only_Grisu2,11,65.677553
randomdigit,milo_only_Grisu2,12,68.631402
randomdigit,milo_only_Grisu2,13,72.095792
randomdigit,milo_only_Grisu2,14,73.773287
randomdigit,milo_only_Grisu2,15,76.727135
randomdigit,milo_only_Grisu2,16,82.416030
randomdigit,milo_only_Grisu2,17,81.869021
randomdigit,null,1,1.385756
randomdigit,null,2,1.385756
randomdigit,null,3,1.385756
randomdigit,null,4,1.385756
randomdigit,null,5,1.385756
randomdigit,null,6,1.385756
randomdigit,null,7,1.385756
randomdigit,null,8,1.385756
randomdigit,null,9,1.385756
randomdigit,null,10,1.385756
randomdigit,null,11,1.385756
randomdigit,null,12,1.385756
randomdigit,null,13,1.385756
randomdigit,null,14,1.385756
randomdigit,null,15,1.385756
randomdigit,null,16,1.385756
randomdigit,null,17,1.385756
randomdigit,to_chars,1,79.863321
randomdigit,to_chars,2,81.796086
randomdigit,to_chars,3,83.254777
randomdigit,to_chars,4,78.696368
randomdigit,to_chars,5,72.606334
randomdigit,to_chars,6,69.433682
randomdigit,to_chars,7,66.625702
randomdigit,to_chars,8,64.948207
randomdigit,to_chars,9,62.833106
randomdigit,to_chars,10,62.978975
randomdigit,to_chars,11,60.718004
randomdigit,to_chars,12,58.675837
randomdigit,to_chars,13,57.545352
randomdigit,to_chars,14,55.794923
randomdigit,to_chars,15,53.825690
randomdigit,to_chars,16,51.819990
randomdigit,to_chars,17,51.965859
</textarea>
</div>
<div class="row" id="downloadDD" style="display: none">
<div class="btn-group pull-right" >
    <button class="btn dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-picture"></span></button>
    <ul class="dropdown-menu">
        <li><a tabindex="-1" href="#" dltype="image/jpeg">JPEG</a></li>
        <li><a tabindex="-1" href="#" dltype="image/png">PNG</a></li>
        <li><a tabindex="-1" href="#" dltype="application/pdf">PDF</a></li>
        <li><a tabindex="-1" href="#" dltype="image/svg+xml">SVG</a></li>
    </ul>
</div>
</div>
<form method="post" action="http://export.highcharts.com/" id="imageGetForm">
    <input type="hidden" name="filename" id="imageFilename" value="" />
    <input type="hidden" name="type" id="imageGetFormTYPE" value="" />
    <input type="hidden" name="width" value="900" />
    <input type="hidden" name="svg" value="" id="imageGetFormSVG" />
</form>
</div>
</body>
</html>