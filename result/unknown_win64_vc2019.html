<html>
<head>
<script src="http://code.jquery.com/jquery-1.8.2.js"></script>
<script src="http://www.google.com/jsapi?autoload={%22modules%22:[{%22name%22:%22visualization%22,%22version%22:%221%22,%22packages%22:[%22controls%22,%22charteditor%22]}]}"></script>
<script src="jquery.csv.js"></script>
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script>
$(function() {
	google.load("visualization", "1", {packages:["corechart"]});
  google.setOnLoadCallback(function() {

    var csv = $('#textInput').val();
    var data = $.csv.toArrays(csv, {
        onParseValue: $.csv.hooks.castToScalar
    });

    // Convert data for bar chart (summing all digits)
    var timeData = {};	// type -> table
    var funcRowMap;
    var maxDigit = 0;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
      var digit = data[i][2];
   		var time = data[i][3];
   		if (timeData[type] == null) {
   			timeData[type] = [["Function", "Time (ns)"/*, { role: "style" }*/]];
        if (digit != 0)
   			  funcRowMap = {};
   		}

   		var table = timeData[type];
   		
      if (digit != 0) {
     		if (funcRowMap[func] == null)
     			funcRowMap[func] = table.push([func, 0]) - 1;
     		
     		table[funcRowMap[func]][1] += time;
      }
      else 
        table.push([func, time]);

      maxDigit = Math.max(maxDigit, digit);
    }

    // Compute average
    for (var type in timeData) {
      var table = timeData[type];
      for (var i = 1; i < table.length; i++)
        table[i][1] /= maxDigit;
    }

    // Convert data for drawing line chart per random digit
    var timeDigitData = {}; // type -> table
    var funcColumnMap;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
		  var digit = data[i][2];
   		var time = data[i][3];

      if (digit == 0)
        continue;

   		if (timeDigitData[type] == null) {
   			timeDigitData[type] = [["Digit"]];
   			funcColumnMap = {};
   		}

   		var table = timeDigitData[type];

   		if (funcColumnMap[func] == null)
   			funcColumnMap[func] = table[0].push(func) - 1;

   		var row;
   		for (row = 1; row < table.length; row++)
   			if (table[row][0] == digit)
   				break;

    	if (row == table.length)
    		table.push([digit]);

		table[row][funcColumnMap[func]] = time;
	}

	for (var type in timeData) {
		$("#main").append(
      $("<a>", {name: type}),
      $("<h2>", {style: "padding-top: 70px; margin-top: -70px;"}).append(type)
    );

    $("#section").append($("<li>").append($("<a>", {href: "#" + type}).append(type)));

		drawTable(type, timeData[type]);
		drawBarChart(type, timeData[type]);
    if (timeDigitData[type] != null)
		  drawDigitChart(type, timeDigitData[type]);
	}

	$(".chart").each(function() {
		var chart = $(this);
		var d = $("#downloadDD").clone().css("display", "");
		$('li a', d).each(function() {
	        $(this).click(function() {
	            var svg = chart[0].getElementsByTagName('svg')[0].parentNode.innerHTML;
	            svg=sanitize(svg);
	            $('#imageFilename').val($("#title").html() + "_" + chart.data("filename"));
	            $('#imageGetFormTYPE').val($(this).attr('dltype'));
	            $('#imageGetFormSVG').val(svg);
	            $('#imageGetForm').submit();
	        });
	    });		
		$(this).after(d);
	});

  // Add configurations
  var thisConfig = "unknown_win64_vc2019";
  var configurations = ["corei7920@2.67_cygwin32_gcc4.8","corei7920@2.67_cygwin64_gcc4.8","corei7920@2.67_win32_vc2013","corei7920@2.67_win64_vc2013","unknown_mac32_clang7.0","unknown_mac64_clang7.0","unknown_win64_vc2019"];

  for (var i in configurations) {
    var c = configurations[i];
    $("#configuration").append($("<li>", {class : (c == thisConfig ? "active" : "")}).append($("<a>", {href: c + ".html"}).append(c)));
  }
  })
});

function drawTable(type, timeData) {
	var data = google.visualization.arrayToDataTable(timeData);
    data.addColumn('number', 'Speedup');
    data.sort([{ column: 1, desc: true }]);
    var formatter1 = new google.visualization.NumberFormat({ fractionDigits: 3 });
    formatter1.format(data, 1);

	var div = document.createElement("div");
	div.className = "tablechart";
	$("#main").append(div);
    var table = new google.visualization.Table(div);
    redrawTable(0);
    table.setSelection([{ row: 0, column: null}]);

    function redrawTable(selectedRow) {
        // Compute relative time using the first row as basis
        var basis = data.getValue(selectedRow, 1);
        for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
            data.setValue(rowIndex, 2, basis / data.getValue(rowIndex, 1));

        var formatter = new google.visualization.NumberFormat({suffix: 'x'});
        formatter.format(data, 2); // Apply formatter to second column

        table.draw(data);
    }

    google.visualization.events.addListener(table, 'select',
    function() {
        var selection = table.getSelection();
        if (selection.length > 0) {
            var item = selection[0];
            if (item.row != null)
                redrawTable(item.row);
        }
    });

}

function drawBarChart(type, timeData) {
    var defaultColors = ["#3366cc","#dc3912","#ff9900","#109618","#990099","#0099c6","#dd4477","#66aa00","#b82e2e","#316395","#994499","#22aa99","#aaaa11","#6633cc","#e67300","#8b0707","#651067","#329262","#5574a6","#3b3eac","#b77322","#16d620","#b91383","#f4359e","#9c5935","#a9c413","#2a778d","#668d1c","#bea413","#0c5922","#743411"];

	var data = google.visualization.arrayToDataTable(timeData);
	data.addColumn({ type: "string", role: "style" })
	for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
		data.setValue(rowIndex, 2, defaultColors[rowIndex]);

    data.sort([{ column: 1, desc: true }]);
	var options = { 
		title: type,
		chartArea: {'width': '70%', 'height': '70%'},
		width: 800,
		height: 300,
		legend: { position: "none" },
		hAxis: { title: "Time (ns)" }
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_time");
	$("#main").append(div);
	var chart = new google.visualization.BarChart(div);

	chart.draw(data, options);
}

function drawDigitChart(type, timeDigitData) {
	var data = google.visualization.arrayToDataTable(timeDigitData);

	var options = { 
		title: type,
		chartArea: {left:100, 'width': '60%', 'height': '80%'},
		hAxis: {
			title: "Digit",
			gridlines: { count: timeDigitData.length - 1 },
			maxAlternation: 1,
			minTextSpacing: 0
		},
		vAxis: {
			title: "Time (ns) in log scale",
			logScale: true,
			minorGridlines: { count: 0 },
      baseline: 0,
      viewWindow: {max: 150, min: 20},
      minorGridlines: {interval: [1,2,3,4,5,6,7,8,9,10]}
		},
		width: 800,
		height: 600
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_timedigit");
	$("#main").append(div);
	var chart = new google.visualization.LineChart(div);

	chart.draw(data, options);
}

// http://jsfiddle.net/P6XXM/
function sanitize(svg) {
    svg = svg
        .replace(/\<svg/,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1"')
        .replace(/zIndex="[^"]+"/g, '')
        .replace(/isShadow="[^"]+"/g, '')
        .replace(/symbolName="[^"]+"/g, '')
        .replace(/jQuery[0-9]+="[^"]+"/g, '')
        .replace(/isTracker="[^"]+"/g, '')
        .replace(/url\([^#]+#/g, 'url(#')
        .replace('<svg xmlns:xlink="http://www.w3.org/1999/xlink" ', '<svg ')
        .replace(/ href=/g, ' xlink:href=')
    /*.replace(/preserveAspectRatio="none">/g, 'preserveAspectRatio="none"/>')*/
    /* This fails in IE < 8
    .replace(/([0-9]+)\.([0-9]+)/g, function(s1, s2, s3) { // round off to save weight
    return s2 +'.'+ s3[0];
    })*/

    // IE specific
        .replace(/id=([^" >]+)/g, 'id="$1"')
        .replace(/class=([^" ]+)/g, 'class="$1"')
        .replace(/ transform /g, ' ')
        .replace(/:(path|rect)/g, '$1')
        .replace(/<img ([^>]*)>/gi, '<image $1 />')
        .replace(/<\/image>/g, '') // remove closing tags for images as they'll never have any content
        .replace(/<image ([^>]*)([^\/])>/gi, '<image $1$2 />') // closes image tags for firefox
        .replace(/width=(\d+)/g, 'width="$1"')
        .replace(/height=(\d+)/g, 'height="$1"')
        .replace(/hc-svg-href="/g, 'xlink:href="')
        .replace(/style="([^"]+)"/g, function (s) {
            return s.toLowerCase();
        });

    // IE9 beta bugs with innerHTML. Test again with final IE9.
    svg = svg.replace(/(url\(#highcharts-[0-9]+)&quot;/g, '$1')
        .replace(/&quot;/g, "'");
    if (svg.match(/ xmlns="/g).length == 2) {
        svg = svg.replace(/xmlns="[^"]+"/, '');
    }

    return svg;
}
</script>
<style type="text/css">
@media (min-width: 800px) {
  .container {
    max-width: 800px;
  }
}
textarea {
	font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace;
}
.tablechart {
	width: 700px;
	margin: auto;
	padding-top: 20px;
	padding-bottom: 20px;
}
.chart {
	padding-top: 20px;
	padding-bottom: 20px;
}
body { padding-top: 70px; }
</style>
</head>
<body>
<div class="container">
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://github.com/miloyip/dtoa-benchmark"><span class="glyphicon glyphicon-home"></span> dtoa-benchmark</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Configuration <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="configuration">
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Section <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="section">
          </ul>
        </li>
      </ul>
      <p class="navbar-text navbar-right">Developed by <a href="https://github.com/miloyip" class="navbar-link">Milo Yip</a></p>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
<div class="page-header">
<h1 id="title">unknown_win64_vc2019</h1>
</div>
<div id="main"></div>
<h2>Source CSV</h2>
<textarea id="textInput" class="form-control" rows="5" readonly>
  Type,Function,Digit,Time(ns)
  randomdigit,doubleconv,1,71.513000
  randomdigit,doubleconv,2,82.974000
  randomdigit,doubleconv,3,87.702000
  randomdigit,doubleconv,4,96.862000
  randomdigit,doubleconv,5,104.790000
  randomdigit,doubleconv,6,107.606000
  randomdigit,doubleconv,7,108.673000
  randomdigit,doubleconv,8,116.916000
  randomdigit,doubleconv,9,112.807000
  randomdigit,doubleconv,10,121.440000
  randomdigit,doubleconv,11,120.198000
  randomdigit,doubleconv,12,126.559000
  randomdigit,doubleconv,13,127.614000
  randomdigit,doubleconv,14,131.243000
  randomdigit,doubleconv,15,130.901000
  randomdigit,doubleconv,16,130.001000
  randomdigit,doubleconv,17,147.645000
  randomdigit,emyg,1,46.153000
  randomdigit,emyg,2,51.293000
  randomdigit,emyg,3,54.740000
  randomdigit,emyg,4,55.890000
  randomdigit,emyg,5,58.557000
  randomdigit,emyg,6,60.269000
  randomdigit,emyg,7,61.048000
  randomdigit,emyg,8,62.683000
  randomdigit,emyg,9,62.003000
  randomdigit,emyg,10,66.029000
  randomdigit,emyg,11,68.083000
  randomdigit,emyg,12,70.843000
  randomdigit,emyg,13,73.412000
  randomdigit,emyg,14,75.126000
  randomdigit,emyg,15,77.496000
  randomdigit,emyg,16,78.851000
  randomdigit,emyg,17,84.777000
  randomdigit,erthink,1,33.466000
  randomdigit,erthink,2,44.216000
  randomdigit,erthink,3,38.478000
  randomdigit,erthink,4,38.197000
  randomdigit,erthink,5,39.920000
  randomdigit,erthink,6,39.962000
  randomdigit,erthink,7,41.135000
  randomdigit,erthink,8,43.259000
  randomdigit,erthink,9,43.392000
  randomdigit,erthink,10,48.373000
  randomdigit,erthink,11,47.382000
  randomdigit,erthink,12,47.840000
  randomdigit,erthink,13,49.983000
  randomdigit,erthink,14,52.525000
  randomdigit,erthink,15,52.891000
  randomdigit,erthink,16,54.567000
  randomdigit,erthink,17,57.361000
  randomdigit,floaxie,1,31.080000
  randomdigit,floaxie,2,36.327000
  randomdigit,floaxie,3,40.406000
  randomdigit,floaxie,4,45.256000
  randomdigit,floaxie,5,52.125000
  randomdigit,floaxie,6,59.066000
  randomdigit,floaxie,7,67.197000
  randomdigit,floaxie,8,72.596000
  randomdigit,floaxie,9,79.121000
  randomdigit,floaxie,10,88.762000
  randomdigit,floaxie,11,95.846000
  randomdigit,floaxie,12,98.738000
  randomdigit,floaxie,13,101.867000
  randomdigit,floaxie,14,104.419000
  randomdigit,floaxie,15,105.594000
  randomdigit,floaxie,16,108.398000
  randomdigit,floaxie,17,108.292000
  randomdigit,fmt,1,50.840000
  randomdigit,fmt,2,55.059000
  randomdigit,fmt,3,51.453000
  randomdigit,fmt,4,55.304000
  randomdigit,fmt,5,53.790000
  randomdigit,fmt,6,54.541000
  randomdigit,fmt,7,52.146000
  randomdigit,fmt,8,56.452000
  randomdigit,fmt,9,59.253000
  randomdigit,fmt,10,61.620000
  randomdigit,fmt,11,57.800000
  randomdigit,fmt,12,59.986000
  randomdigit,fmt,13,59.558000
  randomdigit,fmt,14,60.363000
  randomdigit,fmt,15,59.051000
  randomdigit,fmt,16,61.261000
  randomdigit,fmt,17,63.029000
  randomdigit,grisu2,1,109.516000
  randomdigit,grisu2,2,124.717000
  randomdigit,grisu2,3,123.820000
  randomdigit,grisu2,4,126.569000
  randomdigit,grisu2,5,128.963000
  randomdigit,grisu2,6,129.751000
  randomdigit,grisu2,7,131.794000
  randomdigit,grisu2,8,135.486000
  randomdigit,grisu2,9,139.047000
  randomdigit,grisu2,10,141.250000
  randomdigit,grisu2,11,141.660000
  randomdigit,grisu2,12,145.585000
  randomdigit,grisu2,13,145.443000
  randomdigit,grisu2,14,148.760000
  randomdigit,grisu2,15,151.649000
  randomdigit,grisu2,16,152.001000
  randomdigit,grisu2,17,161.465000
  randomdigit,milo,1,50.181000
  randomdigit,milo,2,52.645000
  randomdigit,milo,3,56.082000
  randomdigit,milo,4,58.315000
  randomdigit,milo,5,60.227000
  randomdigit,milo,6,61.493000
  randomdigit,milo,7,60.949000
  randomdigit,milo,8,64.464000
  randomdigit,milo,9,66.122000
  randomdigit,milo,10,68.466000
  randomdigit,milo,11,68.390000
  randomdigit,milo,12,78.200000
  randomdigit,milo,13,76.071000
  randomdigit,milo,14,78.517000
  randomdigit,milo,15,83.505000
  randomdigit,milo,16,86.727000
  randomdigit,milo,17,90.325000
  randomdigit,ryu,1,59.840000
  randomdigit,ryu,2,56.959000
  randomdigit,ryu,3,57.229000
  randomdigit,ryu,4,56.181000
  randomdigit,ryu,5,54.367000
  randomdigit,ryu,6,53.320000
  randomdigit,ryu,7,52.242000
  randomdigit,ryu,8,51.229000
  randomdigit,ryu,9,48.877000
  randomdigit,ryu,10,49.570000
  randomdigit,ryu,11,47.242000
  randomdigit,ryu,12,44.110000
  randomdigit,ryu,13,42.145000
  randomdigit,ryu,14,41.196000
  randomdigit,ryu,15,39.408000
  randomdigit,ryu,16,39.621000
  randomdigit,ryu,17,39.689000
  randomdigit,dragonbox,1,25.401000
  randomdigit,dragonbox,2,27.193000
  randomdigit,dragonbox,3,26.904000
  randomdigit,dragonbox,4,26.523000
  randomdigit,dragonbox,5,26.334000
  randomdigit,dragonbox,6,27.050000
  randomdigit,dragonbox,7,26.047000
  randomdigit,dragonbox,8,27.054000
  randomdigit,dragonbox,9,28.046000
  randomdigit,dragonbox,10,28.218000
  randomdigit,dragonbox,11,28.117000
  randomdigit,dragonbox,12,28.839000
  randomdigit,dragonbox,13,27.532000
  randomdigit,dragonbox,14,30.672000
  randomdigit,dragonbox,15,28.659000
  randomdigit,dragonbox,16,29.608000
  randomdigit,dragonbox,17,32.415000
  randomdigit,dragonbox_comp,1,31.325000
  randomdigit,dragonbox_comp,2,32.675000
  randomdigit,dragonbox_comp,3,32.340000
  randomdigit,dragonbox_comp,4,33.047000
  randomdigit,dragonbox_comp,5,32.766000
  randomdigit,dragonbox_comp,6,33.519000
  randomdigit,dragonbox_comp,7,37.341000
  randomdigit,dragonbox_comp,8,35.658000
  randomdigit,dragonbox_comp,9,34.906000
  randomdigit,dragonbox_comp,10,35.007000
  randomdigit,dragonbox_comp,11,34.675000
  randomdigit,dragonbox_comp,12,35.322000
  randomdigit,dragonbox_comp,13,35.032000
  randomdigit,dragonbox_comp,14,35.763000
  randomdigit,dragonbox_comp,15,36.101000
  randomdigit,dragonbox_comp,16,35.720000
  randomdigit,dragonbox_comp,17,38.509000
  randomdigit,fmt_full_cache,1,42.937000
  randomdigit,fmt_full_cache,2,46.236000
  randomdigit,fmt_full_cache,3,45.790000
  randomdigit,fmt_full_cache,4,49.136000
  randomdigit,fmt_full_cache,5,47.670000
  randomdigit,fmt_full_cache,6,48.909000
  randomdigit,fmt_full_cache,7,46.812000
  randomdigit,fmt_full_cache,8,49.813000
  randomdigit,fmt_full_cache,9,51.860000
  randomdigit,fmt_full_cache,10,54.518000
  randomdigit,fmt_full_cache,11,53.074000
  randomdigit,fmt_full_cache,12,54.337000
  randomdigit,fmt_full_cache,13,52.939000
  randomdigit,fmt_full_cache,14,55.125000
  randomdigit,fmt_full_cache,15,54.162000
  randomdigit,fmt_full_cache,16,55.152000
  randomdigit,fmt_full_cache,17,56.563000
  </textarea>
</div>
<div class="row" id="downloadDD" style="display: none">
<div class="btn-group pull-right" >
    <button class="btn dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-picture"></span></button>
    <ul class="dropdown-menu">
        <li><a tabindex="-1" href="#" dltype="image/jpeg">JPEG</a></li>
        <li><a tabindex="-1" href="#" dltype="image/png">PNG</a></li>
        <li><a tabindex="-1" href="#" dltype="application/pdf">PDF</a></li>
        <li><a tabindex="-1" href="#" dltype="image/svg+xml">SVG</a></li>
    </ul>
</div>
</div>
<form method="post" action="http://export.highcharts.com/" id="imageGetForm">
    <input type="hidden" name="filename" id="imageFilename" value="" />
    <input type="hidden" name="type" id="imageGetFormTYPE" value="" />
    <input type="hidden" name="width" value="900" />
    <input type="hidden" name="svg" value="" id="imageGetFormSVG" />
</form>
</div>
</body>
</html>