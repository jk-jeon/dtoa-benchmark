<html>
<head>
<script src="http://code.jquery.com/jquery-1.8.2.js"></script>
<script src="http://www.google.com/jsapi?autoload={%22modules%22:[{%22name%22:%22visualization%22,%22version%22:%221%22,%22packages%22:[%22controls%22,%22charteditor%22]}]}"></script>
<script src="jquery.csv.js"></script>
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script>
$(function() {
	google.load("visualization", "1", {packages:["corechart"]});
  google.setOnLoadCallback(function() {

    var csv = $('#textInput').val();
    var data = $.csv.toArrays(csv, {
        onParseValue: $.csv.hooks.castToScalar
    });

    // Convert data for bar chart (summing all digits)
    var timeData = {};	// type -> table
    var funcRowMap;
    var maxDigit = 0;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
      var digit = data[i][2];
   		var time = data[i][3];
   		if (timeData[type] == null) {
   			timeData[type] = [["Function", "Time (ns)"/*, { role: "style" }*/]];
        if (digit != 0)
   			  funcRowMap = {};
   		}

   		var table = timeData[type];
   		
      if (digit != 0) {
     		if (funcRowMap[func] == null)
     			funcRowMap[func] = table.push([func, 0]) - 1;
     		
     		table[funcRowMap[func]][1] += time;
      }
      else 
        table.push([func, time]);

      maxDigit = Math.max(maxDigit, digit);
    }

    // Compute average
    for (var type in timeData) {
      var table = timeData[type];
      for (var i = 1; i < table.length; i++)
        table[i][1] /= maxDigit;
    }

    // Convert data for drawing line chart per random digit
    var timeDigitData = {}; // type -> table
    var funcColumnMap;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
		  var digit = data[i][2];
   		var time = data[i][3];

      if (digit == 0)
        continue;

   		if (timeDigitData[type] == null) {
   			timeDigitData[type] = [["Digit"]];
   			funcColumnMap = {};
   		}

   		var table = timeDigitData[type];

   		if (funcColumnMap[func] == null)
   			funcColumnMap[func] = table[0].push(func) - 1;

   		var row;
   		for (row = 1; row < table.length; row++)
   			if (table[row][0] == digit)
   				break;

    	if (row == table.length)
    		table.push([digit]);

		table[row][funcColumnMap[func]] = time;
	}

	for (var type in timeData) {
		$("#main").append(
      $("<a>", {name: type}),
      $("<h2>", {style: "padding-top: 70px; margin-top: -70px;"}).append(type)
    );

    $("#section").append($("<li>").append($("<a>", {href: "#" + type}).append(type)));

		drawTable(type, timeData[type]);
		drawBarChart(type, timeData[type]);
    if (timeDigitData[type] != null)
		  drawDigitChart(type, timeDigitData[type]);
	}

	$(".chart").each(function() {
		var chart = $(this);
		var d = $("#downloadDD").clone().css("display", "");
		$('li a', d).each(function() {
	        $(this).click(function() {
	            var svg = chart[0].getElementsByTagName('svg')[0].parentNode.innerHTML;
	            svg=sanitize(svg);
	            $('#imageFilename').val($("#title").html() + "_" + chart.data("filename"));
	            $('#imageGetFormTYPE').val($(this).attr('dltype'));
	            $('#imageGetFormSVG').val(svg);
	            $('#imageGetForm').submit();
	        });
	    });		
		$(this).after(d);
	});

  // Add configurations
  var thisConfig = "unknown_win64_vc2019";
  var configurations = ["corei7920@2.67_cygwin32_gcc4.8","corei7920@2.67_cygwin64_gcc4.8","corei7920@2.67_win32_vc2013","corei7920@2.67_win64_vc2013","unknown_mac32_clang7.0","unknown_mac64_clang7.0","unknown_win64_vc2019"];

  for (var i in configurations) {
    var c = configurations[i];
    $("#configuration").append($("<li>", {class : (c == thisConfig ? "active" : "")}).append($("<a>", {href: c + ".html"}).append(c)));
  }
  })
});

function drawTable(type, timeData) {
	var data = google.visualization.arrayToDataTable(timeData);
    data.addColumn('number', 'Speedup');
    data.sort([{ column: 1, desc: true }]);
    var formatter1 = new google.visualization.NumberFormat({ fractionDigits: 3 });
    formatter1.format(data, 1);

	var div = document.createElement("div");
	div.className = "tablechart";
	$("#main").append(div);
    var table = new google.visualization.Table(div);
    redrawTable(0);
    table.setSelection([{ row: 0, column: null}]);

    function redrawTable(selectedRow) {
        // Compute relative time using the first row as basis
        var basis = data.getValue(selectedRow, 1);
        for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
            data.setValue(rowIndex, 2, basis / data.getValue(rowIndex, 1));

        var formatter = new google.visualization.NumberFormat({suffix: 'x'});
        formatter.format(data, 2); // Apply formatter to second column

        table.draw(data);
    }

    google.visualization.events.addListener(table, 'select',
    function() {
        var selection = table.getSelection();
        if (selection.length > 0) {
            var item = selection[0];
            if (item.row != null)
                redrawTable(item.row);
        }
    });

}

function drawBarChart(type, timeData) {
    var defaultColors = ["#3366cc","#dc3912","#ff9900","#109618","#990099","#0099c6","#dd4477","#66aa00","#b82e2e","#316395","#994499","#22aa99","#aaaa11","#6633cc","#e67300","#8b0707","#651067","#329262","#5574a6","#3b3eac","#b77322","#16d620","#b91383","#f4359e","#9c5935","#a9c413","#2a778d","#668d1c","#bea413","#0c5922","#743411"];

	var data = google.visualization.arrayToDataTable(timeData);
	data.addColumn({ type: "string", role: "style" })
	for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
		data.setValue(rowIndex, 2, defaultColors[rowIndex]);

    data.sort([{ column: 1, desc: true }]);
	var options = { 
		title: type,
		chartArea: {'width': '70%', 'height': '70%'},
		width: 800,
		height: 300,
		legend: { position: "none" },
		hAxis: { title: "Time (ns)" }
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_time");
	$("#main").append(div);
	var chart = new google.visualization.BarChart(div);

	chart.draw(data, options);
}

function drawDigitChart(type, timeDigitData) {
	var data = google.visualization.arrayToDataTable(timeDigitData);

	var options = { 
		title: type,
		chartArea: {left:100, 'width': '60%', 'height': '80%'},
		hAxis: {
			title: "Digit",
			gridlines: { count: timeDigitData.length - 1 },
			maxAlternation: 1,
			minTextSpacing: 0
		},
		vAxis: {
			title: "Time (ns) in log scale",
			logScale: true,
			minorGridlines: { count: 0 },
      baseline: 0,
      viewWindow: {max: 150, min: 20},
      minorGridlines: {interval: [1,2,3,4,5,6,7,8,9,10]}
		},
		width: 800,
		height: 600
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_timedigit");
	$("#main").append(div);
	var chart = new google.visualization.LineChart(div);

	chart.draw(data, options);
}

// http://jsfiddle.net/P6XXM/
function sanitize(svg) {
    svg = svg
        .replace(/\<svg/,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1"')
        .replace(/zIndex="[^"]+"/g, '')
        .replace(/isShadow="[^"]+"/g, '')
        .replace(/symbolName="[^"]+"/g, '')
        .replace(/jQuery[0-9]+="[^"]+"/g, '')
        .replace(/isTracker="[^"]+"/g, '')
        .replace(/url\([^#]+#/g, 'url(#')
        .replace('<svg xmlns:xlink="http://www.w3.org/1999/xlink" ', '<svg ')
        .replace(/ href=/g, ' xlink:href=')
    /*.replace(/preserveAspectRatio="none">/g, 'preserveAspectRatio="none"/>')*/
    /* This fails in IE < 8
    .replace(/([0-9]+)\.([0-9]+)/g, function(s1, s2, s3) { // round off to save weight
    return s2 +'.'+ s3[0];
    })*/

    // IE specific
        .replace(/id=([^" >]+)/g, 'id="$1"')
        .replace(/class=([^" ]+)/g, 'class="$1"')
        .replace(/ transform /g, ' ')
        .replace(/:(path|rect)/g, '$1')
        .replace(/<img ([^>]*)>/gi, '<image $1 />')
        .replace(/<\/image>/g, '') // remove closing tags for images as they'll never have any content
        .replace(/<image ([^>]*)([^\/])>/gi, '<image $1$2 />') // closes image tags for firefox
        .replace(/width=(\d+)/g, 'width="$1"')
        .replace(/height=(\d+)/g, 'height="$1"')
        .replace(/hc-svg-href="/g, 'xlink:href="')
        .replace(/style="([^"]+)"/g, function (s) {
            return s.toLowerCase();
        });

    // IE9 beta bugs with innerHTML. Test again with final IE9.
    svg = svg.replace(/(url\(#highcharts-[0-9]+)&quot;/g, '$1')
        .replace(/&quot;/g, "'");
    if (svg.match(/ xmlns="/g).length == 2) {
        svg = svg.replace(/xmlns="[^"]+"/, '');
    }

    return svg;
}
</script>
<style type="text/css">
@media (min-width: 800px) {
  .container {
    max-width: 800px;
  }
}
textarea {
	font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace;
}
.tablechart {
	width: 700px;
	margin: auto;
	padding-top: 20px;
	padding-bottom: 20px;
}
.chart {
	padding-top: 20px;
	padding-bottom: 20px;
}
body { padding-top: 70px; }
</style>
</head>
<body>
<div class="container">
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://github.com/miloyip/dtoa-benchmark"><span class="glyphicon glyphicon-home"></span> dtoa-benchmark</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Configuration <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="configuration">
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Section <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="section">
          </ul>
        </li>
      </ul>
      <p class="navbar-text navbar-right">Developed by <a href="https://github.com/miloyip" class="navbar-link">Milo Yip</a></p>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
<div class="page-header">
<h1 id="title">unknown_win64_vc2019</h1>
</div>
<div id="main"></div>
<h2>Source CSV</h2>
<textarea id="textInput" class="form-control" rows="5" readonly>
  Type,Function,Digit,Time(ns)
  randomdigit,doubleconv,1,100.579000
  randomdigit,doubleconv,2,107.561000
  randomdigit,doubleconv,3,112.423000
  randomdigit,doubleconv,4,119.732000
  randomdigit,doubleconv,5,122.604000
  randomdigit,doubleconv,6,126.559000
  randomdigit,doubleconv,7,129.894000
  randomdigit,doubleconv,8,149.115000
  randomdigit,doubleconv,9,140.516000
  randomdigit,doubleconv,10,148.244000
  randomdigit,doubleconv,11,146.073000
  randomdigit,doubleconv,12,150.041000
  randomdigit,doubleconv,13,150.557000
  randomdigit,doubleconv,14,157.356000
  randomdigit,doubleconv,15,157.164000
  randomdigit,doubleconv,16,164.650000
  randomdigit,doubleconv,17,172.671000
  randomdigit,emyg,1,73.073000
  randomdigit,emyg,2,78.898000
  randomdigit,emyg,3,82.654000
  randomdigit,emyg,4,86.330000
  randomdigit,emyg,5,88.484000
  randomdigit,emyg,6,91.446000
  randomdigit,emyg,7,93.911000
  randomdigit,emyg,8,97.269000
  randomdigit,emyg,9,100.159000
  randomdigit,emyg,10,102.221000
  randomdigit,emyg,11,107.471000
  randomdigit,emyg,12,135.856000
  randomdigit,emyg,13,111.093000
  randomdigit,emyg,14,112.673000
  randomdigit,emyg,15,115.679000
  randomdigit,emyg,16,118.602000
  randomdigit,emyg,17,124.436000
  randomdigit,floaxie,1,49.542000
  randomdigit,floaxie,2,58.134000
  randomdigit,floaxie,3,65.612000
  randomdigit,floaxie,4,72.693000
  randomdigit,floaxie,5,82.915000
  randomdigit,floaxie,6,89.238000
  randomdigit,floaxie,7,97.342000
  randomdigit,floaxie,8,105.675000
  randomdigit,floaxie,9,113.209000
  randomdigit,floaxie,10,117.442000
  randomdigit,floaxie,11,120.625000
  randomdigit,floaxie,12,120.727000
  randomdigit,floaxie,13,121.252000
  randomdigit,floaxie,14,120.544000
  randomdigit,floaxie,15,125.559000
  randomdigit,floaxie,16,126.399000
  randomdigit,floaxie,17,126.878000
  randomdigit,fmt,1,76.552000
  randomdigit,fmt,2,79.642000
  randomdigit,fmt,3,79.853000
  randomdigit,fmt,4,79.274000
  randomdigit,fmt,5,79.301000
  randomdigit,fmt,6,78.753000
  randomdigit,fmt,7,79.916000
  randomdigit,fmt,8,79.954000
  randomdigit,fmt,9,85.165000
  randomdigit,fmt,10,80.815000
  randomdigit,fmt,11,81.011000
  randomdigit,fmt,12,80.215000
  randomdigit,fmt,13,80.723000
  randomdigit,fmt,14,81.266000
  randomdigit,fmt,15,82.402000
  randomdigit,fmt,16,81.841000
  randomdigit,fmt,17,91.880000
  randomdigit,grisu2,1,125.519000
  randomdigit,grisu2,2,134.157000
  randomdigit,grisu2,3,132.369000
  randomdigit,grisu2,4,131.520000
  randomdigit,grisu2,5,129.920000
  randomdigit,grisu2,6,133.561000
  randomdigit,grisu2,7,136.304000
  randomdigit,grisu2,8,139.902000
  randomdigit,grisu2,9,144.701000
  randomdigit,grisu2,10,146.971000
  randomdigit,grisu2,11,149.072000
  randomdigit,grisu2,12,153.370000
  randomdigit,grisu2,13,156.556000
  randomdigit,grisu2,14,158.068000
  randomdigit,grisu2,15,156.545000
  randomdigit,grisu2,16,160.523000
  randomdigit,grisu2,17,167.897000
  randomdigit,milo,1,62.093000
  randomdigit,milo,2,69.786000
  randomdigit,milo,3,73.075000
  randomdigit,milo,4,75.650000
  randomdigit,milo,5,79.870000
  randomdigit,milo,6,82.339000
  randomdigit,milo,7,84.527000
  randomdigit,milo,8,89.119000
  randomdigit,milo,9,89.699000
  randomdigit,milo,10,92.101000
  randomdigit,milo,11,96.369000
  randomdigit,milo,12,100.009000
  randomdigit,milo,13,103.403000
  randomdigit,milo,14,104.528000
  randomdigit,milo,15,105.394000
  randomdigit,milo,16,110.619000
  randomdigit,milo,17,115.811000
  randomdigit,ryu,1,80.077000
  randomdigit,ryu,2,79.530000
  randomdigit,ryu,3,78.848000
  randomdigit,ryu,4,77.918000
  randomdigit,ryu,5,75.060000
  randomdigit,ryu,6,74.369000
  randomdigit,ryu,7,69.071000
  randomdigit,ryu,8,65.627000
  randomdigit,ryu,9,63.808000
  randomdigit,ryu,10,68.477000
  randomdigit,ryu,11,61.565000
  randomdigit,ryu,12,59.823000
  randomdigit,ryu,13,58.340000
  randomdigit,ryu,14,57.576000
  randomdigit,ryu,15,55.582000
  randomdigit,ryu,16,53.951000
  randomdigit,ryu,17,54.858000
  randomdigit,dragonbox,1,46.223000
  randomdigit,dragonbox,2,47.337000
  randomdigit,dragonbox,3,46.268000
  randomdigit,dragonbox,4,46.146000
  randomdigit,dragonbox,5,43.701000
  randomdigit,dragonbox,6,43.655000
  randomdigit,dragonbox,7,43.374000
  randomdigit,dragonbox,8,43.340000
  randomdigit,dragonbox,9,47.104000
  randomdigit,dragonbox,10,48.869000
  randomdigit,dragonbox,11,47.565000
  randomdigit,dragonbox,12,46.955000
  randomdigit,dragonbox,13,46.578000
  randomdigit,dragonbox,14,46.063000
  randomdigit,dragonbox,15,45.893000
  randomdigit,dragonbox,16,45.775000
  randomdigit,dragonbox,17,47.934000
  randomdigit,dragonbox_comp,1,61.148000
  randomdigit,dragonbox_comp,2,61.111000
  randomdigit,dragonbox_comp,3,59.648000
  randomdigit,dragonbox_comp,4,56.475000
  randomdigit,dragonbox_comp,5,55.227000
  randomdigit,dragonbox_comp,6,55.304000
  randomdigit,dragonbox_comp,7,54.608000
  randomdigit,dragonbox_comp,8,53.991000
  randomdigit,dragonbox_comp,9,58.582000
  randomdigit,dragonbox_comp,10,59.566000
  randomdigit,dragonbox_comp,11,59.687000
  randomdigit,dragonbox_comp,12,59.878000
  randomdigit,dragonbox_comp,13,59.271000
  randomdigit,dragonbox_comp,14,58.503000
  randomdigit,dragonbox_comp,15,57.744000
  randomdigit,dragonbox_comp,16,56.901000
  randomdigit,dragonbox_comp,17,59.523000
  randomdigit,erthink,1,42.877000
  randomdigit,erthink,2,43.178000
  randomdigit,erthink,3,46.161000
  randomdigit,erthink,4,48.871000
  randomdigit,erthink,5,50.444000
  randomdigit,erthink,6,50.846000
  randomdigit,erthink,7,52.653000
  randomdigit,erthink,8,54.078000
  randomdigit,erthink,9,55.870000
  randomdigit,erthink,10,57.175000
  randomdigit,erthink,11,59.691000
  randomdigit,erthink,12,61.839000
  randomdigit,erthink,13,64.271000
  randomdigit,erthink,14,64.874000
  randomdigit,erthink,15,66.775000
  randomdigit,erthink,16,69.083000
  randomdigit,erthink,17,71.337000
  randomdigit,fmt_full_cache,1,68.590000
  randomdigit,fmt_full_cache,2,72.817000
  randomdigit,fmt_full_cache,3,72.164000
  randomdigit,fmt_full_cache,4,67.860000
  randomdigit,fmt_full_cache,5,66.874000
  randomdigit,fmt_full_cache,6,66.835000
  randomdigit,fmt_full_cache,7,68.983000
  randomdigit,fmt_full_cache,8,68.452000
  randomdigit,fmt_full_cache,9,73.464000
  randomdigit,fmt_full_cache,10,73.415000
  randomdigit,fmt_full_cache,11,73.693000
  randomdigit,fmt_full_cache,12,73.608000
  randomdigit,fmt_full_cache,13,75.053000
  randomdigit,fmt_full_cache,14,75.136000
  randomdigit,fmt_full_cache,15,73.852000
  randomdigit,fmt_full_cache,16,73.655000
  randomdigit,fmt_full_cache,17,80.246000
  </textarea>
</div>
<div class="row" id="downloadDD" style="display: none">
<div class="btn-group pull-right" >
    <button class="btn dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-picture"></span></button>
    <ul class="dropdown-menu">
        <li><a tabindex="-1" href="#" dltype="image/jpeg">JPEG</a></li>
        <li><a tabindex="-1" href="#" dltype="image/png">PNG</a></li>
        <li><a tabindex="-1" href="#" dltype="application/pdf">PDF</a></li>
        <li><a tabindex="-1" href="#" dltype="image/svg+xml">SVG</a></li>
    </ul>
</div>
</div>
<form method="post" action="http://export.highcharts.com/" id="imageGetForm">
    <input type="hidden" name="filename" id="imageFilename" value="" />
    <input type="hidden" name="type" id="imageGetFormTYPE" value="" />
    <input type="hidden" name="width" value="900" />
    <input type="hidden" name="svg" value="" id="imageGetFormSVG" />
</form>
</div>
</body>
</html>