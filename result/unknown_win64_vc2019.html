<html>
<head>
<script src="http://code.jquery.com/jquery-1.8.2.js"></script>
<script src="http://www.google.com/jsapi?autoload={'modules':[{'name':'visualization','version':'1','packages':['controls', 'charteditor']}]}"></script>
<script src="https://web.archive.org/web/20160324220311/http://jquery-csv.googlecode.com/git/src/jquery.csv.js"></script>
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script>
$(function() {
	google.load("visualization", "1", {packages:["corechart"]});

    var csv = $('#textInput').val();
    var data = $.csv.toArrays(csv, {
        onParseValue: $.csv.hooks.castToScalar
    });

    // Convert data for bar chart (summing all digits)
    var timeData = {};	// type -> table
    var funcRowMap;
    var maxDigit = 0;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
      var digit = data[i][2];
   		var time = data[i][3];
   		if (timeData[type] == null) {
   			timeData[type] = [["Function", "Time (ns)"/*, { role: "style" }*/]];
        if (digit != 0)
   			  funcRowMap = {};
   		}

   		var table = timeData[type];
   		
      if (digit != 0) {
     		if (funcRowMap[func] == null)
     			funcRowMap[func] = table.push([func, 0]) - 1;
     		
     		table[funcRowMap[func]][1] += time;
      }
      else 
        table.push([func, time]);

      maxDigit = Math.max(maxDigit, digit);
    }

    // Compute average
    for (var type in timeData) {
      var table = timeData[type];
      for (var i = 1; i < table.length; i++)
        table[i][1] /= maxDigit;
    }

    // Convert data for drawing line chart per random digit
    var timeDigitData = {}; // type -> table
    var funcColumnMap;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
		  var digit = data[i][2];
   		var time = data[i][3];

      if (digit == 0)
        continue;

   		if (timeDigitData[type] == null) {
   			timeDigitData[type] = [["Digit"]];
   			funcColumnMap = {};
   		}

   		var table = timeDigitData[type];

   		if (funcColumnMap[func] == null)
   			funcColumnMap[func] = table[0].push(func) - 1;

   		var row;
   		for (row = 1; row < table.length; row++)
   			if (table[row][0] == digit)
   				break;

    	if (row == table.length)
    		table.push([digit]);

		table[row][funcColumnMap[func]] = time;
	}

	for (var type in timeData) {
		$("#main").append(
      $("<a>", {name: type}),
      $("<h2>", {style: "padding-top: 70px; margin-top: -70px;"}).append(type)
    );

    $("#section").append($("<li>").append($("<a>", {href: "#" + type}).append(type)));

		drawTable(type, timeData[type]);
		drawBarChart(type, timeData[type]);
    if (timeDigitData[type] != null)
		  drawDigitChart(type, timeDigitData[type]);
	}

	$(".chart").each(function() {
		var chart = $(this);
		var d = $("#downloadDD").clone().css("display", "");
		$('li a', d).each(function() {
	        $(this).click(function() {
	            var svg = chart[0].getElementsByTagName('svg')[0].parentNode.innerHTML;
	            svg=sanitize(svg);
	            $('#imageFilename').val($("#title").html() + "_" + chart.data("filename"));
	            $('#imageGetFormTYPE').val($(this).attr('dltype'));
	            $('#imageGetFormSVG').val(svg);
	            $('#imageGetForm').submit();
	        });
	    });		
		$(this).after(d);
	});

  // Add configurations
  var thisConfig = "unknown_win64_vc2019";
  var configurations = ["corei7920@2.67_cygwin32_gcc4.8","corei7920@2.67_cygwin64_gcc4.8","corei7920@2.67_win32_vc2013","corei7920@2.67_win64_vc2013","unknown_mac32_clang7.0","unknown_mac64_clang7.0","unknown_win64_vc2019"];

  for (var i in configurations) {
    var c = configurations[i];
    $("#configuration").append($("<li>", {class : (c == thisConfig ? "active" : "")}).append($("<a>", {href: c + ".html"}).append(c)));
  }
});

function drawTable(type, timeData) {
	var data = google.visualization.arrayToDataTable(timeData);
    data.addColumn('number', 'Speedup');
    data.sort([{ column: 1, desc: true }]);
    var formatter1 = new google.visualization.NumberFormat({ fractionDigits: 3 });
    formatter1.format(data, 1);

	var div = document.createElement("div");
	div.className = "tablechart";
	$("#main").append(div);
    var table = new google.visualization.Table(div);
    redrawTable(0);
    table.setSelection([{ row: 0, column: null}]);

    function redrawTable(selectedRow) {
        // Compute relative time using the first row as basis
        var basis = data.getValue(selectedRow, 1);
        for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
            data.setValue(rowIndex, 2, basis / data.getValue(rowIndex, 1));

        var formatter = new google.visualization.NumberFormat({suffix: 'x'});
        formatter.format(data, 2); // Apply formatter to second column

        table.draw(data);
    }

    google.visualization.events.addListener(table, 'select',
    function() {
        var selection = table.getSelection();
        if (selection.length > 0) {
            var item = selection[0];
            if (item.row != null)
                redrawTable(item.row);
        }
    });

}

function drawBarChart(type, timeData) {
    var defaultColors = ["#3366cc","#dc3912","#ff9900","#109618","#990099","#0099c6","#dd4477","#66aa00","#b82e2e","#316395","#994499","#22aa99","#aaaa11","#6633cc","#e67300","#8b0707","#651067","#329262","#5574a6","#3b3eac","#b77322","#16d620","#b91383","#f4359e","#9c5935","#a9c413","#2a778d","#668d1c","#bea413","#0c5922","#743411"];

	var data = google.visualization.arrayToDataTable(timeData);
	data.addColumn({ type: "string", role: "style" })
	for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
		data.setValue(rowIndex, 2, defaultColors[rowIndex]);

    data.sort([{ column: 1, desc: true }]);
	var options = { 
		title: type,
		chartArea: {'width': '70%', 'height': '70%'},
		width: 800,
		height: 300,
		legend: { position: "none" },
		hAxis: { title: "Time (ns)" }
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_time");
	$("#main").append(div);
	var chart = new google.visualization.BarChart(div);

	chart.draw(data, options);
}

function drawDigitChart(type, timeDigitData) {
	var data = google.visualization.arrayToDataTable(timeDigitData);

	var options = { 
		title: type,
		chartArea: {'width': '70%', 'height': '80%'},
		hAxis: {
			title: "Digit",
			gridlines: { count: timeDigitData.length - 1 },
			maxAlternation: 1,
			minTextSpacing: 0
		},
		vAxis: {
			title: "Time (ns) in log scale",
			logScale: true,
			minorGridlines: { count: 10 },
      baseline: 0
		},
		width: 800,
		height: 600
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_timedigit");
	$("#main").append(div);
	var chart = new google.visualization.LineChart(div);

	chart.draw(data, options);
}

// http://jsfiddle.net/P6XXM/
function sanitize(svg) {
    svg = svg
        .replace(/\<svg/,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1"')
        .replace(/zIndex="[^"]+"/g, '')
        .replace(/isShadow="[^"]+"/g, '')
        .replace(/symbolName="[^"]+"/g, '')
        .replace(/jQuery[0-9]+="[^"]+"/g, '')
        .replace(/isTracker="[^"]+"/g, '')
        .replace(/url\([^#]+#/g, 'url(#')
        .replace('<svg xmlns:xlink="http://www.w3.org/1999/xlink" ', '<svg ')
        .replace(/ href=/g, ' xlink:href=')
    /*.replace(/preserveAspectRatio="none">/g, 'preserveAspectRatio="none"/>')*/
    /* This fails in IE < 8
    .replace(/([0-9]+)\.([0-9]+)/g, function(s1, s2, s3) { // round off to save weight
    return s2 +'.'+ s3[0];
    })*/

    // IE specific
        .replace(/id=([^" >]+)/g, 'id="$1"')
        .replace(/class=([^" ]+)/g, 'class="$1"')
        .replace(/ transform /g, ' ')
        .replace(/:(path|rect)/g, '$1')
        .replace(/<img ([^>]*)>/gi, '<image $1 />')
        .replace(/<\/image>/g, '') // remove closing tags for images as they'll never have any content
        .replace(/<image ([^>]*)([^\/])>/gi, '<image $1$2 />') // closes image tags for firefox
        .replace(/width=(\d+)/g, 'width="$1"')
        .replace(/height=(\d+)/g, 'height="$1"')
        .replace(/hc-svg-href="/g, 'xlink:href="')
        .replace(/style="([^"]+)"/g, function (s) {
            return s.toLowerCase();
        });

    // IE9 beta bugs with innerHTML. Test again with final IE9.
    svg = svg.replace(/(url\(#highcharts-[0-9]+)&quot;/g, '$1')
        .replace(/&quot;/g, "'");
    if (svg.match(/ xmlns="/g).length == 2) {
        svg = svg.replace(/xmlns="[^"]+"/, '');
    }

    return svg;
}
</script>
<style type="text/css">
@media (min-width: 800px) {
  .container {
    max-width: 800px;
  }
}
textarea {
	font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace;
}
.tablechart {
	width: 700px;
	margin: auto;
	padding-top: 20px;
	padding-bottom: 20px;
}
.chart {
	padding-top: 20px;
	padding-bottom: 20px;
}
body { padding-top: 70px; }
</style>
</head>
<body>
<div class="container">
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://github.com/miloyip/dtoa-benchmark"><span class="glyphicon glyphicon-home"></span> dtoa-benchmark</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Configuration <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="configuration">
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Section <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="section">
          </ul>
        </li>
      </ul>
      <p class="navbar-text navbar-right">Developed by <a href="https://github.com/miloyip" class="navbar-link">Milo Yip</a></p>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
<div class="page-header">
<h1 id="title">unknown_win64_vc2019</h1>
</div>
<div id="main"></div>
<h2>Source CSV</h2>
<textarea id="textInput" class="form-control" rows="5" readonly>
Type,Function,Digit,Time(ns)
randomdigit,doubleconv,1,111.469341
randomdigit,doubleconv,2,122.066714
randomdigit,doubleconv,3,131.223632
randomdigit,doubleconv,4,138.546249
randomdigit,doubleconv,5,142.247671
randomdigit,doubleconv,6,145.507841
randomdigit,doubleconv,7,151.689034
randomdigit,doubleconv,8,154.128691
randomdigit,doubleconv,9,154.154218
randomdigit,doubleconv,10,155.882764
randomdigit,doubleconv,11,158.347948
randomdigit,doubleconv,12,161.265325
randomdigit,doubleconv,13,163.077746
randomdigit,doubleconv,14,170.072158
randomdigit,doubleconv,15,176.089248
randomdigit,doubleconv,16,181.209246
randomdigit,doubleconv,17,189.961378
randomdigit,emyg,1,72.088394
randomdigit,emyg,2,80.705597
randomdigit,emyg,3,83.765196
randomdigit,emyg,4,87.050893
randomdigit,emyg,5,90.303768
randomdigit,emyg,6,95.675389
randomdigit,emyg,7,97.972824
randomdigit,emyg,8,99.555501
randomdigit,emyg,9,102.881311
randomdigit,emyg,10,105.787748
randomdigit,emyg,11,109.737148
randomdigit,emyg,12,111.002560
randomdigit,emyg,13,114.981134
randomdigit,emyg,14,118.055320
randomdigit,emyg,15,121.738509
randomdigit,emyg,16,124.232867
randomdigit,emyg,17,127.412808
randomdigit,floaxie,1,49.354731
randomdigit,floaxie,2,56.567946
randomdigit,floaxie,3,66.811587
randomdigit,floaxie,4,73.474148
randomdigit,floaxie,5,81.708445
randomdigit,floaxie,6,89.319153
randomdigit,floaxie,7,99.147068
randomdigit,floaxie,8,107.439713
randomdigit,floaxie,9,116.137144
randomdigit,floaxie,10,119.794806
randomdigit,floaxie,11,123.237312
randomdigit,floaxie,12,124.196399
randomdigit,floaxie,13,125.531099
randomdigit,floaxie,14,126.975201
randomdigit,floaxie,15,127.500329
randomdigit,floaxie,16,130.720384
randomdigit,floaxie,17,132.729728
randomdigit,fmt,1,165.885721
randomdigit,fmt,2,174.998879
randomdigit,fmt,3,178.893577
randomdigit,fmt,4,182.142806
randomdigit,fmt,5,187.477960
randomdigit,fmt,6,192.094710
randomdigit,fmt,7,191.150209
randomdigit,fmt,8,194.723996
randomdigit,fmt,9,199.541315
randomdigit,fmt,10,202.881712
randomdigit,fmt,11,203.775159
randomdigit,fmt,12,212.811735
randomdigit,fmt,13,209.562506
randomdigit,fmt,14,214.554868
randomdigit,fmt,15,217.596234
randomdigit,fmt,16,220.174466
randomdigit,fmt,17,227.745061
randomdigit,fpconv,1,138.451434
randomdigit,fpconv,2,155.868177
randomdigit,fpconv,3,163.449711
randomdigit,fpconv,4,171.837171
randomdigit,fpconv,5,182.729929
randomdigit,fpconv,6,188.841834
randomdigit,fpconv,7,194.538013
randomdigit,fpconv,8,197.156359
randomdigit,fpconv,9,199.847640
randomdigit,fpconv,10,201.080232
randomdigit,fpconv,11,205.955899
randomdigit,fpconv,12,204.734247
randomdigit,fpconv,13,209.857891
randomdigit,fpconv,14,216.564212
randomdigit,fpconv,15,212.206380
randomdigit,fpconv,16,217.804097
randomdigit,fpconv,17,227.515317
randomdigit,grisu2,1,139.767901
randomdigit,grisu2,2,145.748524
randomdigit,grisu2,3,143.246873
randomdigit,grisu2,4,146.532569
randomdigit,grisu2,5,147.881856
randomdigit,grisu2,6,152.863278
randomdigit,grisu2,7,153.049261
randomdigit,grisu2,8,159.722762
randomdigit,grisu2,9,162.607318
randomdigit,grisu2,10,166.651533
randomdigit,grisu2,11,171.461559
randomdigit,grisu2,12,174.065318
randomdigit,grisu2,13,178.003777
randomdigit,grisu2,14,178.521612
randomdigit,grisu2,15,182.241268
randomdigit,grisu2,16,186.121380
randomdigit,grisu2,17,193.192373
randomdigit,jkj,1,42.444193
randomdigit,jkj,2,46.076328
randomdigit,jkj,3,46.306072
randomdigit,jkj,4,46.211257
randomdigit,jkj,5,48.508691
randomdigit,jkj,6,48.446697
randomdigit,jkj,7,49.270856
randomdigit,jkj,8,47.221399
randomdigit,jkj,9,47.841341
randomdigit,jkj,10,50.262765
randomdigit,jkj,11,52.275755
randomdigit,jkj,12,52.673248
randomdigit,jkj,13,53.030626
randomdigit,jkj,14,54.930568
randomdigit,jkj,15,55.900596
randomdigit,jkj,16,54.113703
randomdigit,jkj,17,59.682247
randomdigit,milo,1,66.479736
randomdigit,milo,2,70.863095
randomdigit,milo,3,74.779674
randomdigit,milo,4,76.723377
randomdigit,milo,5,82.029357
randomdigit,milo,6,86.197560
randomdigit,milo,7,89.654652
randomdigit,milo,8,92.360519
randomdigit,milo,9,95.380005
randomdigit,milo,10,97.754021
randomdigit,milo,11,100.985016
randomdigit,milo,12,104.431168
randomdigit,milo,13,107.990368
randomdigit,milo,14,108.854641
randomdigit,milo,15,111.932474
randomdigit,milo,16,114.791504
randomdigit,milo,17,119.390020
randomdigit,milo_only_Grisu2,1,48.413877
randomdigit,milo_only_Grisu2,2,51.721453
randomdigit,milo_only_Grisu2,3,54.255925
randomdigit,milo_only_Grisu2,4,60.309483
randomdigit,milo_only_Grisu2,5,62.632444
randomdigit,milo_only_Grisu2,6,66.330220
randomdigit,milo_only_Grisu2,7,69.451814
randomdigit,milo_only_Grisu2,8,73.667424
randomdigit,milo_only_Grisu2,9,74.309247
randomdigit,milo_only_Grisu2,10,78.597792
randomdigit,milo_only_Grisu2,11,80.038247
randomdigit,milo_only_Grisu2,12,83.411464
randomdigit,milo_only_Grisu2,13,85.829241
randomdigit,milo_only_Grisu2,14,87.889639
randomdigit,milo_only_Grisu2,15,90.905477
randomdigit,milo_only_Grisu2,16,92.914821
randomdigit,milo_only_Grisu2,17,95.307070
randomdigit,null,1,1.393048
randomdigit,null,2,1.393048
randomdigit,null,3,1.393048
randomdigit,null,4,1.393048
randomdigit,null,5,1.393048
randomdigit,null,6,1.393048
randomdigit,null,7,1.393048
randomdigit,null,8,1.393048
randomdigit,null,9,1.393048
randomdigit,null,10,1.393048
randomdigit,null,11,1.433162
randomdigit,null,12,1.433162
randomdigit,null,13,1.429515
randomdigit,null,14,1.433162
randomdigit,null,15,1.433162
randomdigit,null,16,1.429515
randomdigit,null,17,1.429515
randomdigit,to_chars,1,93.859322
randomdigit,to_chars,2,93.706160
randomdigit,to_chars,3,94.267755
randomdigit,to_chars,4,90.066731
randomdigit,to_chars,5,87.021719
randomdigit,to_chars,6,84.593002
randomdigit,to_chars,7,81.843374
randomdigit,to_chars,8,79.294316
randomdigit,to_chars,9,78.499330
randomdigit,to_chars,10,77.682465
randomdigit,to_chars,11,73.835173
randomdigit,to_chars,12,72.336371
randomdigit,to_chars,13,71.658080
randomdigit,to_chars,14,69.437227
randomdigit,to_chars,15,67.478937
randomdigit,to_chars,16,66.388568
randomdigit,to_chars,17,67.464351
</textarea>
</div>
<div class="row" id="downloadDD" style="display: none">
<div class="btn-group pull-right" >
    <button class="btn dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-picture"></span></button>
    <ul class="dropdown-menu">
        <li><a tabindex="-1" href="#" dltype="image/jpeg">JPEG</a></li>
        <li><a tabindex="-1" href="#" dltype="image/png">PNG</a></li>
        <li><a tabindex="-1" href="#" dltype="application/pdf">PDF</a></li>
        <li><a tabindex="-1" href="#" dltype="image/svg+xml">SVG</a></li>
    </ul>
</div>
</div>
<form method="post" action="http://export.highcharts.com/" id="imageGetForm">
    <input type="hidden" name="filename" id="imageFilename" value="" />
    <input type="hidden" name="type" id="imageGetFormTYPE" value="" />
    <input type="hidden" name="width" value="900" />
    <input type="hidden" name="svg" value="" id="imageGetFormSVG" />
</form>
</div>
</body>
</html>