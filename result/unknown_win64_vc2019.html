<html>
<head>
<script src="http://code.jquery.com/jquery-1.8.2.js"></script>
<script src="http://www.google.com/jsapi?autoload={'modules':[{'name':'visualization','version':'1','packages':['controls', 'charteditor']}]}"></script>
<script src="https://web.archive.org/web/20160324220311/http://jquery-csv.googlecode.com/git/src/jquery.csv.js"></script>
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script>
$(function() {
	google.load("visualization", "1", {packages:["corechart"]});

    var csv = $('#textInput').val();
    var data = $.csv.toArrays(csv, {
        onParseValue: $.csv.hooks.castToScalar
    });

    // Convert data for bar chart (summing all digits)
    var timeData = {};	// type -> table
    var funcRowMap;
    var maxDigit = 0;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
      var digit = data[i][2];
   		var time = data[i][3];
   		if (timeData[type] == null) {
   			timeData[type] = [["Function", "Time (ns)"/*, { role: "style" }*/]];
        if (digit != 0)
   			  funcRowMap = {};
   		}

   		var table = timeData[type];
   		
      if (digit != 0) {
     		if (funcRowMap[func] == null)
     			funcRowMap[func] = table.push([func, 0]) - 1;
     		
     		table[funcRowMap[func]][1] += time;
      }
      else 
        table.push([func, time]);

      maxDigit = Math.max(maxDigit, digit);
    }

    // Compute average
    for (var type in timeData) {
      var table = timeData[type];
      for (var i = 1; i < table.length; i++)
        table[i][1] /= maxDigit;
    }

    // Convert data for drawing line chart per random digit
    var timeDigitData = {}; // type -> table
    var funcColumnMap;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
		  var digit = data[i][2];
   		var time = data[i][3];

      if (digit == 0)
        continue;

   		if (timeDigitData[type] == null) {
   			timeDigitData[type] = [["Digit"]];
   			funcColumnMap = {};
   		}

   		var table = timeDigitData[type];

   		if (funcColumnMap[func] == null)
   			funcColumnMap[func] = table[0].push(func) - 1;

   		var row;
   		for (row = 1; row < table.length; row++)
   			if (table[row][0] == digit)
   				break;

    	if (row == table.length)
    		table.push([digit]);

		table[row][funcColumnMap[func]] = time;
	}

	for (var type in timeData) {
		$("#main").append(
      $("<a>", {name: type}),
      $("<h2>", {style: "padding-top: 70px; margin-top: -70px;"}).append(type)
    );

    $("#section").append($("<li>").append($("<a>", {href: "#" + type}).append(type)));

		drawTable(type, timeData[type]);
		drawBarChart(type, timeData[type]);
    if (timeDigitData[type] != null)
		  drawDigitChart(type, timeDigitData[type]);
	}

	$(".chart").each(function() {
		var chart = $(this);
		var d = $("#downloadDD").clone().css("display", "");
		$('li a', d).each(function() {
	        $(this).click(function() {
	            var svg = chart[0].getElementsByTagName('svg')[0].parentNode.innerHTML;
	            svg=sanitize(svg);
	            $('#imageFilename').val($("#title").html() + "_" + chart.data("filename"));
	            $('#imageGetFormTYPE').val($(this).attr('dltype'));
	            $('#imageGetFormSVG').val(svg);
	            $('#imageGetForm').submit();
	        });
	    });		
		$(this).after(d);
	});

  // Add configurations
  var thisConfig = "unknown_win64_vc2019";
  var configurations = ["corei7920@2.67_cygwin32_gcc4.8","corei7920@2.67_cygwin64_gcc4.8","corei7920@2.67_win32_vc2013","corei7920@2.67_win64_vc2013","unknown_mac32_clang7.0","unknown_mac64_clang7.0","unknown_win64_vc2019"];

  for (var i in configurations) {
    var c = configurations[i];
    $("#configuration").append($("<li>", {class : (c == thisConfig ? "active" : "")}).append($("<a>", {href: c + ".html"}).append(c)));
  }
});

function drawTable(type, timeData) {
	var data = google.visualization.arrayToDataTable(timeData);
    data.addColumn('number', 'Speedup');
    data.sort([{ column: 1, desc: true }]);
    var formatter1 = new google.visualization.NumberFormat({ fractionDigits: 3 });
    formatter1.format(data, 1);

	var div = document.createElement("div");
	div.className = "tablechart";
	$("#main").append(div);
    var table = new google.visualization.Table(div);
    redrawTable(0);
    table.setSelection([{ row: 0, column: null}]);

    function redrawTable(selectedRow) {
        // Compute relative time using the first row as basis
        var basis = data.getValue(selectedRow, 1);
        for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
            data.setValue(rowIndex, 2, basis / data.getValue(rowIndex, 1));

        var formatter = new google.visualization.NumberFormat({suffix: 'x'});
        formatter.format(data, 2); // Apply formatter to second column

        table.draw(data);
    }

    google.visualization.events.addListener(table, 'select',
    function() {
        var selection = table.getSelection();
        if (selection.length > 0) {
            var item = selection[0];
            if (item.row != null)
                redrawTable(item.row);
        }
    });

}

function drawBarChart(type, timeData) {
    var defaultColors = ["#3366cc","#dc3912","#ff9900","#109618","#990099","#0099c6","#dd4477","#66aa00","#b82e2e","#316395","#994499","#22aa99","#aaaa11","#6633cc","#e67300","#8b0707","#651067","#329262","#5574a6","#3b3eac","#b77322","#16d620","#b91383","#f4359e","#9c5935","#a9c413","#2a778d","#668d1c","#bea413","#0c5922","#743411"];

	var data = google.visualization.arrayToDataTable(timeData);
	data.addColumn({ type: "string", role: "style" })
	for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
		data.setValue(rowIndex, 2, defaultColors[rowIndex]);

    data.sort([{ column: 1, desc: true }]);
	var options = { 
		title: type,
		chartArea: {'width': '70%', 'height': '70%'},
		width: 800,
		height: 300,
		legend: { position: "none" },
		hAxis: { title: "Time (ns)" }
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_time");
	$("#main").append(div);
	var chart = new google.visualization.BarChart(div);

	chart.draw(data, options);
}

function drawDigitChart(type, timeDigitData) {
	var data = google.visualization.arrayToDataTable(timeDigitData);

	var options = { 
		title: type,
		chartArea: {'width': '70%', 'height': '80%'},
		hAxis: {
			title: "Digit",
			gridlines: { count: timeDigitData.length - 1 },
			maxAlternation: 1,
			minTextSpacing: 0
		},
		vAxis: {
			title: "Time (ns) in log scale",
			logScale: true,
			minorGridlines: { count: 10 },
      baseline: 0
		},
		width: 800,
		height: 600
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_timedigit");
	$("#main").append(div);
	var chart = new google.visualization.LineChart(div);

	chart.draw(data, options);
}

// http://jsfiddle.net/P6XXM/
function sanitize(svg) {
    svg = svg
        .replace(/\<svg/,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1"')
        .replace(/zIndex="[^"]+"/g, '')
        .replace(/isShadow="[^"]+"/g, '')
        .replace(/symbolName="[^"]+"/g, '')
        .replace(/jQuery[0-9]+="[^"]+"/g, '')
        .replace(/isTracker="[^"]+"/g, '')
        .replace(/url\([^#]+#/g, 'url(#')
        .replace('<svg xmlns:xlink="http://www.w3.org/1999/xlink" ', '<svg ')
        .replace(/ href=/g, ' xlink:href=')
    /*.replace(/preserveAspectRatio="none">/g, 'preserveAspectRatio="none"/>')*/
    /* This fails in IE < 8
    .replace(/([0-9]+)\.([0-9]+)/g, function(s1, s2, s3) { // round off to save weight
    return s2 +'.'+ s3[0];
    })*/

    // IE specific
        .replace(/id=([^" >]+)/g, 'id="$1"')
        .replace(/class=([^" ]+)/g, 'class="$1"')
        .replace(/ transform /g, ' ')
        .replace(/:(path|rect)/g, '$1')
        .replace(/<img ([^>]*)>/gi, '<image $1 />')
        .replace(/<\/image>/g, '') // remove closing tags for images as they'll never have any content
        .replace(/<image ([^>]*)([^\/])>/gi, '<image $1$2 />') // closes image tags for firefox
        .replace(/width=(\d+)/g, 'width="$1"')
        .replace(/height=(\d+)/g, 'height="$1"')
        .replace(/hc-svg-href="/g, 'xlink:href="')
        .replace(/style="([^"]+)"/g, function (s) {
            return s.toLowerCase();
        });

    // IE9 beta bugs with innerHTML. Test again with final IE9.
    svg = svg.replace(/(url\(#highcharts-[0-9]+)&quot;/g, '$1')
        .replace(/&quot;/g, "'");
    if (svg.match(/ xmlns="/g).length == 2) {
        svg = svg.replace(/xmlns="[^"]+"/, '');
    }

    return svg;
}
</script>
<style type="text/css">
@media (min-width: 800px) {
  .container {
    max-width: 800px;
  }
}
textarea {
	font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace;
}
.tablechart {
	width: 700px;
	margin: auto;
	padding-top: 20px;
	padding-bottom: 20px;
}
.chart {
	padding-top: 20px;
	padding-bottom: 20px;
}
body { padding-top: 70px; }
</style>
</head>
<body>
<div class="container">
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://github.com/miloyip/dtoa-benchmark"><span class="glyphicon glyphicon-home"></span> dtoa-benchmark</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Configuration <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="configuration">
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Section <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="section">
          </ul>
        </li>
      </ul>
      <p class="navbar-text navbar-right">Developed by <a href="https://github.com/miloyip" class="navbar-link">Milo Yip</a></p>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
<div class="page-header">
<h1 id="title">unknown_win64_vc2019</h1>
</div>
<div id="main"></div>
<h2>Source CSV</h2>
<textarea id="textInput" class="form-control" rows="5" readonly>
Type,Function,Digit,Time(ns)
randomdigit,doubleconv,1,100.594964
randomdigit,doubleconv,2,110.944375
randomdigit,doubleconv,3,117.154751
randomdigit,doubleconv,4,123.656865
randomdigit,doubleconv,5,127.445814
randomdigit,doubleconv,6,131.588496
randomdigit,doubleconv,7,133.572316
randomdigit,doubleconv,8,137.160695
randomdigit,doubleconv,9,135.260750
randomdigit,doubleconv,10,138.535511
randomdigit,doubleconv,11,141.868619
randomdigit,doubleconv,12,142.269759
randomdigit,doubleconv,13,143.597168
randomdigit,doubleconv,14,154.373246
randomdigit,doubleconv,15,153.862704
randomdigit,doubleconv,16,159.952738
randomdigit,doubleconv,17,170.422492
randomdigit,emyg,1,67.187298
randomdigit,emyg,2,69.798354
randomdigit,emyg,3,72.766790
randomdigit,emyg,4,76.402577
randomdigit,emyg,5,79.265257
randomdigit,emyg,6,83.367825
randomdigit,emyg,7,84.465490
randomdigit,emyg,8,87.608969
randomdigit,emyg,9,90.012162
randomdigit,emyg,10,92.630512
randomdigit,emyg,11,95.664589
randomdigit,emyg,12,99.030518
randomdigit,emyg,13,100.387100
randomdigit,emyg,14,105.736849
randomdigit,emyg,15,108.180156
randomdigit,emyg,16,107.651380
randomdigit,emyg,17,113.260046
randomdigit,fmt,1,148.027941
randomdigit,fmt,2,156.382593
randomdigit,fmt,3,159.121285
randomdigit,fmt,4,165.462943
randomdigit,fmt,5,169.981238
randomdigit,fmt,6,171.775427
randomdigit,fmt,7,170.823632
randomdigit,fmt,8,173.121070
randomdigit,fmt,9,175.969163
randomdigit,fmt,10,180.585920
randomdigit,fmt,11,181.183983
randomdigit,fmt,12,183.375666
randomdigit,fmt,13,185.323018
randomdigit,fmt,14,188.338861
randomdigit,fmt,15,189.502167
randomdigit,fmt,16,192.299207
randomdigit,fmt,17,197.831291
randomdigit,fpconv,1,125.863135
randomdigit,fpconv,2,134.246960
randomdigit,fpconv,3,143.841499
randomdigit,fpconv,4,151.605380
randomdigit,fpconv,5,157.990799
randomdigit,fpconv,6,164.657016
randomdigit,fpconv,7,169.007561
randomdigit,fpconv,8,172.792864
randomdigit,fpconv,9,174.576114
randomdigit,fpconv,10,176.614634
randomdigit,fpconv,11,178.434351
randomdigit,fpconv,12,180.768256
randomdigit,fpconv,13,182.901591
randomdigit,fpconv,14,185.749685
randomdigit,fpconv,15,188.306041
randomdigit,fpconv,16,191.526101
randomdigit,fpconv,17,199.016478
randomdigit,grisu2,1,123.033275
randomdigit,grisu2,2,130.658581
randomdigit,grisu2,3,129.221770
randomdigit,grisu2,4,130.808096
randomdigit,grisu2,5,131.916701
randomdigit,grisu2,6,135.574369
randomdigit,grisu2,7,137.707704
randomdigit,grisu2,8,140.384401
randomdigit,grisu2,9,143.695630
randomdigit,grisu2,10,145.781557
randomdigit,grisu2,11,149.880479
randomdigit,grisu2,12,153.439684
randomdigit,grisu2,13,155.259401
randomdigit,grisu2,14,157.079118
randomdigit,grisu2,15,160.182482
randomdigit,grisu2,16,164.416332
randomdigit,grisu2,17,171.064316
randomdigit,jkl,1,36.073423
randomdigit,jkl,2,39.362771
randomdigit,jkl,3,40.599011
randomdigit,jkl,4,40.121290
randomdigit,jkl,5,41.324710
randomdigit,jkl,6,41.277303
randomdigit,jkl,7,42.385908
randomdigit,jkl,8,41.645622
randomdigit,jkl,9,42.761520
randomdigit,jkl,10,44.198331
randomdigit,jkl,11,45.314229
randomdigit,jkl,12,47.017251
randomdigit,jkl,13,45.872179
randomdigit,jkl,14,47.323576
randomdigit,jkl,15,48.227964
randomdigit,jkl,16,48.516056
randomdigit,jkl,17,52.024207
randomdigit,milo,1,58.340338
randomdigit,milo,2,63.726554
randomdigit,milo,3,67.344107
randomdigit,milo,4,70.637101
randomdigit,milo,5,74.130666
randomdigit,milo,6,76.205654
randomdigit,milo,7,78.780243
randomdigit,milo,8,81.194376
randomdigit,milo,9,84.206572
randomdigit,milo,10,86.671760
randomdigit,milo,11,90.117917
randomdigit,milo,12,92.068916
randomdigit,milo,13,94.304359
randomdigit,milo,14,97.309263
randomdigit,milo,15,98.764307
randomdigit,milo,16,101.211260
randomdigit,milo,17,106.174456
randomdigit,milo_only_Grisu2,1,43.961294
randomdigit,milo_only_Grisu2,2,47.429331
randomdigit,milo_only_Grisu2,3,50.226371
randomdigit,milo_only_Grisu2,4,53.399023
randomdigit,milo_only_Grisu2,5,56.247117
randomdigit,milo_only_Grisu2,6,58.854527
randomdigit,milo_only_Grisu2,7,61.275953
randomdigit,milo_only_Grisu2,8,63.660913
randomdigit,milo_only_Grisu2,9,66.078693
randomdigit,milo_only_Grisu2,10,68.627755
randomdigit,milo_only_Grisu2,11,72.314596
randomdigit,milo_only_Grisu2,12,73.539896
randomdigit,milo_only_Grisu2,13,75.377846
randomdigit,milo_only_Grisu2,14,77.919615
randomdigit,milo_only_Grisu2,15,79.640870
randomdigit,milo_only_Grisu2,16,81.701271
randomdigit,milo_only_Grisu2,17,83.940361
randomdigit,null,1,1.316468
randomdigit,null,2,1.316468
randomdigit,null,3,1.320115
randomdigit,null,4,1.316468
randomdigit,null,5,1.320115
randomdigit,null,6,1.316468
randomdigit,null,7,1.316468
randomdigit,null,8,1.316468
randomdigit,null,9,1.316468
randomdigit,null,10,1.320115
randomdigit,null,11,1.320115
randomdigit,null,12,1.320115
randomdigit,null,13,1.320115
randomdigit,null,14,1.316468
randomdigit,null,15,1.316468
randomdigit,null,16,1.316468
randomdigit,null,17,1.316468
randomdigit,to_chars,1,83.105261
randomdigit,to_chars,2,84.046117
randomdigit,to_chars,3,82.995859
randomdigit,to_chars,4,79.732039
randomdigit,to_chars,5,76.391637
randomdigit,to_chars,6,74.608387
randomdigit,to_chars,7,72.026504
randomdigit,to_chars,8,69.962457
randomdigit,to_chars,9,68.602228
randomdigit,to_chars,10,68.368837
randomdigit,to_chars,11,65.608265
randomdigit,to_chars,12,63.522337
randomdigit,to_chars,13,62.373618
randomdigit,to_chars,14,60.743531
randomdigit,to_chars,15,59.266607
randomdigit,to_chars,16,57.942845
randomdigit,to_chars,17,58.821706
</textarea>
</div>
<div class="row" id="downloadDD" style="display: none">
<div class="btn-group pull-right" >
    <button class="btn dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-picture"></span></button>
    <ul class="dropdown-menu">
        <li><a tabindex="-1" href="#" dltype="image/jpeg">JPEG</a></li>
        <li><a tabindex="-1" href="#" dltype="image/png">PNG</a></li>
        <li><a tabindex="-1" href="#" dltype="application/pdf">PDF</a></li>
        <li><a tabindex="-1" href="#" dltype="image/svg+xml">SVG</a></li>
    </ul>
</div>
</div>
<form method="post" action="http://export.highcharts.com/" id="imageGetForm">
    <input type="hidden" name="filename" id="imageFilename" value="" />
    <input type="hidden" name="type" id="imageGetFormTYPE" value="" />
    <input type="hidden" name="width" value="900" />
    <input type="hidden" name="svg" value="" id="imageGetFormSVG" />
</form>
</div>
</body>
</html>