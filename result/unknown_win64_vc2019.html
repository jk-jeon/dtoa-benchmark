<html>
<head>
<script src="http://code.jquery.com/jquery-1.8.2.js"></script>
<script src="http://www.google.com/jsapi?autoload={%22modules%22:[{%22name%22:%22visualization%22,%22version%22:%221%22,%22packages%22:[%22controls%22,%22charteditor%22]}]}"></script>
<script src="jquery.csv.js"></script>
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script>
$(function() {
	google.load("visualization", "1", {packages:["corechart"]});
  google.setOnLoadCallback(function() {

    var csv = $('#textInput').val();
    var data = $.csv.toArrays(csv, {
        onParseValue: $.csv.hooks.castToScalar
    });

    // Convert data for bar chart (summing all digits)
    var timeData = {};	// type -> table
    var funcRowMap;
    var maxDigit = 0;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
      var digit = data[i][2];
   		var time = data[i][3];
   		if (timeData[type] == null) {
   			timeData[type] = [["Function", "Time (ns)"/*, { role: "style" }*/]];
        if (digit != 0)
   			  funcRowMap = {};
   		}

   		var table = timeData[type];
   		
      if (digit != 0) {
     		if (funcRowMap[func] == null)
     			funcRowMap[func] = table.push([func, 0]) - 1;
     		
     		table[funcRowMap[func]][1] += time;
      }
      else 
        table.push([func, time]);

      maxDigit = Math.max(maxDigit, digit);
    }

    // Compute average
    for (var type in timeData) {
      var table = timeData[type];
      for (var i = 1; i < table.length; i++)
        table[i][1] /= maxDigit;
    }

    // Convert data for drawing line chart per random digit
    var timeDigitData = {}; // type -> table
    var funcColumnMap;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
		  var digit = data[i][2];
   		var time = data[i][3];

      if (digit == 0)
        continue;

   		if (timeDigitData[type] == null) {
   			timeDigitData[type] = [["Digit"]];
   			funcColumnMap = {};
   		}

   		var table = timeDigitData[type];

   		if (funcColumnMap[func] == null)
   			funcColumnMap[func] = table[0].push(func) - 1;

   		var row;
   		for (row = 1; row < table.length; row++)
   			if (table[row][0] == digit)
   				break;

    	if (row == table.length)
    		table.push([digit]);

		table[row][funcColumnMap[func]] = time;
	}

	for (var type in timeData) {
		$("#main").append(
      $("<a>", {name: type}),
      $("<h2>", {style: "padding-top: 70px; margin-top: -70px;"}).append(type)
    );

    $("#section").append($("<li>").append($("<a>", {href: "#" + type}).append(type)));

		drawTable(type, timeData[type]);
		drawBarChart(type, timeData[type]);
    if (timeDigitData[type] != null)
		  drawDigitChart(type, timeDigitData[type]);
	}

	$(".chart").each(function() {
		var chart = $(this);
		var d = $("#downloadDD").clone().css("display", "");
		$('li a', d).each(function() {
	        $(this).click(function() {
	            var svg = chart[0].getElementsByTagName('svg')[0].parentNode.innerHTML;
	            svg=sanitize(svg);
	            $('#imageFilename').val($("#title").html() + "_" + chart.data("filename"));
	            $('#imageGetFormTYPE').val($(this).attr('dltype'));
	            $('#imageGetFormSVG').val(svg);
	            $('#imageGetForm').submit();
	        });
	    });		
		$(this).after(d);
	});

  // Add configurations
  var thisConfig = "unknown_win64_vc2019";
  var configurations = ["corei7920@2.67_cygwin32_gcc4.8","corei7920@2.67_cygwin64_gcc4.8","corei7920@2.67_win32_vc2013","corei7920@2.67_win64_vc2013","unknown_mac32_clang7.0","unknown_mac64_clang7.0","unknown_win64_vc2019"];

  for (var i in configurations) {
    var c = configurations[i];
    $("#configuration").append($("<li>", {class : (c == thisConfig ? "active" : "")}).append($("<a>", {href: c + ".html"}).append(c)));
  }
  })
});

function drawTable(type, timeData) {
	var data = google.visualization.arrayToDataTable(timeData);
    data.addColumn('number', 'Speedup');
    data.sort([{ column: 1, desc: true }]);
    var formatter1 = new google.visualization.NumberFormat({ fractionDigits: 3 });
    formatter1.format(data, 1);

	var div = document.createElement("div");
	div.className = "tablechart";
	$("#main").append(div);
    var table = new google.visualization.Table(div);
    redrawTable(0);
    table.setSelection([{ row: 0, column: null}]);

    function redrawTable(selectedRow) {
        // Compute relative time using the first row as basis
        var basis = data.getValue(selectedRow, 1);
        for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
            data.setValue(rowIndex, 2, basis / data.getValue(rowIndex, 1));

        var formatter = new google.visualization.NumberFormat({suffix: 'x'});
        formatter.format(data, 2); // Apply formatter to second column

        table.draw(data);
    }

    google.visualization.events.addListener(table, 'select',
    function() {
        var selection = table.getSelection();
        if (selection.length > 0) {
            var item = selection[0];
            if (item.row != null)
                redrawTable(item.row);
        }
    });

}

function drawBarChart(type, timeData) {
    var defaultColors = ["#3366cc","#dc3912","#ff9900","#109618","#990099","#0099c6","#dd4477","#66aa00","#b82e2e","#316395","#994499","#22aa99","#aaaa11","#6633cc","#e67300","#8b0707","#651067","#329262","#5574a6","#3b3eac","#b77322","#16d620","#b91383","#f4359e","#9c5935","#a9c413","#2a778d","#668d1c","#bea413","#0c5922","#743411"];

	var data = google.visualization.arrayToDataTable(timeData);
	data.addColumn({ type: "string", role: "style" })
	for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
		data.setValue(rowIndex, 2, defaultColors[rowIndex]);

    data.sort([{ column: 1, desc: true }]);
	var options = { 
		title: type,
		chartArea: {'width': '70%', 'height': '70%'},
		width: 800,
		height: 300,
		legend: { position: "none" },
		hAxis: { title: "Time (ns)" }
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_time");
	$("#main").append(div);
	var chart = new google.visualization.BarChart(div);

	chart.draw(data, options);
}

function drawDigitChart(type, timeDigitData) {
	var data = google.visualization.arrayToDataTable(timeDigitData);

	var options = { 
		title: type,
		chartArea: {'width': '70%', 'height': '80%'},
		hAxis: {
			title: "Digit",
			gridlines: { count: timeDigitData.length - 1 },
			maxAlternation: 1,
			minTextSpacing: 0
		},
		vAxis: {
			title: "Time (ns) in log scale",
			logScale: true,
			minorGridlines: { count: 10 },
      baseline: 0
		},
		width: 800,
		height: 600
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_timedigit");
	$("#main").append(div);
	var chart = new google.visualization.LineChart(div);

	chart.draw(data, options);
}

// http://jsfiddle.net/P6XXM/
function sanitize(svg) {
    svg = svg
        .replace(/\<svg/,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1"')
        .replace(/zIndex="[^"]+"/g, '')
        .replace(/isShadow="[^"]+"/g, '')
        .replace(/symbolName="[^"]+"/g, '')
        .replace(/jQuery[0-9]+="[^"]+"/g, '')
        .replace(/isTracker="[^"]+"/g, '')
        .replace(/url\([^#]+#/g, 'url(#')
        .replace('<svg xmlns:xlink="http://www.w3.org/1999/xlink" ', '<svg ')
        .replace(/ href=/g, ' xlink:href=')
    /*.replace(/preserveAspectRatio="none">/g, 'preserveAspectRatio="none"/>')*/
    /* This fails in IE < 8
    .replace(/([0-9]+)\.([0-9]+)/g, function(s1, s2, s3) { // round off to save weight
    return s2 +'.'+ s3[0];
    })*/

    // IE specific
        .replace(/id=([^" >]+)/g, 'id="$1"')
        .replace(/class=([^" ]+)/g, 'class="$1"')
        .replace(/ transform /g, ' ')
        .replace(/:(path|rect)/g, '$1')
        .replace(/<img ([^>]*)>/gi, '<image $1 />')
        .replace(/<\/image>/g, '') // remove closing tags for images as they'll never have any content
        .replace(/<image ([^>]*)([^\/])>/gi, '<image $1$2 />') // closes image tags for firefox
        .replace(/width=(\d+)/g, 'width="$1"')
        .replace(/height=(\d+)/g, 'height="$1"')
        .replace(/hc-svg-href="/g, 'xlink:href="')
        .replace(/style="([^"]+)"/g, function (s) {
            return s.toLowerCase();
        });

    // IE9 beta bugs with innerHTML. Test again with final IE9.
    svg = svg.replace(/(url\(#highcharts-[0-9]+)&quot;/g, '$1')
        .replace(/&quot;/g, "'");
    if (svg.match(/ xmlns="/g).length == 2) {
        svg = svg.replace(/xmlns="[^"]+"/, '');
    }

    return svg;
}
</script>
<style type="text/css">
@media (min-width: 800px) {
  .container {
    max-width: 800px;
  }
}
textarea {
	font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace;
}
.tablechart {
	width: 700px;
	margin: auto;
	padding-top: 20px;
	padding-bottom: 20px;
}
.chart {
	padding-top: 20px;
	padding-bottom: 20px;
}
body { padding-top: 70px; }
</style>
</head>
<body>
<div class="container">
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://github.com/miloyip/dtoa-benchmark"><span class="glyphicon glyphicon-home"></span> dtoa-benchmark</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Configuration <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="configuration">
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Section <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="section">
          </ul>
        </li>
      </ul>
      <p class="navbar-text navbar-right">Developed by <a href="https://github.com/miloyip" class="navbar-link">Milo Yip</a></p>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
<div class="page-header">
<h1 id="title">unknown_win64_vc2019</h1>
</div>
<div id="main"></div>
<h2>Source CSV</h2>
<textarea id="textInput" class="form-control" rows="5" readonly>
  Type,Function,Digit,Time(ns)
randomdigit,doubleconv,1,75.798000
randomdigit,doubleconv,2,85.712000
randomdigit,doubleconv,3,93.087000
randomdigit,doubleconv,4,98.444000
randomdigit,doubleconv,5,102.888000
randomdigit,doubleconv,6,106.092000
randomdigit,doubleconv,7,109.214000
randomdigit,doubleconv,8,110.171000
randomdigit,doubleconv,9,109.086000
randomdigit,doubleconv,10,112.887000
randomdigit,doubleconv,11,113.624000
randomdigit,doubleconv,12,115.323000
randomdigit,doubleconv,13,118.014000
randomdigit,doubleconv,14,120.613000
randomdigit,doubleconv,15,122.539000
randomdigit,doubleconv,16,126.356000
randomdigit,doubleconv,17,138.766000
randomdigit,emyg,1,50.295000
randomdigit,emyg,2,54.830000
randomdigit,emyg,3,56.998000
randomdigit,emyg,4,59.293000
randomdigit,emyg,5,61.517000
randomdigit,emyg,6,62.488000
randomdigit,emyg,7,62.552000
randomdigit,emyg,8,63.710000
randomdigit,emyg,9,64.544000
randomdigit,emyg,10,67.130000
randomdigit,emyg,11,69.192000
randomdigit,emyg,12,67.368000
randomdigit,emyg,13,67.718000
randomdigit,emyg,14,70.753000
randomdigit,emyg,15,71.975000
randomdigit,emyg,16,74.157000
randomdigit,emyg,17,78.877000
randomdigit,floaxie,1,31.011000
randomdigit,floaxie,2,35.055000
randomdigit,floaxie,3,39.998000
randomdigit,floaxie,4,46.128000
randomdigit,floaxie,5,52.411000
randomdigit,floaxie,6,59.282000
randomdigit,floaxie,7,66.590000
randomdigit,floaxie,8,75.175000
randomdigit,floaxie,9,90.302000
randomdigit,floaxie,10,94.844000
randomdigit,floaxie,11,95.677000
randomdigit,floaxie,12,95.154000
randomdigit,floaxie,13,99.433000
randomdigit,floaxie,14,107.645000
randomdigit,floaxie,15,108.248000
randomdigit,floaxie,16,103.687000
randomdigit,floaxie,17,103.567000
randomdigit,fmt,1,64.426000
randomdigit,fmt,2,70.254000
randomdigit,fmt,3,73.304000
randomdigit,fmt,4,75.395000
randomdigit,fmt,5,78.219000
randomdigit,fmt,6,76.773000
randomdigit,fmt,7,77.830000
randomdigit,fmt,8,79.021000
randomdigit,fmt,9,79.993000
randomdigit,fmt,10,83.685000
randomdigit,fmt,11,82.694000
randomdigit,fmt,12,84.963000
randomdigit,fmt,13,87.626000
randomdigit,fmt,14,87.892000
randomdigit,fmt,15,90.624000
randomdigit,fmt,16,94.642000
randomdigit,fmt,17,106.819000
randomdigit,grisu2,1,101.962000
randomdigit,grisu2,2,112.676000
randomdigit,grisu2,3,110.422000
randomdigit,grisu2,4,111.546000
randomdigit,grisu2,5,113.336000
randomdigit,grisu2,6,114.886000
randomdigit,grisu2,7,118.054000
randomdigit,grisu2,8,120.614000
randomdigit,grisu2,9,122.814000
randomdigit,grisu2,10,124.432000
randomdigit,grisu2,11,129.170000
randomdigit,grisu2,12,130.077000
randomdigit,grisu2,13,130.934000
randomdigit,grisu2,14,134.205000
randomdigit,grisu2,15,137.361000
randomdigit,grisu2,16,140.563000
randomdigit,grisu2,17,147.042000
randomdigit,milo,1,52.498000
randomdigit,milo,2,57.761000
randomdigit,milo,3,61.054000
randomdigit,milo,4,61.274000
randomdigit,milo,5,63.351000
randomdigit,milo,6,64.426000
randomdigit,milo,7,65.932000
randomdigit,milo,8,67.489000
randomdigit,milo,9,68.325000
randomdigit,milo,10,70.521000
randomdigit,milo,11,72.940000
randomdigit,milo,12,75.368000
randomdigit,milo,13,77.188000
randomdigit,milo,14,79.604000
randomdigit,milo,15,82.743000
randomdigit,milo,16,84.217000
randomdigit,milo,17,90.008000
randomdigit,ryu,1,63.699000
randomdigit,ryu,2,63.923000
randomdigit,ryu,3,62.140000
randomdigit,ryu,4,61.074000
randomdigit,ryu,5,57.499000
randomdigit,ryu,6,57.719000
randomdigit,ryu,7,56.424000
randomdigit,ryu,8,54.069000
randomdigit,ryu,9,52.136000
randomdigit,ryu,10,52.426000
randomdigit,ryu,11,49.917000
randomdigit,ryu,12,48.949000
randomdigit,ryu,13,46.397000
randomdigit,ryu,14,43.584000
randomdigit,ryu,15,42.577000
randomdigit,ryu,16,42.378000
randomdigit,ryu,17,41.340000
randomdigit,dragonbox,1,38.310000
randomdigit,dragonbox,2,39.700000
randomdigit,dragonbox,3,38.684000
randomdigit,dragonbox,4,38.953000
randomdigit,dragonbox,5,38.958000
randomdigit,dragonbox,6,39.119000
randomdigit,dragonbox,7,39.043000
randomdigit,dragonbox,8,38.036000
randomdigit,dragonbox,9,40.934000
randomdigit,dragonbox,10,43.331000
randomdigit,dragonbox,11,41.462000
randomdigit,dragonbox,12,41.673000
randomdigit,dragonbox,13,40.377000
randomdigit,dragonbox,14,39.740000
randomdigit,dragonbox,15,38.991000
randomdigit,dragonbox,16,38.852000
randomdigit,dragonbox,17,40.797000
randomdigit,dragonbox_comp,1,46.273000
randomdigit,dragonbox_comp,2,46.694000
randomdigit,dragonbox_comp,3,44.153000
randomdigit,dragonbox_comp,4,43.176000
randomdigit,dragonbox_comp,5,43.986000
randomdigit,dragonbox_comp,6,43.222000
randomdigit,dragonbox_comp,7,43.018000
randomdigit,dragonbox_comp,8,43.046000
randomdigit,dragonbox_comp,9,46.488000
randomdigit,dragonbox_comp,10,49.047000
randomdigit,dragonbox_comp,11,46.583000
randomdigit,dragonbox_comp,12,46.430000
randomdigit,dragonbox_comp,13,45.915000
randomdigit,dragonbox_comp,14,46.315000
randomdigit,dragonbox_comp,15,46.713000
randomdigit,dragonbox_comp,16,46.384000
randomdigit,dragonbox_comp,17,48.944000
randomdigit,erthink,1,39.792000
randomdigit,erthink,2,41.063000
randomdigit,erthink,3,42.262000
randomdigit,erthink,4,43.955000
randomdigit,erthink,5,45.158000
randomdigit,erthink,6,46.800000
randomdigit,erthink,7,49.111000
randomdigit,erthink,8,48.859000
randomdigit,erthink,9,50.816000
randomdigit,erthink,10,51.870000
randomdigit,erthink,11,53.118000
randomdigit,erthink,12,54.671000
randomdigit,erthink,13,56.180000
randomdigit,erthink,14,59.109000
randomdigit,erthink,15,59.472000
randomdigit,erthink,16,61.741000
randomdigit,erthink,17,64.423000
randomdigit,erthink_shodan,1,39.341000
randomdigit,erthink_shodan,2,40.707000
randomdigit,erthink_shodan,3,41.938000
randomdigit,erthink_shodan,4,43.920000
randomdigit,erthink_shodan,5,46.455000
randomdigit,erthink_shodan,6,47.922000
randomdigit,erthink_shodan,7,49.351000
randomdigit,erthink_shodan,8,50.615000
randomdigit,erthink_shodan,9,51.652000
randomdigit,erthink_shodan,10,53.638000
randomdigit,erthink_shodan,11,54.973000
randomdigit,erthink_shodan,12,56.868000
randomdigit,erthink_shodan,13,57.663000
randomdigit,erthink_shodan,14,60.789000
randomdigit,erthink_shodan,15,62.280000
randomdigit,erthink_shodan,16,63.416000
randomdigit,erthink_shodan,17,71.275000
randomdigit,fmt_dragonbox,1,58.516000
randomdigit,fmt_dragonbox,2,60.432000
randomdigit,fmt_dragonbox,3,59.945000
randomdigit,fmt_dragonbox,4,59.449000
randomdigit,fmt_dragonbox,5,60.306000
randomdigit,fmt_dragonbox,6,58.229000
randomdigit,fmt_dragonbox,7,58.538000
randomdigit,fmt_dragonbox,8,57.162000
randomdigit,fmt_dragonbox,9,63.689000
randomdigit,fmt_dragonbox,10,65.019000
randomdigit,fmt_dragonbox,11,64.413000
randomdigit,fmt_dragonbox,12,64.703000
randomdigit,fmt_dragonbox,13,64.381000
randomdigit,fmt_dragonbox,14,61.642000
randomdigit,fmt_dragonbox,15,61.720000
randomdigit,fmt_dragonbox,16,60.228000
randomdigit,fmt_dragonbox,17,63.314000
randomdigit,fmt_dragonbox_comp,1,66.498000
randomdigit,fmt_dragonbox_comp,2,65.930000
randomdigit,fmt_dragonbox_comp,3,66.777000
randomdigit,fmt_dragonbox_comp,4,68.185000
randomdigit,fmt_dragonbox_comp,5,67.593000
randomdigit,fmt_dragonbox_comp,6,67.620000
randomdigit,fmt_dragonbox_comp,7,67.598000
randomdigit,fmt_dragonbox_comp,8,68.385000
randomdigit,fmt_dragonbox_comp,9,74.191000
randomdigit,fmt_dragonbox_comp,10,74.185000
randomdigit,fmt_dragonbox_comp,11,73.299000
randomdigit,fmt_dragonbox_comp,12,72.166000
randomdigit,fmt_dragonbox_comp,13,71.579000
randomdigit,fmt_dragonbox_comp,14,72.615000
randomdigit,fmt_dragonbox_comp,15,73.340000
randomdigit,fmt_dragonbox_comp,16,73.495000
randomdigit,fmt_dragonbox_comp,17,73.972000
</textarea>
</div>
<div class="row" id="downloadDD" style="display: none">
<div class="btn-group pull-right" >
    <button class="btn dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-picture"></span></button>
    <ul class="dropdown-menu">
        <li><a tabindex="-1" href="#" dltype="image/jpeg">JPEG</a></li>
        <li><a tabindex="-1" href="#" dltype="image/png">PNG</a></li>
        <li><a tabindex="-1" href="#" dltype="application/pdf">PDF</a></li>
        <li><a tabindex="-1" href="#" dltype="image/svg+xml">SVG</a></li>
    </ul>
</div>
</div>
<form method="post" action="http://export.highcharts.com/" id="imageGetForm">
    <input type="hidden" name="filename" id="imageFilename" value="" />
    <input type="hidden" name="type" id="imageGetFormTYPE" value="" />
    <input type="hidden" name="width" value="900" />
    <input type="hidden" name="svg" value="" id="imageGetFormSVG" />
</form>
</div>
</body>
</html>