<html>
<head>
<script src="http://code.jquery.com/jquery-1.8.2.js"></script>
<script src="http://www.google.com/jsapi?autoload={'modules':[{'name':'visualization','version':'1','packages':['controls', 'charteditor']}]}"></script>
<script src="https://web.archive.org/web/20160324220311/http://jquery-csv.googlecode.com/git/src/jquery.csv.js"></script>
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script>
$(function() {
	google.load("visualization", "1", {packages:["corechart"]});

    var csv = $('#textInput').val();
    var data = $.csv.toArrays(csv, {
        onParseValue: $.csv.hooks.castToScalar
    });

    // Convert data for bar chart (summing all digits)
    var timeData = {};	// type -> table
    var funcRowMap;
    var maxDigit = 0;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
      var digit = data[i][2];
   		var time = data[i][3];
   		if (timeData[type] == null) {
   			timeData[type] = [["Function", "Time (ns)"/*, { role: "style" }*/]];
        if (digit != 0)
   			  funcRowMap = {};
   		}

   		var table = timeData[type];
   		
      if (digit != 0) {
     		if (funcRowMap[func] == null)
     			funcRowMap[func] = table.push([func, 0]) - 1;
     		
     		table[funcRowMap[func]][1] += time;
      }
      else 
        table.push([func, time]);

      maxDigit = Math.max(maxDigit, digit);
    }

    // Compute average
    for (var type in timeData) {
      var table = timeData[type];
      for (var i = 1; i < table.length; i++)
        table[i][1] /= maxDigit;
    }

    // Convert data for drawing line chart per random digit
    var timeDigitData = {}; // type -> table
    var funcColumnMap;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
		  var digit = data[i][2];
   		var time = data[i][3];

      if (digit == 0)
        continue;

   		if (timeDigitData[type] == null) {
   			timeDigitData[type] = [["Digit"]];
   			funcColumnMap = {};
   		}

   		var table = timeDigitData[type];

   		if (funcColumnMap[func] == null)
   			funcColumnMap[func] = table[0].push(func) - 1;

   		var row;
   		for (row = 1; row < table.length; row++)
   			if (table[row][0] == digit)
   				break;

    	if (row == table.length)
    		table.push([digit]);

		table[row][funcColumnMap[func]] = time;
	}

	for (var type in timeData) {
		$("#main").append(
      $("<a>", {name: type}),
      $("<h2>", {style: "padding-top: 70px; margin-top: -70px;"}).append(type)
    );

    $("#section").append($("<li>").append($("<a>", {href: "#" + type}).append(type)));

		drawTable(type, timeData[type]);
		drawBarChart(type, timeData[type]);
    if (timeDigitData[type] != null)
		  drawDigitChart(type, timeDigitData[type]);
	}

	$(".chart").each(function() {
		var chart = $(this);
		var d = $("#downloadDD").clone().css("display", "");
		$('li a', d).each(function() {
	        $(this).click(function() {
	            var svg = chart[0].getElementsByTagName('svg')[0].parentNode.innerHTML;
	            svg=sanitize(svg);
	            $('#imageFilename').val($("#title").html() + "_" + chart.data("filename"));
	            $('#imageGetFormTYPE').val($(this).attr('dltype'));
	            $('#imageGetFormSVG').val(svg);
	            $('#imageGetForm').submit();
	        });
	    });		
		$(this).after(d);
	});

  // Add configurations
  var thisConfig = "unknown_win64_vc2019";
  var configurations = ["corei7920@2.67_cygwin32_gcc4.8","corei7920@2.67_cygwin64_gcc4.8","corei7920@2.67_win32_vc2013","corei7920@2.67_win64_vc2013","unknown_mac32_clang7.0","unknown_mac64_clang7.0","unknown_win64_vc2019"];

  for (var i in configurations) {
    var c = configurations[i];
    $("#configuration").append($("<li>", {class : (c == thisConfig ? "active" : "")}).append($("<a>", {href: c + ".html"}).append(c)));
  }
});

function drawTable(type, timeData) {
	var data = google.visualization.arrayToDataTable(timeData);
    data.addColumn('number', 'Speedup');
    data.sort([{ column: 1, desc: true }]);
    var formatter1 = new google.visualization.NumberFormat({ fractionDigits: 3 });
    formatter1.format(data, 1);

	var div = document.createElement("div");
	div.className = "tablechart";
	$("#main").append(div);
    var table = new google.visualization.Table(div);
    redrawTable(0);
    table.setSelection([{ row: 0, column: null}]);

    function redrawTable(selectedRow) {
        // Compute relative time using the first row as basis
        var basis = data.getValue(selectedRow, 1);
        for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
            data.setValue(rowIndex, 2, basis / data.getValue(rowIndex, 1));

        var formatter = new google.visualization.NumberFormat({suffix: 'x'});
        formatter.format(data, 2); // Apply formatter to second column

        table.draw(data);
    }

    google.visualization.events.addListener(table, 'select',
    function() {
        var selection = table.getSelection();
        if (selection.length > 0) {
            var item = selection[0];
            if (item.row != null)
                redrawTable(item.row);
        }
    });

}

function drawBarChart(type, timeData) {
    var defaultColors = ["#3366cc","#dc3912","#ff9900","#109618","#990099","#0099c6","#dd4477","#66aa00","#b82e2e","#316395","#994499","#22aa99","#aaaa11","#6633cc","#e67300","#8b0707","#651067","#329262","#5574a6","#3b3eac","#b77322","#16d620","#b91383","#f4359e","#9c5935","#a9c413","#2a778d","#668d1c","#bea413","#0c5922","#743411"];

	var data = google.visualization.arrayToDataTable(timeData);
	data.addColumn({ type: "string", role: "style" })
	for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
		data.setValue(rowIndex, 2, defaultColors[rowIndex]);

    data.sort([{ column: 1, desc: true }]);
	var options = { 
		title: type,
		chartArea: {'width': '70%', 'height': '70%'},
		width: 800,
		height: 300,
		legend: { position: "none" },
		hAxis: { title: "Time (ns)" }
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_time");
	$("#main").append(div);
	var chart = new google.visualization.BarChart(div);

	chart.draw(data, options);
}

function drawDigitChart(type, timeDigitData) {
	var data = google.visualization.arrayToDataTable(timeDigitData);

	var options = { 
		title: type,
		chartArea: {'width': '70%', 'height': '80%'},
		hAxis: {
			title: "Digit",
			gridlines: { count: timeDigitData.length - 1 },
			maxAlternation: 1,
			minTextSpacing: 0
		},
		vAxis: {
			title: "Time (ns) in log scale",
			logScale: true,
			minorGridlines: { count: 10 },
      baseline: 0
		},
		width: 800,
		height: 600
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_timedigit");
	$("#main").append(div);
	var chart = new google.visualization.LineChart(div);

	chart.draw(data, options);
}

// http://jsfiddle.net/P6XXM/
function sanitize(svg) {
    svg = svg
        .replace(/\<svg/,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1"')
        .replace(/zIndex="[^"]+"/g, '')
        .replace(/isShadow="[^"]+"/g, '')
        .replace(/symbolName="[^"]+"/g, '')
        .replace(/jQuery[0-9]+="[^"]+"/g, '')
        .replace(/isTracker="[^"]+"/g, '')
        .replace(/url\([^#]+#/g, 'url(#')
        .replace('<svg xmlns:xlink="http://www.w3.org/1999/xlink" ', '<svg ')
        .replace(/ href=/g, ' xlink:href=')
    /*.replace(/preserveAspectRatio="none">/g, 'preserveAspectRatio="none"/>')*/
    /* This fails in IE < 8
    .replace(/([0-9]+)\.([0-9]+)/g, function(s1, s2, s3) { // round off to save weight
    return s2 +'.'+ s3[0];
    })*/

    // IE specific
        .replace(/id=([^" >]+)/g, 'id="$1"')
        .replace(/class=([^" ]+)/g, 'class="$1"')
        .replace(/ transform /g, ' ')
        .replace(/:(path|rect)/g, '$1')
        .replace(/<img ([^>]*)>/gi, '<image $1 />')
        .replace(/<\/image>/g, '') // remove closing tags for images as they'll never have any content
        .replace(/<image ([^>]*)([^\/])>/gi, '<image $1$2 />') // closes image tags for firefox
        .replace(/width=(\d+)/g, 'width="$1"')
        .replace(/height=(\d+)/g, 'height="$1"')
        .replace(/hc-svg-href="/g, 'xlink:href="')
        .replace(/style="([^"]+)"/g, function (s) {
            return s.toLowerCase();
        });

    // IE9 beta bugs with innerHTML. Test again with final IE9.
    svg = svg.replace(/(url\(#highcharts-[0-9]+)&quot;/g, '$1')
        .replace(/&quot;/g, "'");
    if (svg.match(/ xmlns="/g).length == 2) {
        svg = svg.replace(/xmlns="[^"]+"/, '');
    }

    return svg;
}
</script>
<style type="text/css">
@media (min-width: 800px) {
  .container {
    max-width: 800px;
  }
}
textarea {
	font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace;
}
.tablechart {
	width: 700px;
	margin: auto;
	padding-top: 20px;
	padding-bottom: 20px;
}
.chart {
	padding-top: 20px;
	padding-bottom: 20px;
}
body { padding-top: 70px; }
</style>
</head>
<body>
<div class="container">
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://github.com/miloyip/dtoa-benchmark"><span class="glyphicon glyphicon-home"></span> dtoa-benchmark</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Configuration <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="configuration">
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Section <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="section">
          </ul>
        </li>
      </ul>
      <p class="navbar-text navbar-right">Developed by <a href="https://github.com/miloyip" class="navbar-link">Milo Yip</a></p>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
<div class="page-header">
<h1 id="title">unknown_win64_vc2019</h1>
</div>
<div id="main"></div>
<h2>Source CSV</h2>
<textarea id="textInput" class="form-control" rows="5" readonly>
Type,Function,Digit,Time(ns)
randomdigit,doubleconv,1,110.419085
randomdigit,doubleconv,2,118.868539
randomdigit,doubleconv,3,128.674573
randomdigit,doubleconv,4,137.543401
randomdigit,doubleconv,5,141.182829
randomdigit,doubleconv,6,141.449039
randomdigit,doubleconv,7,152.287096
randomdigit,doubleconv,8,155.762422
randomdigit,doubleconv,9,155.503505
randomdigit,doubleconv,10,156.568347
randomdigit,doubleconv,11,157.144529
randomdigit,doubleconv,12,157.567549
randomdigit,doubleconv,13,159.591480
randomdigit,doubleconv,14,163.982133
randomdigit,doubleconv,15,171.370391
randomdigit,doubleconv,16,179.706796
randomdigit,doubleconv,17,185.968217
randomdigit,emyg,1,71.658080
randomdigit,emyg,2,73.605430
randomdigit,emyg,3,81.008275
randomdigit,emyg,4,84.950381
randomdigit,emyg,5,84.614882
randomdigit,emyg,6,91.478013
randomdigit,emyg,7,94.435504
randomdigit,emyg,8,97.531571
randomdigit,emyg,9,102.203021
randomdigit,emyg,10,104.810427
randomdigit,emyg,11,109.102618
randomdigit,emyg,12,109.303188
randomdigit,emyg,13,113.212474
randomdigit,emyg,14,113.723015
randomdigit,emyg,15,120.699193
randomdigit,emyg,16,123.230018
randomdigit,emyg,17,129.422151
randomdigit,floaxie,1,49.139574
randomdigit,floaxie,2,58.077689
randomdigit,floaxie,3,65.075748
randomdigit,floaxie,4,73.087595
randomdigit,floaxie,5,81.161437
randomdigit,floaxie,6,91.532713
randomdigit,floaxie,7,99.081427
randomdigit,floaxie,8,105.113105
randomdigit,floaxie,9,115.079595
randomdigit,floaxie,10,120.009963
randomdigit,floaxie,11,121.417597
randomdigit,floaxie,12,120.422042
randomdigit,floaxie,13,122.602782
randomdigit,floaxie,14,122.154235
randomdigit,floaxie,15,124.455317
randomdigit,floaxie,16,126.723577
randomdigit,floaxie,17,126.909560
randomdigit,fmt,1,165.068856
randomdigit,fmt,2,173.605831
randomdigit,fmt,3,177.620872
randomdigit,fmt,4,183.966167
randomdigit,fmt,5,187.481607
randomdigit,fmt,6,190.256762
randomdigit,fmt,7,192.495849
randomdigit,fmt,8,195.438753
randomdigit,fmt,9,201.072938
randomdigit,fmt,10,197.831003
randomdigit,fmt,11,204.792595
randomdigit,fmt,12,206.171055
randomdigit,fmt,13,205.186440
randomdigit,fmt,14,209.004558
randomdigit,fmt,15,214.806492
randomdigit,fmt,16,219.098684
randomdigit,fmt,17,217.297203
randomdigit,fpconv,1,137.313657
randomdigit,fpconv,2,147.746928
randomdigit,fpconv,3,161.626350
randomdigit,fpconv,4,170.568112
randomdigit,fpconv,5,174.976998
randomdigit,fpconv,6,184.093802
randomdigit,fpconv,7,186.369357
randomdigit,fpconv,8,196.241032
randomdigit,fpconv,9,193.987358
randomdigit,fpconv,10,196.769807
randomdigit,fpconv,11,202.980174
randomdigit,fpconv,12,198.224849
randomdigit,fpconv,13,208.927977
randomdigit,fpconv,14,212.286608
randomdigit,fpconv,15,211.878175
randomdigit,fpconv,16,218.533442
randomdigit,fpconv,17,226.009221
randomdigit,grisu2,1,138.586363
randomdigit,grisu2,2,147.039464
randomdigit,grisu2,3,150.233992
randomdigit,grisu2,4,148.388751
randomdigit,grisu2,5,152.221455
randomdigit,grisu2,6,156.280256
randomdigit,grisu2,7,153.618150
randomdigit,grisu2,8,157.009601
randomdigit,grisu2,9,164.620309
randomdigit,grisu2,10,162.567205
randomdigit,grisu2,11,171.031245
randomdigit,grisu2,12,172.530048
randomdigit,grisu2,13,176.085602
randomdigit,grisu2,14,178.933691
randomdigit,grisu2,15,183.043547
randomdigit,grisu2,16,183.302464
randomdigit,grisu2,17,192.258812
randomdigit,jkj,1,40.030064
randomdigit,jkj,2,44.209207
randomdigit,jkj,3,45.627781
randomdigit,jkj,4,46.579576
randomdigit,jkj,5,47.097410
randomdigit,jkj,6,46.656157
randomdigit,jkj,7,47.950743
randomdigit,jkj,8,46.521228
randomdigit,jkj,9,48.461284
randomdigit,jkj,10,49.646469
randomdigit,jkj,11,51.305727
randomdigit,jkj,12,49.792337
randomdigit,jkj,13,51.932963
randomdigit,jkj,14,52.687834
randomdigit,jkj,15,53.759971
randomdigit,jkj,16,54.485668
randomdigit,jkj,17,58.766919
randomdigit,milo,1,65.823326
randomdigit,milo,2,71.534092
randomdigit,milo,3,76.143548
randomdigit,milo,4,79.246908
randomdigit,milo,5,81.981949
randomdigit,milo,6,85.792774
randomdigit,milo,7,88.925307
randomdigit,milo,8,91.685876
randomdigit,milo,9,93.811914
randomdigit,milo,10,92.550149
randomdigit,milo,11,100.241085
randomdigit,milo,12,102.790143
randomdigit,milo,13,102.764616
randomdigit,milo,14,100.915728
randomdigit,milo,15,109.831963
randomdigit,milo,16,114.116861
randomdigit,milo,17,121.975546
randomdigit,milo_only_Grisu2,1,48.979119
randomdigit,milo_only_Grisu2,2,52.954045
randomdigit,milo_only_Grisu2,3,56.130340
randomdigit,milo_only_Grisu2,4,59.481677
randomdigit,milo_only_Grisu2,5,62.428228
randomdigit,milo_only_Grisu2,6,66.078596
randomdigit,milo_only_Grisu2,7,68.609421
randomdigit,milo_only_Grisu2,8,71.464804
randomdigit,milo_only_Grisu2,9,75.027651
randomdigit,milo_only_Grisu2,10,78.327934
randomdigit,milo_only_Grisu2,11,81.336480
randomdigit,milo_only_Grisu2,12,82.747761
randomdigit,milo_only_Grisu2,13,86.653400
randomdigit,milo_only_Grisu2,14,87.721889
randomdigit,milo_only_Grisu2,15,91.098754
randomdigit,milo_only_Grisu2,16,92.688724
randomdigit,milo_only_Grisu2,17,94.825703
randomdigit,null,1,1.393048
randomdigit,null,2,1.393048
randomdigit,null,3,1.393048
randomdigit,null,4,1.393048
randomdigit,null,5,1.393048
randomdigit,null,6,1.393048
randomdigit,null,7,1.393048
randomdigit,null,8,1.389401
randomdigit,null,9,1.393048
randomdigit,null,10,1.393048
randomdigit,null,11,1.389401
randomdigit,null,12,1.393048
randomdigit,null,13,1.393048
randomdigit,null,14,1.393048
randomdigit,null,15,1.393048
randomdigit,null,16,1.393048
randomdigit,null,17,1.393048
randomdigit,to_chars,1,93.633225
randomdigit,to_chars,2,94.665247
randomdigit,to_chars,3,93.702513
randomdigit,to_chars,4,88.035507
randomdigit,to_chars,5,86.449183
randomdigit,to_chars,6,85.358814
randomdigit,to_chars,7,82.645653
randomdigit,to_chars,8,78.174772
randomdigit,to_chars,9,76.913006
randomdigit,to_chars,10,76.493633
randomdigit,to_chars,11,73.634604
randomdigit,to_chars,12,71.760189
randomdigit,to_chars,13,69.838366
randomdigit,to_chars,14,67.562812
randomdigit,to_chars,15,66.592784
randomdigit,to_chars,16,64.820477
randomdigit,to_chars,17,65.021047
</textarea>
</div>
<div class="row" id="downloadDD" style="display: none">
<div class="btn-group pull-right" >
    <button class="btn dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-picture"></span></button>
    <ul class="dropdown-menu">
        <li><a tabindex="-1" href="#" dltype="image/jpeg">JPEG</a></li>
        <li><a tabindex="-1" href="#" dltype="image/png">PNG</a></li>
        <li><a tabindex="-1" href="#" dltype="application/pdf">PDF</a></li>
        <li><a tabindex="-1" href="#" dltype="image/svg+xml">SVG</a></li>
    </ul>
</div>
</div>
<form method="post" action="http://export.highcharts.com/" id="imageGetForm">
    <input type="hidden" name="filename" id="imageFilename" value="" />
    <input type="hidden" name="type" id="imageGetFormTYPE" value="" />
    <input type="hidden" name="width" value="900" />
    <input type="hidden" name="svg" value="" id="imageGetFormSVG" />
</form>
</div>
</body>
</html>