<html>
<head>
<script src="http://code.jquery.com/jquery-1.8.2.js"></script>
<script src="http://www.google.com/jsapi?autoload={%22modules%22:[{%22name%22:%22visualization%22,%22version%22:%221%22,%22packages%22:[%22controls%22,%22charteditor%22]}]}"></script>
<script src="jquery.csv.js"></script>
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script>
$(function() {
	google.load("visualization", "1", {packages:["corechart"]});
  google.setOnLoadCallback(function() {

    var csv = $('#textInput').val();
    var data = $.csv.toArrays(csv, {
        onParseValue: $.csv.hooks.castToScalar
    });

    // Convert data for bar chart (summing all digits)
    var timeData = {};	// type -> table
    var funcRowMap;
    var maxDigit = 0;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
      var digit = data[i][2];
   		var time = data[i][3];
   		if (timeData[type] == null) {
   			timeData[type] = [["Function", "Time (ns)"/*, { role: "style" }*/]];
        if (digit != 0)
   			  funcRowMap = {};
   		}

   		var table = timeData[type];
   		
      if (digit != 0) {
     		if (funcRowMap[func] == null)
     			funcRowMap[func] = table.push([func, 0]) - 1;
     		
     		table[funcRowMap[func]][1] += time;
      }
      else 
        table.push([func, time]);

      maxDigit = Math.max(maxDigit, digit);
    }

    // Compute average
    for (var type in timeData) {
      var table = timeData[type];
      for (var i = 1; i < table.length; i++)
        table[i][1] /= maxDigit;
    }

    // Convert data for drawing line chart per random digit
    var timeDigitData = {}; // type -> table
    var funcColumnMap;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
		  var digit = data[i][2];
   		var time = data[i][3];

      if (digit == 0)
        continue;

   		if (timeDigitData[type] == null) {
   			timeDigitData[type] = [["Digit"]];
   			funcColumnMap = {};
   		}

   		var table = timeDigitData[type];

   		if (funcColumnMap[func] == null)
   			funcColumnMap[func] = table[0].push(func) - 1;

   		var row;
   		for (row = 1; row < table.length; row++)
   			if (table[row][0] == digit)
   				break;

    	if (row == table.length)
    		table.push([digit]);

		table[row][funcColumnMap[func]] = time;
	}

	for (var type in timeData) {
		$("#main").append(
      $("<a>", {name: type}),
      $("<h2>", {style: "padding-top: 70px; margin-top: -70px;"}).append(type)
    );

    $("#section").append($("<li>").append($("<a>", {href: "#" + type}).append(type)));

		drawTable(type, timeData[type]);
		drawBarChart(type, timeData[type]);
    if (timeDigitData[type] != null)
		  drawDigitChart(type, timeDigitData[type]);
	}

	$(".chart").each(function() {
		var chart = $(this);
		var d = $("#downloadDD").clone().css("display", "");
		$('li a', d).each(function() {
	        $(this).click(function() {
	            var svg = chart[0].getElementsByTagName('svg')[0].parentNode.innerHTML;
	            svg=sanitize(svg);
	            $('#imageFilename').val($("#title").html() + "_" + chart.data("filename"));
	            $('#imageGetFormTYPE').val($(this).attr('dltype'));
	            $('#imageGetFormSVG').val(svg);
	            $('#imageGetForm').submit();
	        });
	    });		
		$(this).after(d);
	});

  // Add configurations
  var thisConfig = "unknown_win64_vc2019";
  var configurations = ["corei7920@2.67_cygwin32_gcc4.8","corei7920@2.67_cygwin64_gcc4.8","corei7920@2.67_win32_vc2013","corei7920@2.67_win64_vc2013","unknown_mac32_clang7.0","unknown_mac64_clang7.0","unknown_win64_vc2019"];

  for (var i in configurations) {
    var c = configurations[i];
    $("#configuration").append($("<li>", {class : (c == thisConfig ? "active" : "")}).append($("<a>", {href: c + ".html"}).append(c)));
  }
  })
});

function drawTable(type, timeData) {
	var data = google.visualization.arrayToDataTable(timeData);
    data.addColumn('number', 'Speedup');
    data.sort([{ column: 1, desc: true }]);
    var formatter1 = new google.visualization.NumberFormat({ fractionDigits: 3 });
    formatter1.format(data, 1);

	var div = document.createElement("div");
	div.className = "tablechart";
	$("#main").append(div);
    var table = new google.visualization.Table(div);
    redrawTable(0);
    table.setSelection([{ row: 0, column: null}]);

    function redrawTable(selectedRow) {
        // Compute relative time using the first row as basis
        var basis = data.getValue(selectedRow, 1);
        for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
            data.setValue(rowIndex, 2, basis / data.getValue(rowIndex, 1));

        var formatter = new google.visualization.NumberFormat({suffix: 'x'});
        formatter.format(data, 2); // Apply formatter to second column

        table.draw(data);
    }

    google.visualization.events.addListener(table, 'select',
    function() {
        var selection = table.getSelection();
        if (selection.length > 0) {
            var item = selection[0];
            if (item.row != null)
                redrawTable(item.row);
        }
    });

}

function drawBarChart(type, timeData) {
    var defaultColors = ["#3366cc","#dc3912","#ff9900","#109618","#990099","#0099c6","#dd4477","#66aa00","#b82e2e","#316395","#994499","#22aa99","#aaaa11","#6633cc","#e67300","#8b0707","#651067","#329262","#5574a6","#3b3eac","#b77322","#16d620","#b91383","#f4359e","#9c5935","#a9c413","#2a778d","#668d1c","#bea413","#0c5922","#743411"];

	var data = google.visualization.arrayToDataTable(timeData);
	data.addColumn({ type: "string", role: "style" })
	for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
		data.setValue(rowIndex, 2, defaultColors[rowIndex]);

    data.sort([{ column: 1, desc: true }]);
	var options = { 
		title: type,
		chartArea: {'width': '70%', 'height': '70%'},
		width: 800,
		height: 300,
		legend: { position: "none" },
		hAxis: { title: "Time (ns)" }
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_time");
	$("#main").append(div);
	var chart = new google.visualization.BarChart(div);

	chart.draw(data, options);
}

function drawDigitChart(type, timeDigitData) {
	var data = google.visualization.arrayToDataTable(timeDigitData);

	var options = { 
		title: type,
		chartArea: {left:100, 'width': '60%', 'height': '80%'},
		hAxis: {
			title: "Digit",
			gridlines: { count: timeDigitData.length - 1 },
			maxAlternation: 1,
			minTextSpacing: 0
		},
		vAxis: {
			title: "Time (ns) in log scale",
			logScale: true,
			minorGridlines: { count: 0 },
      baseline: 0,
      viewWindow: {max: 150, min: 20},
      minorGridlines: {interval: [1,2,3,4,5,6,7,8,9,10]}
		},
		width: 800,
		height: 600
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_timedigit");
	$("#main").append(div);
	var chart = new google.visualization.LineChart(div);

	chart.draw(data, options);
}

// http://jsfiddle.net/P6XXM/
function sanitize(svg) {
    svg = svg
        .replace(/\<svg/,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1"')
        .replace(/zIndex="[^"]+"/g, '')
        .replace(/isShadow="[^"]+"/g, '')
        .replace(/symbolName="[^"]+"/g, '')
        .replace(/jQuery[0-9]+="[^"]+"/g, '')
        .replace(/isTracker="[^"]+"/g, '')
        .replace(/url\([^#]+#/g, 'url(#')
        .replace('<svg xmlns:xlink="http://www.w3.org/1999/xlink" ', '<svg ')
        .replace(/ href=/g, ' xlink:href=')
    /*.replace(/preserveAspectRatio="none">/g, 'preserveAspectRatio="none"/>')*/
    /* This fails in IE < 8
    .replace(/([0-9]+)\.([0-9]+)/g, function(s1, s2, s3) { // round off to save weight
    return s2 +'.'+ s3[0];
    })*/

    // IE specific
        .replace(/id=([^" >]+)/g, 'id="$1"')
        .replace(/class=([^" ]+)/g, 'class="$1"')
        .replace(/ transform /g, ' ')
        .replace(/:(path|rect)/g, '$1')
        .replace(/<img ([^>]*)>/gi, '<image $1 />')
        .replace(/<\/image>/g, '') // remove closing tags for images as they'll never have any content
        .replace(/<image ([^>]*)([^\/])>/gi, '<image $1$2 />') // closes image tags for firefox
        .replace(/width=(\d+)/g, 'width="$1"')
        .replace(/height=(\d+)/g, 'height="$1"')
        .replace(/hc-svg-href="/g, 'xlink:href="')
        .replace(/style="([^"]+)"/g, function (s) {
            return s.toLowerCase();
        });

    // IE9 beta bugs with innerHTML. Test again with final IE9.
    svg = svg.replace(/(url\(#highcharts-[0-9]+)&quot;/g, '$1')
        .replace(/&quot;/g, "'");
    if (svg.match(/ xmlns="/g).length == 2) {
        svg = svg.replace(/xmlns="[^"]+"/, '');
    }

    return svg;
}
</script>
<style type="text/css">
@media (min-width: 800px) {
  .container {
    max-width: 800px;
  }
}
textarea {
	font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace;
}
.tablechart {
	width: 700px;
	margin: auto;
	padding-top: 20px;
	padding-bottom: 20px;
}
.chart {
	padding-top: 20px;
	padding-bottom: 20px;
}
body { padding-top: 70px; }
</style>
</head>
<body>
<div class="container">
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://github.com/miloyip/dtoa-benchmark"><span class="glyphicon glyphicon-home"></span> dtoa-benchmark</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Configuration <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="configuration">
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Section <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="section">
          </ul>
        </li>
      </ul>
      <p class="navbar-text navbar-right">Developed by <a href="https://github.com/miloyip" class="navbar-link">Milo Yip</a></p>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
<div class="page-header">
<h1 id="title">unknown_win64_vc2019</h1>
</div>
<div id="main"></div>
<h2>Source CSV</h2>
<textarea id="textInput" class="form-control" rows="5" readonly>
  Type,Function,Digit,Time(ns)
  randomdigit,doubleconv,1,68.536000
  randomdigit,doubleconv,2,80.981000
  randomdigit,doubleconv,3,88.841000
  randomdigit,doubleconv,4,93.809000
  randomdigit,doubleconv,5,97.272000
  randomdigit,doubleconv,6,100.050000
  randomdigit,doubleconv,7,103.629000
  randomdigit,doubleconv,8,105.202000
  randomdigit,doubleconv,9,113.171000
  randomdigit,doubleconv,10,106.031000
  randomdigit,doubleconv,11,108.125000
  randomdigit,doubleconv,12,108.498000
  randomdigit,doubleconv,13,110.572000
  randomdigit,doubleconv,14,116.496000
  randomdigit,doubleconv,15,124.724000
  randomdigit,doubleconv,16,120.415000
  randomdigit,doubleconv,17,129.520000
  randomdigit,emyg,1,47.892000
  randomdigit,emyg,2,52.498000
  randomdigit,emyg,3,54.638000
  randomdigit,emyg,4,56.449000
  randomdigit,emyg,5,58.281000
  randomdigit,emyg,6,58.972000
  randomdigit,emyg,7,59.368000
  randomdigit,emyg,8,60.266000
  randomdigit,emyg,9,60.875000
  randomdigit,emyg,10,61.378000
  randomdigit,emyg,11,62.505000
  randomdigit,emyg,12,64.014000
  randomdigit,emyg,13,65.225000
  randomdigit,emyg,14,67.032000
  randomdigit,emyg,15,68.383000
  randomdigit,emyg,16,70.850000
  randomdigit,emyg,17,75.228000
  randomdigit,floaxie,1,29.341000
  randomdigit,floaxie,2,34.450000
  randomdigit,floaxie,3,38.489000
  randomdigit,floaxie,4,43.953000
  randomdigit,floaxie,5,50.070000
  randomdigit,floaxie,6,57.057000
  randomdigit,floaxie,7,63.640000
  randomdigit,floaxie,8,70.896000
  randomdigit,floaxie,9,77.386000
  randomdigit,floaxie,10,85.896000
  randomdigit,floaxie,11,89.386000
  randomdigit,floaxie,12,92.133000
  randomdigit,floaxie,13,93.235000
  randomdigit,floaxie,14,95.311000
  randomdigit,floaxie,15,102.286000
  randomdigit,floaxie,16,104.109000
  randomdigit,floaxie,17,104.829000
  randomdigit,fmt,1,63.729000
  randomdigit,fmt,2,69.412000
  randomdigit,fmt,3,72.461000
  randomdigit,fmt,4,76.393000
  randomdigit,fmt,5,75.392000
  randomdigit,fmt,6,77.050000
  randomdigit,fmt,7,77.749000
  randomdigit,fmt,8,78.914000
  randomdigit,fmt,9,79.826000
  randomdigit,fmt,10,81.385000
  randomdigit,fmt,11,81.161000
  randomdigit,fmt,12,83.423000
  randomdigit,fmt,13,85.014000
  randomdigit,fmt,14,82.836000
  randomdigit,fmt,15,90.668000
  randomdigit,fmt,16,95.152000
  randomdigit,fmt,17,106.475000
  randomdigit,grisu2,1,99.578000
  randomdigit,grisu2,2,107.038000
  randomdigit,grisu2,3,109.689000
  randomdigit,grisu2,4,110.076000
  randomdigit,grisu2,5,111.013000
  randomdigit,grisu2,6,115.028000
  randomdigit,grisu2,7,116.415000
  randomdigit,grisu2,8,119.716000
  randomdigit,grisu2,9,121.121000
  randomdigit,grisu2,10,123.855000
  randomdigit,grisu2,11,121.937000
  randomdigit,grisu2,12,123.259000
  randomdigit,grisu2,13,126.883000
  randomdigit,grisu2,14,127.708000
  randomdigit,grisu2,15,128.552000
  randomdigit,grisu2,16,131.924000
  randomdigit,grisu2,17,137.188000
  randomdigit,milo,1,50.303000
  randomdigit,milo,2,53.812000
  randomdigit,milo,3,56.195000
  randomdigit,milo,4,57.604000
  randomdigit,milo,5,59.591000
  randomdigit,milo,6,60.369000
  randomdigit,milo,7,61.817000
  randomdigit,milo,8,63.616000
  randomdigit,milo,9,65.453000
  randomdigit,milo,10,65.937000
  randomdigit,milo,11,67.564000
  randomdigit,milo,12,71.713000
  randomdigit,milo,13,72.964000
  randomdigit,milo,14,74.135000
  randomdigit,milo,15,76.664000
  randomdigit,milo,16,82.109000
  randomdigit,milo,17,88.462000
  randomdigit,ryu,1,63.262000
  randomdigit,ryu,2,66.274000
  randomdigit,ryu,3,58.655000
  randomdigit,ryu,4,56.651000
  randomdigit,ryu,5,54.795000
  randomdigit,ryu,6,54.333000
  randomdigit,ryu,7,52.847000
  randomdigit,ryu,8,51.840000
  randomdigit,ryu,9,48.658000
  randomdigit,ryu,10,50.260000
  randomdigit,ryu,11,47.490000
  randomdigit,ryu,12,45.904000
  randomdigit,ryu,13,43.903000
  randomdigit,ryu,14,41.983000
  randomdigit,ryu,15,41.253000
  randomdigit,ryu,16,40.246000
  randomdigit,ryu,17,40.085000
  randomdigit,dragonbox,1,36.387000
  randomdigit,dragonbox,2,38.522000
  randomdigit,dragonbox,3,37.410000
  randomdigit,dragonbox,4,37.661000
  randomdigit,dragonbox,5,37.830000
  randomdigit,dragonbox,6,37.763000
  randomdigit,dragonbox,7,37.130000
  randomdigit,dragonbox,8,36.586000
  randomdigit,dragonbox,9,39.099000
  randomdigit,dragonbox,10,41.414000
  randomdigit,dragonbox,11,40.049000
  randomdigit,dragonbox,12,39.573000
  randomdigit,dragonbox,13,39.295000
  randomdigit,dragonbox,14,38.409000
  randomdigit,dragonbox,15,37.576000
  randomdigit,dragonbox,16,37.834000
  randomdigit,dragonbox,17,39.722000
  randomdigit,dragonbox_comp,1,42.706000
  randomdigit,dragonbox_comp,2,44.165000
  randomdigit,dragonbox_comp,3,43.094000
  randomdigit,dragonbox_comp,4,43.005000
  randomdigit,dragonbox_comp,5,44.141000
  randomdigit,dragonbox_comp,6,45.302000
  randomdigit,dragonbox_comp,7,43.982000
  randomdigit,dragonbox_comp,8,43.155000
  randomdigit,dragonbox_comp,9,45.917000
  randomdigit,dragonbox_comp,10,48.228000
  randomdigit,dragonbox_comp,11,44.966000
  randomdigit,dragonbox_comp,12,45.484000
  randomdigit,dragonbox_comp,13,44.876000
  randomdigit,dragonbox_comp,14,43.932000
  randomdigit,dragonbox_comp,15,43.370000
  randomdigit,dragonbox_comp,16,43.042000
  randomdigit,dragonbox_comp,17,45.477000
  randomdigit,erthink,1,34.942000
  randomdigit,erthink,2,33.922000
  randomdigit,erthink,3,35.991000
  randomdigit,erthink,4,37.546000
  randomdigit,erthink,5,39.139000
  randomdigit,erthink,6,41.222000
  randomdigit,erthink,7,42.627000
  randomdigit,erthink,8,43.793000
  randomdigit,erthink,9,45.918000
  randomdigit,erthink,10,45.937000
  randomdigit,erthink,11,47.909000
  randomdigit,erthink,12,49.820000
  randomdigit,erthink,13,52.305000
  randomdigit,erthink,14,54.278000
  randomdigit,erthink,15,55.567000
  randomdigit,erthink,16,57.112000
  randomdigit,erthink,17,60.329000
  randomdigit,erthink_shodan,1,33.719000
  randomdigit,erthink_shodan,2,34.631000
  randomdigit,erthink_shodan,3,36.748000
  randomdigit,erthink_shodan,4,38.249000
  randomdigit,erthink_shodan,5,39.768000
  randomdigit,erthink_shodan,6,41.139000
  randomdigit,erthink_shodan,7,42.578000
  randomdigit,erthink_shodan,8,44.028000
  randomdigit,erthink_shodan,9,45.171000
  randomdigit,erthink_shodan,10,46.259000
  randomdigit,erthink_shodan,11,47.540000
  randomdigit,erthink_shodan,12,48.922000
  randomdigit,erthink_shodan,13,51.626000
  randomdigit,erthink_shodan,14,54.200000
  randomdigit,erthink_shodan,15,53.219000
  randomdigit,erthink_shodan,16,56.557000
  randomdigit,erthink_shodan,17,62.898000
  randomdigit,fmt_dragonbox,1,54.405000
  randomdigit,fmt_dragonbox,2,57.708000
  randomdigit,fmt_dragonbox,3,55.350000
  randomdigit,fmt_dragonbox,4,57.359000
  randomdigit,fmt_dragonbox,5,58.047000
  randomdigit,fmt_dragonbox,6,56.668000
  randomdigit,fmt_dragonbox,7,56.507000
  randomdigit,fmt_dragonbox,8,55.066000
  randomdigit,fmt_dragonbox,9,62.042000
  randomdigit,fmt_dragonbox,10,63.138000
  randomdigit,fmt_dragonbox,11,61.309000
  randomdigit,fmt_dragonbox,12,61.817000
  randomdigit,fmt_dragonbox,13,62.017000
  randomdigit,fmt_dragonbox,14,59.207000
  randomdigit,fmt_dragonbox,15,59.138000
  randomdigit,fmt_dragonbox,16,57.417000
  randomdigit,fmt_dragonbox,17,60.245000
  randomdigit,fmt_dragonbox_comp,1,59.855000
  randomdigit,fmt_dragonbox_comp,2,60.947000
  randomdigit,fmt_dragonbox_comp,3,61.831000
  randomdigit,fmt_dragonbox_comp,4,64.461000
  randomdigit,fmt_dragonbox_comp,5,64.364000
  randomdigit,fmt_dragonbox_comp,6,65.243000
  randomdigit,fmt_dragonbox_comp,7,64.672000
  randomdigit,fmt_dragonbox_comp,8,65.830000
  randomdigit,fmt_dragonbox_comp,9,70.264000
  randomdigit,fmt_dragonbox_comp,10,70.620000
  randomdigit,fmt_dragonbox_comp,11,70.462000
  randomdigit,fmt_dragonbox_comp,12,69.508000
  randomdigit,fmt_dragonbox_comp,13,69.810000
  randomdigit,fmt_dragonbox_comp,14,70.479000
  randomdigit,fmt_dragonbox_comp,15,70.247000
  randomdigit,fmt_dragonbox_comp,16,68.938000
  randomdigit,fmt_dragonbox_comp,17,70.059000
   </textarea>
</div>
<div class="row" id="downloadDD" style="display: none">
<div class="btn-group pull-right" >
    <button class="btn dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-picture"></span></button>
    <ul class="dropdown-menu">
        <li><a tabindex="-1" href="#" dltype="image/jpeg">JPEG</a></li>
        <li><a tabindex="-1" href="#" dltype="image/png">PNG</a></li>
        <li><a tabindex="-1" href="#" dltype="application/pdf">PDF</a></li>
        <li><a tabindex="-1" href="#" dltype="image/svg+xml">SVG</a></li>
    </ul>
</div>
</div>
<form method="post" action="http://export.highcharts.com/" id="imageGetForm">
    <input type="hidden" name="filename" id="imageFilename" value="" />
    <input type="hidden" name="type" id="imageGetFormTYPE" value="" />
    <input type="hidden" name="width" value="900" />
    <input type="hidden" name="svg" value="" id="imageGetFormSVG" />
</form>
</div>
</body>
</html>