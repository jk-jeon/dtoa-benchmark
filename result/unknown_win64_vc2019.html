<html>
<head>
<script src="http://code.jquery.com/jquery-1.8.2.js"></script>
<script src="http://www.google.com/jsapi?autoload={%22modules%22:[{%22name%22:%22visualization%22,%22version%22:%221%22,%22packages%22:[%22controls%22,%22charteditor%22]}]}"></script>
<script src="jquery.csv.js"></script>
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script>
$(function() {
	google.load("visualization", "1", {packages:["corechart"]});
  google.setOnLoadCallback(function() {

    var csv = $('#textInput').val();
    var data = $.csv.toArrays(csv, {
        onParseValue: $.csv.hooks.castToScalar
    });

    // Convert data for bar chart (summing all digits)
    var timeData = {};	// type -> table
    var funcRowMap;
    var maxDigit = 0;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
      var digit = data[i][2];
   		var time = data[i][3];
   		if (timeData[type] == null) {
   			timeData[type] = [["Function", "Time (ns)"/*, { role: "style" }*/]];
        if (digit != 0)
   			  funcRowMap = {};
   		}

   		var table = timeData[type];
   		
      if (digit != 0) {
     		if (funcRowMap[func] == null)
     			funcRowMap[func] = table.push([func, 0]) - 1;
     		
     		table[funcRowMap[func]][1] += time;
      }
      else 
        table.push([func, time]);

      maxDigit = Math.max(maxDigit, digit);
    }

    // Compute average
    for (var type in timeData) {
      var table = timeData[type];
      for (var i = 1; i < table.length; i++)
        table[i][1] /= maxDigit;
    }

    // Convert data for drawing line chart per random digit
    var timeDigitData = {}; // type -> table
    var funcColumnMap;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
		  var digit = data[i][2];
   		var time = data[i][3];

      if (digit == 0)
        continue;

   		if (timeDigitData[type] == null) {
   			timeDigitData[type] = [["Digit"]];
   			funcColumnMap = {};
   		}

   		var table = timeDigitData[type];

   		if (funcColumnMap[func] == null)
   			funcColumnMap[func] = table[0].push(func) - 1;

   		var row;
   		for (row = 1; row < table.length; row++)
   			if (table[row][0] == digit)
   				break;

    	if (row == table.length)
    		table.push([digit]);

		table[row][funcColumnMap[func]] = time;
	}

	for (var type in timeData) {
		$("#main").append(
      $("<a>", {name: type}),
      $("<h2>", {style: "padding-top: 70px; margin-top: -70px;"}).append(type)
    );

    $("#section").append($("<li>").append($("<a>", {href: "#" + type}).append(type)));

		drawTable(type, timeData[type]);
		drawBarChart(type, timeData[type]);
    if (timeDigitData[type] != null)
		  drawDigitChart(type, timeDigitData[type]);
	}

	$(".chart").each(function() {
		var chart = $(this);
		var d = $("#downloadDD").clone().css("display", "");
		$('li a', d).each(function() {
	        $(this).click(function() {
	            var svg = chart[0].getElementsByTagName('svg')[0].parentNode.innerHTML;
	            svg=sanitize(svg);
	            $('#imageFilename').val($("#title").html() + "_" + chart.data("filename"));
	            $('#imageGetFormTYPE').val($(this).attr('dltype'));
	            $('#imageGetFormSVG').val(svg);
	            $('#imageGetForm').submit();
	        });
	    });		
		$(this).after(d);
	});

  // Add configurations
  var thisConfig = "unknown_win64_vc2019";
  var configurations = ["corei7920@2.67_cygwin32_gcc4.8","corei7920@2.67_cygwin64_gcc4.8","corei7920@2.67_win32_vc2013","corei7920@2.67_win64_vc2013","unknown_mac32_clang7.0","unknown_mac64_clang7.0","unknown_win64_vc2019"];

  for (var i in configurations) {
    var c = configurations[i];
    $("#configuration").append($("<li>", {class : (c == thisConfig ? "active" : "")}).append($("<a>", {href: c + ".html"}).append(c)));
  }
  })
});

function drawTable(type, timeData) {
	var data = google.visualization.arrayToDataTable(timeData);
    data.addColumn('number', 'Speedup');
    data.sort([{ column: 1, desc: true }]);
    var formatter1 = new google.visualization.NumberFormat({ fractionDigits: 3 });
    formatter1.format(data, 1);

	var div = document.createElement("div");
	div.className = "tablechart";
	$("#main").append(div);
    var table = new google.visualization.Table(div);
    redrawTable(0);
    table.setSelection([{ row: 0, column: null}]);

    function redrawTable(selectedRow) {
        // Compute relative time using the first row as basis
        var basis = data.getValue(selectedRow, 1);
        for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
            data.setValue(rowIndex, 2, basis / data.getValue(rowIndex, 1));

        var formatter = new google.visualization.NumberFormat({suffix: 'x'});
        formatter.format(data, 2); // Apply formatter to second column

        table.draw(data);
    }

    google.visualization.events.addListener(table, 'select',
    function() {
        var selection = table.getSelection();
        if (selection.length > 0) {
            var item = selection[0];
            if (item.row != null)
                redrawTable(item.row);
        }
    });

}

function drawBarChart(type, timeData) {
    var defaultColors = ["#3366cc","#dc3912","#ff9900","#109618","#990099","#0099c6","#dd4477","#66aa00","#b82e2e","#316395","#994499","#22aa99","#aaaa11","#6633cc","#e67300","#8b0707","#651067","#329262","#5574a6","#3b3eac","#b77322","#16d620","#b91383","#f4359e","#9c5935","#a9c413","#2a778d","#668d1c","#bea413","#0c5922","#743411"];

	var data = google.visualization.arrayToDataTable(timeData);
	data.addColumn({ type: "string", role: "style" })
	for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
		data.setValue(rowIndex, 2, defaultColors[rowIndex]);

    data.sort([{ column: 1, desc: true }]);
	var options = { 
		title: type,
		chartArea: {'width': '70%', 'height': '70%'},
		width: 800,
		height: 300,
		legend: { position: "none" },
		hAxis: { title: "Time (ns)" }
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_time");
	$("#main").append(div);
	var chart = new google.visualization.BarChart(div);

	chart.draw(data, options);
}

function drawDigitChart(type, timeDigitData) {
	var data = google.visualization.arrayToDataTable(timeDigitData);

	var options = { 
		title: type,
		chartArea: {left:100, 'width': '60%', 'height': '80%'},
		hAxis: {
			title: "Digit",
			gridlines: { count: timeDigitData.length - 1 },
			maxAlternation: 1,
			minTextSpacing: 0
		},
		vAxis: {
			title: "Time (ns) in log scale",
			logScale: true,
			minorGridlines: { count: 0 },
      baseline: 0,
      viewWindow: {max: 150, min: 20},
      minorGridlines: {interval: [1,2,3,4,5,6,7,8,9,10]}
		},
		width: 800,
		height: 600
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_timedigit");
	$("#main").append(div);
	var chart = new google.visualization.LineChart(div);

	chart.draw(data, options);
}

// http://jsfiddle.net/P6XXM/
function sanitize(svg) {
    svg = svg
        .replace(/\<svg/,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1"')
        .replace(/zIndex="[^"]+"/g, '')
        .replace(/isShadow="[^"]+"/g, '')
        .replace(/symbolName="[^"]+"/g, '')
        .replace(/jQuery[0-9]+="[^"]+"/g, '')
        .replace(/isTracker="[^"]+"/g, '')
        .replace(/url\([^#]+#/g, 'url(#')
        .replace('<svg xmlns:xlink="http://www.w3.org/1999/xlink" ', '<svg ')
        .replace(/ href=/g, ' xlink:href=')
    /*.replace(/preserveAspectRatio="none">/g, 'preserveAspectRatio="none"/>')*/
    /* This fails in IE < 8
    .replace(/([0-9]+)\.([0-9]+)/g, function(s1, s2, s3) { // round off to save weight
    return s2 +'.'+ s3[0];
    })*/

    // IE specific
        .replace(/id=([^" >]+)/g, 'id="$1"')
        .replace(/class=([^" ]+)/g, 'class="$1"')
        .replace(/ transform /g, ' ')
        .replace(/:(path|rect)/g, '$1')
        .replace(/<img ([^>]*)>/gi, '<image $1 />')
        .replace(/<\/image>/g, '') // remove closing tags for images as they'll never have any content
        .replace(/<image ([^>]*)([^\/])>/gi, '<image $1$2 />') // closes image tags for firefox
        .replace(/width=(\d+)/g, 'width="$1"')
        .replace(/height=(\d+)/g, 'height="$1"')
        .replace(/hc-svg-href="/g, 'xlink:href="')
        .replace(/style="([^"]+)"/g, function (s) {
            return s.toLowerCase();
        });

    // IE9 beta bugs with innerHTML. Test again with final IE9.
    svg = svg.replace(/(url\(#highcharts-[0-9]+)&quot;/g, '$1')
        .replace(/&quot;/g, "'");
    if (svg.match(/ xmlns="/g).length == 2) {
        svg = svg.replace(/xmlns="[^"]+"/, '');
    }

    return svg;
}
</script>
<style type="text/css">
@media (min-width: 800px) {
  .container {
    max-width: 800px;
  }
}
textarea {
	font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace;
}
.tablechart {
	width: 700px;
	margin: auto;
	padding-top: 20px;
	padding-bottom: 20px;
}
.chart {
	padding-top: 20px;
	padding-bottom: 20px;
}
body { padding-top: 70px; }
</style>
</head>
<body>
<div class="container">
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://github.com/miloyip/dtoa-benchmark"><span class="glyphicon glyphicon-home"></span> dtoa-benchmark</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Configuration <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="configuration">
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Section <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="section">
          </ul>
        </li>
      </ul>
      <p class="navbar-text navbar-right">Developed by <a href="https://github.com/miloyip" class="navbar-link">Milo Yip</a></p>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
<div class="page-header">
<h1 id="title">unknown_win64_vc2019</h1>
</div>
<div id="main"></div>
<h2>Source CSV</h2>
<textarea id="textInput" class="form-control" rows="5" readonly>
  Type,Function,Digit,Time(ns)
randomdigit,doubleconv,1,72.040000
randomdigit,doubleconv,2,80.278000
randomdigit,doubleconv,3,88.939000
randomdigit,doubleconv,4,91.168000
randomdigit,doubleconv,5,101.799000
randomdigit,doubleconv,6,106.004000
randomdigit,doubleconv,7,110.203000
randomdigit,doubleconv,8,115.837000
randomdigit,doubleconv,9,118.640000
randomdigit,doubleconv,10,119.725000
randomdigit,doubleconv,11,123.077000
randomdigit,doubleconv,12,121.398000
randomdigit,doubleconv,13,130.784000
randomdigit,doubleconv,14,130.315000
randomdigit,doubleconv,15,139.500000
randomdigit,doubleconv,16,141.527000
randomdigit,doubleconv,17,147.928000
randomdigit,emyg,1,48.829000
randomdigit,emyg,2,55.754000
randomdigit,emyg,3,57.741000
randomdigit,emyg,4,60.537000
randomdigit,emyg,5,63.929000
randomdigit,emyg,6,65.334000
randomdigit,emyg,7,66.874000
randomdigit,emyg,8,70.220000
randomdigit,emyg,9,71.580000
randomdigit,emyg,10,74.002000
randomdigit,emyg,11,76.636000
randomdigit,emyg,12,79.035000
randomdigit,emyg,13,80.009000
randomdigit,emyg,14,82.576000
randomdigit,emyg,15,83.164000
randomdigit,emyg,16,85.358000
randomdigit,emyg,17,89.731000
randomdigit,erthink,1,34.313000
randomdigit,erthink,2,33.299000
randomdigit,erthink,3,35.628000
randomdigit,erthink,4,39.009000
randomdigit,erthink,5,39.059000
randomdigit,erthink,6,39.683000
randomdigit,erthink,7,40.978000
randomdigit,erthink,8,42.782000
randomdigit,erthink,9,43.092000
randomdigit,erthink,10,44.784000
randomdigit,erthink,11,46.504000
randomdigit,erthink,12,47.815000
randomdigit,erthink,13,49.784000
randomdigit,erthink,14,50.936000
randomdigit,erthink,15,56.890000
randomdigit,erthink,16,55.476000
randomdigit,erthink,17,58.125000
randomdigit,floaxie,1,31.138000
randomdigit,floaxie,2,36.260000
randomdigit,floaxie,3,41.226000
randomdigit,floaxie,4,47.129000
randomdigit,floaxie,5,53.734000
randomdigit,floaxie,6,60.593000
randomdigit,floaxie,7,69.497000
randomdigit,floaxie,8,76.916000
randomdigit,floaxie,9,82.900000
randomdigit,floaxie,10,94.205000
randomdigit,floaxie,11,97.237000
randomdigit,floaxie,12,100.191000
randomdigit,floaxie,13,103.843000
randomdigit,floaxie,14,104.284000
randomdigit,floaxie,15,103.434000
randomdigit,floaxie,16,111.144000
randomdigit,floaxie,17,111.426000
randomdigit,fmt,1,51.073000
randomdigit,fmt,2,54.790000
randomdigit,fmt,3,51.400000
randomdigit,fmt,4,53.916000
randomdigit,fmt,5,52.457000
randomdigit,fmt,6,54.183000
randomdigit,fmt,7,52.663000
randomdigit,fmt,8,53.647000
randomdigit,fmt,9,57.270000
randomdigit,fmt,10,64.438000
randomdigit,fmt,11,59.150000
randomdigit,fmt,12,60.250000
randomdigit,fmt,13,56.576000
randomdigit,fmt,14,58.694000
randomdigit,fmt,15,55.954000
randomdigit,fmt,16,60.483000
randomdigit,fmt,17,65.216000
randomdigit,grisu2,1,110.457000
randomdigit,grisu2,2,124.198000
randomdigit,grisu2,3,124.444000
randomdigit,grisu2,4,125.805000
randomdigit,grisu2,5,128.375000
randomdigit,grisu2,6,130.214000
randomdigit,grisu2,7,132.126000
randomdigit,grisu2,8,136.866000
randomdigit,grisu2,9,140.179000
randomdigit,grisu2,10,141.997000
randomdigit,grisu2,11,142.502000
randomdigit,grisu2,12,145.999000
randomdigit,grisu2,13,147.283000
randomdigit,grisu2,14,149.022000
randomdigit,grisu2,15,155.427000
randomdigit,grisu2,16,153.475000
randomdigit,grisu2,17,156.211000
randomdigit,milo,1,51.832000
randomdigit,milo,2,56.132000
randomdigit,milo,3,59.549000
randomdigit,milo,4,61.409000
randomdigit,milo,5,64.716000
randomdigit,milo,6,63.489000
randomdigit,milo,7,65.560000
randomdigit,milo,8,69.485000
randomdigit,milo,9,72.033000
randomdigit,milo,10,73.350000
randomdigit,milo,11,75.888000
randomdigit,milo,12,77.530000
randomdigit,milo,13,79.932000
randomdigit,milo,14,81.574000
randomdigit,milo,15,83.514000
randomdigit,milo,16,84.166000
randomdigit,milo,17,93.088000
randomdigit,ryu,1,59.117000
randomdigit,ryu,2,60.231000
randomdigit,ryu,3,58.345000
randomdigit,ryu,4,55.863000
randomdigit,ryu,5,54.240000
randomdigit,ryu,6,52.756000
randomdigit,ryu,7,50.562000
randomdigit,ryu,8,50.994000
randomdigit,ryu,9,48.653000
randomdigit,ryu,10,50.531000
randomdigit,ryu,11,46.339000
randomdigit,ryu,12,45.504000
randomdigit,ryu,13,44.232000
randomdigit,ryu,14,41.893000
randomdigit,ryu,15,40.296000
randomdigit,ryu,16,38.059000
randomdigit,ryu,17,39.753000
randomdigit,dragonbox,1,28.662000
randomdigit,dragonbox,2,29.982000
randomdigit,dragonbox,3,28.968000
randomdigit,dragonbox,4,30.906000
randomdigit,dragonbox,5,28.103000
randomdigit,dragonbox,6,30.215000
randomdigit,dragonbox,7,28.454000
randomdigit,dragonbox,8,29.088000
randomdigit,dragonbox,9,28.699000
randomdigit,dragonbox,10,29.936000
randomdigit,dragonbox,11,30.411000
randomdigit,dragonbox,12,31.132000
randomdigit,dragonbox,13,29.736000
randomdigit,dragonbox,14,29.943000
randomdigit,dragonbox,15,30.164000
randomdigit,dragonbox,16,30.110000
randomdigit,dragonbox,17,34.270000
randomdigit,dragonbox_comp,1,34.215000
randomdigit,dragonbox_comp,2,37.091000
randomdigit,dragonbox_comp,3,35.539000
randomdigit,dragonbox_comp,4,37.063000
randomdigit,dragonbox_comp,5,35.137000
randomdigit,dragonbox_comp,6,35.275000
randomdigit,dragonbox_comp,7,33.788000
randomdigit,dragonbox_comp,8,36.279000
randomdigit,dragonbox_comp,9,34.725000
randomdigit,dragonbox_comp,10,34.814000
randomdigit,dragonbox_comp,11,35.377000
randomdigit,dragonbox_comp,12,36.647000
randomdigit,dragonbox_comp,13,35.320000
randomdigit,dragonbox_comp,14,35.850000
randomdigit,dragonbox_comp,15,36.855000
randomdigit,dragonbox_comp,16,35.120000
randomdigit,dragonbox_comp,17,41.001000
randomdigit,fmt_full_cache,1,42.870000
randomdigit,fmt_full_cache,2,45.809000
randomdigit,fmt_full_cache,3,44.913000
randomdigit,fmt_full_cache,4,48.318000
randomdigit,fmt_full_cache,5,65.218000
randomdigit,fmt_full_cache,6,48.924000
randomdigit,fmt_full_cache,7,44.956000
randomdigit,fmt_full_cache,8,47.582000
randomdigit,fmt_full_cache,9,51.438000
randomdigit,fmt_full_cache,10,52.535000
randomdigit,fmt_full_cache,11,51.322000
randomdigit,fmt_full_cache,12,54.425000
randomdigit,fmt_full_cache,13,51.324000
randomdigit,fmt_full_cache,14,55.249000
randomdigit,fmt_full_cache,15,51.645000
randomdigit,fmt_full_cache,16,53.969000
randomdigit,fmt_full_cache,17,57.242000
</textarea>
</div>
<div class="row" id="downloadDD" style="display: none">
<div class="btn-group pull-right" >
    <button class="btn dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-picture"></span></button>
    <ul class="dropdown-menu">
        <li><a tabindex="-1" href="#" dltype="image/jpeg">JPEG</a></li>
        <li><a tabindex="-1" href="#" dltype="image/png">PNG</a></li>
        <li><a tabindex="-1" href="#" dltype="application/pdf">PDF</a></li>
        <li><a tabindex="-1" href="#" dltype="image/svg+xml">SVG</a></li>
    </ul>
</div>
</div>
<form method="post" action="http://export.highcharts.com/" id="imageGetForm">
    <input type="hidden" name="filename" id="imageFilename" value="" />
    <input type="hidden" name="type" id="imageGetFormTYPE" value="" />
    <input type="hidden" name="width" value="900" />
    <input type="hidden" name="svg" value="" id="imageGetFormSVG" />
</form>
</div>
</body>
</html>