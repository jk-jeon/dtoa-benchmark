<html>
<head>
<script src="http://code.jquery.com/jquery-1.8.2.js"></script>
<script src="http://www.google.com/jsapi?autoload={'modules':[{'name':'visualization','version':'1','packages':['controls', 'charteditor']}]}"></script>
<script src="https://web.archive.org/web/20160324220311/http://jquery-csv.googlecode.com/git/src/jquery.csv.js"></script>
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script>
$(function() {
	google.load("visualization", "1", {packages:["corechart"]});

    var csv = $('#textInput').val();
    var data = $.csv.toArrays(csv, {
        onParseValue: $.csv.hooks.castToScalar
    });

    // Convert data for bar chart (summing all digits)
    var timeData = {};	// type -> table
    var funcRowMap;
    var maxDigit = 0;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
      var digit = data[i][2];
   		var time = data[i][3];
   		if (timeData[type] == null) {
   			timeData[type] = [["Function", "Time (ns)"/*, { role: "style" }*/]];
        if (digit != 0)
   			  funcRowMap = {};
   		}

   		var table = timeData[type];
   		
      if (digit != 0) {
     		if (funcRowMap[func] == null)
     			funcRowMap[func] = table.push([func, 0]) - 1;
     		
     		table[funcRowMap[func]][1] += time;
      }
      else 
        table.push([func, time]);

      maxDigit = Math.max(maxDigit, digit);
    }

    // Compute average
    for (var type in timeData) {
      var table = timeData[type];
      for (var i = 1; i < table.length; i++)
        table[i][1] /= maxDigit;
    }

    // Convert data for drawing line chart per random digit
    var timeDigitData = {}; // type -> table
    var funcColumnMap;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
		  var digit = data[i][2];
   		var time = data[i][3];

      if (digit == 0)
        continue;

   		if (timeDigitData[type] == null) {
   			timeDigitData[type] = [["Digit"]];
   			funcColumnMap = {};
   		}

   		var table = timeDigitData[type];

   		if (funcColumnMap[func] == null)
   			funcColumnMap[func] = table[0].push(func) - 1;

   		var row;
   		for (row = 1; row < table.length; row++)
   			if (table[row][0] == digit)
   				break;

    	if (row == table.length)
    		table.push([digit]);

		table[row][funcColumnMap[func]] = time;
	}

	for (var type in timeData) {
		$("#main").append(
      $("<a>", {name: type}),
      $("<h2>", {style: "padding-top: 70px; margin-top: -70px;"}).append(type)
    );

    $("#section").append($("<li>").append($("<a>", {href: "#" + type}).append(type)));

		drawTable(type, timeData[type]);
		drawBarChart(type, timeData[type]);
    if (timeDigitData[type] != null)
		  drawDigitChart(type, timeDigitData[type]);
	}

	$(".chart").each(function() {
		var chart = $(this);
		var d = $("#downloadDD").clone().css("display", "");
		$('li a', d).each(function() {
	        $(this).click(function() {
	            var svg = chart[0].getElementsByTagName('svg')[0].parentNode.innerHTML;
	            svg=sanitize(svg);
	            $('#imageFilename').val($("#title").html() + "_" + chart.data("filename"));
	            $('#imageGetFormTYPE').val($(this).attr('dltype'));
	            $('#imageGetFormSVG').val(svg);
	            $('#imageGetForm').submit();
	        });
	    });		
		$(this).after(d);
	});

  // Add configurations
  var thisConfig = "unknown_win64_vc2019";
  var configurations = ["corei7920@2.67_cygwin32_gcc4.8","corei7920@2.67_cygwin64_gcc4.8","corei7920@2.67_win32_vc2013","corei7920@2.67_win64_vc2013","unknown_mac32_clang7.0","unknown_mac64_clang7.0","unknown_win64_vc2019"];

  for (var i in configurations) {
    var c = configurations[i];
    $("#configuration").append($("<li>", {class : (c == thisConfig ? "active" : "")}).append($("<a>", {href: c + ".html"}).append(c)));
  }
});

function drawTable(type, timeData) {
	var data = google.visualization.arrayToDataTable(timeData);
    data.addColumn('number', 'Speedup');
    data.sort([{ column: 1, desc: true }]);
    var formatter1 = new google.visualization.NumberFormat({ fractionDigits: 3 });
    formatter1.format(data, 1);

	var div = document.createElement("div");
	div.className = "tablechart";
	$("#main").append(div);
    var table = new google.visualization.Table(div);
    redrawTable(0);
    table.setSelection([{ row: 0, column: null}]);

    function redrawTable(selectedRow) {
        // Compute relative time using the first row as basis
        var basis = data.getValue(selectedRow, 1);
        for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
            data.setValue(rowIndex, 2, basis / data.getValue(rowIndex, 1));

        var formatter = new google.visualization.NumberFormat({suffix: 'x'});
        formatter.format(data, 2); // Apply formatter to second column

        table.draw(data);
    }

    google.visualization.events.addListener(table, 'select',
    function() {
        var selection = table.getSelection();
        if (selection.length > 0) {
            var item = selection[0];
            if (item.row != null)
                redrawTable(item.row);
        }
    });

}

function drawBarChart(type, timeData) {
    var defaultColors = ["#3366cc","#dc3912","#ff9900","#109618","#990099","#0099c6","#dd4477","#66aa00","#b82e2e","#316395","#994499","#22aa99","#aaaa11","#6633cc","#e67300","#8b0707","#651067","#329262","#5574a6","#3b3eac","#b77322","#16d620","#b91383","#f4359e","#9c5935","#a9c413","#2a778d","#668d1c","#bea413","#0c5922","#743411"];

	var data = google.visualization.arrayToDataTable(timeData);
	data.addColumn({ type: "string", role: "style" })
	for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
		data.setValue(rowIndex, 2, defaultColors[rowIndex]);

    data.sort([{ column: 1, desc: true }]);
	var options = { 
		title: type,
		chartArea: {'width': '70%', 'height': '70%'},
		width: 800,
		height: 300,
		legend: { position: "none" },
		hAxis: { title: "Time (ns)" }
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_time");
	$("#main").append(div);
	var chart = new google.visualization.BarChart(div);

	chart.draw(data, options);
}

function drawDigitChart(type, timeDigitData) {
	var data = google.visualization.arrayToDataTable(timeDigitData);

	var options = { 
		title: type,
		chartArea: {'width': '70%', 'height': '80%'},
		hAxis: {
			title: "Digit",
			gridlines: { count: timeDigitData.length - 1 },
			maxAlternation: 1,
			minTextSpacing: 0
		},
		vAxis: {
			title: "Time (ns) in log scale",
			logScale: true,
			minorGridlines: { count: 10 },
      baseline: 0
		},
		width: 800,
		height: 600
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_timedigit");
	$("#main").append(div);
	var chart = new google.visualization.LineChart(div);

	chart.draw(data, options);
}

// http://jsfiddle.net/P6XXM/
function sanitize(svg) {
    svg = svg
        .replace(/\<svg/,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1"')
        .replace(/zIndex="[^"]+"/g, '')
        .replace(/isShadow="[^"]+"/g, '')
        .replace(/symbolName="[^"]+"/g, '')
        .replace(/jQuery[0-9]+="[^"]+"/g, '')
        .replace(/isTracker="[^"]+"/g, '')
        .replace(/url\([^#]+#/g, 'url(#')
        .replace('<svg xmlns:xlink="http://www.w3.org/1999/xlink" ', '<svg ')
        .replace(/ href=/g, ' xlink:href=')
    /*.replace(/preserveAspectRatio="none">/g, 'preserveAspectRatio="none"/>')*/
    /* This fails in IE < 8
    .replace(/([0-9]+)\.([0-9]+)/g, function(s1, s2, s3) { // round off to save weight
    return s2 +'.'+ s3[0];
    })*/

    // IE specific
        .replace(/id=([^" >]+)/g, 'id="$1"')
        .replace(/class=([^" ]+)/g, 'class="$1"')
        .replace(/ transform /g, ' ')
        .replace(/:(path|rect)/g, '$1')
        .replace(/<img ([^>]*)>/gi, '<image $1 />')
        .replace(/<\/image>/g, '') // remove closing tags for images as they'll never have any content
        .replace(/<image ([^>]*)([^\/])>/gi, '<image $1$2 />') // closes image tags for firefox
        .replace(/width=(\d+)/g, 'width="$1"')
        .replace(/height=(\d+)/g, 'height="$1"')
        .replace(/hc-svg-href="/g, 'xlink:href="')
        .replace(/style="([^"]+)"/g, function (s) {
            return s.toLowerCase();
        });

    // IE9 beta bugs with innerHTML. Test again with final IE9.
    svg = svg.replace(/(url\(#highcharts-[0-9]+)&quot;/g, '$1')
        .replace(/&quot;/g, "'");
    if (svg.match(/ xmlns="/g).length == 2) {
        svg = svg.replace(/xmlns="[^"]+"/, '');
    }

    return svg;
}
</script>
<style type="text/css">
@media (min-width: 800px) {
  .container {
    max-width: 800px;
  }
}
textarea {
	font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace;
}
.tablechart {
	width: 700px;
	margin: auto;
	padding-top: 20px;
	padding-bottom: 20px;
}
.chart {
	padding-top: 20px;
	padding-bottom: 20px;
}
body { padding-top: 70px; }
</style>
</head>
<body>
<div class="container">
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://github.com/miloyip/dtoa-benchmark"><span class="glyphicon glyphicon-home"></span> dtoa-benchmark</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Configuration <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="configuration">
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Section <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="section">
          </ul>
        </li>
      </ul>
      <p class="navbar-text navbar-right">Developed by <a href="https://github.com/miloyip" class="navbar-link">Milo Yip</a></p>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
<div class="page-header">
<h1 id="title">unknown_win64_vc2019</h1>
</div>
<div id="main"></div>
<h2>Source CSV</h2>
<textarea id="textInput" class="form-control" rows="5" readonly>
Type,Function,Digit,Time(ns)
randomdigit,doubleconv,1,98.946643
randomdigit,doubleconv,2,109.146538
randomdigit,doubleconv,3,115.276686
randomdigit,doubleconv,4,121.202618
randomdigit,doubleconv,5,125.768320
randomdigit,doubleconv,6,129.374933
randomdigit,doubleconv,7,133.535848
randomdigit,doubleconv,8,136.424056
randomdigit,doubleconv,9,135.971862
randomdigit,doubleconv,10,138.473517
randomdigit,doubleconv,11,141.350784
randomdigit,doubleconv,12,141.146567
randomdigit,doubleconv,13,143.564347
randomdigit,doubleconv,14,152.028401
randomdigit,doubleconv,15,153.778830
randomdigit,doubleconv,16,158.731085
randomdigit,doubleconv,17,167.815082
randomdigit,emyg,1,64.393905
randomdigit,emyg,2,69.433682
randomdigit,emyg,3,72.551633
randomdigit,emyg,4,75.355966
randomdigit,emyg,5,78.397336
randomdigit,emyg,6,81.332952
randomdigit,emyg,7,84.060703
randomdigit,emyg,8,86.653526
randomdigit,emyg,9,89.271876
randomdigit,emyg,10,91.744357
randomdigit,emyg,11,95.361910
randomdigit,emyg,12,97.644761
randomdigit,emyg,13,100.047954
randomdigit,emyg,14,101.969780
randomdigit,emyg,15,104.289098
randomdigit,emyg,16,107.159072
randomdigit,emyg,17,112.155088
randomdigit,floaxie,1,43.629441
randomdigit,floaxie,2,51.433437
randomdigit,floaxie,3,58.223643
randomdigit,floaxie,4,65.695786
randomdigit,floaxie,5,72.325536
randomdigit,floaxie,6,79.961782
randomdigit,floaxie,7,87.003612
randomdigit,floaxie,8,93.888633
randomdigit,floaxie,9,101.255021
randomdigit,floaxie,10,104.854341
randomdigit,floaxie,11,106.604770
randomdigit,floaxie,12,107.323175
randomdigit,floaxie,13,108.785512
randomdigit,floaxie,14,110.061867
randomdigit,floaxie,15,111.075657
randomdigit,floaxie,16,113.095944
randomdigit,floaxie,17,113.548138
randomdigit,fmt,1,146.441615
randomdigit,fmt,2,154.708745
randomdigit,fmt,3,157.505785
randomdigit,fmt,4,161.473424
randomdigit,fmt,5,162.975875
randomdigit,fmt,6,165.896903
randomdigit,fmt,7,170.127107
randomdigit,fmt,8,171.848362
randomdigit,fmt,9,173.328933
randomdigit,fmt,10,176.268195
randomdigit,fmt,11,178.153553
randomdigit,fmt,12,180.582273
randomdigit,fmt,13,183.098515
randomdigit,fmt,14,185.392306
randomdigit,fmt,15,188.349801
randomdigit,fmt,16,190.727467
randomdigit,fmt,17,195.577614
randomdigit,fpconv,1,122.519086
randomdigit,fpconv,2,132.314195
randomdigit,fpconv,3,142.102010
randomdigit,fpconv,4,150.234211
randomdigit,fpconv,5,157.586013
randomdigit,fpconv,6,163.172798
randomdigit,fpconv,7,168.314683
randomdigit,fpconv,8,172.778277
randomdigit,fpconv,9,174.127566
randomdigit,fpconv,10,175.549790
randomdigit,fpconv,11,177.723239
randomdigit,fpconv,12,180.213953
randomdigit,fpconv,13,182.766662
randomdigit,fpconv,14,184.225353
randomdigit,fpconv,15,186.759828
randomdigit,fpconv,16,190.793108
randomdigit,fpconv,17,197.247815
randomdigit,grisu2,1,122.387804
randomdigit,grisu2,2,130.228267
randomdigit,grisu2,3,129.068608
randomdigit,grisu2,4,129.958409
randomdigit,grisu2,5,133.105534
randomdigit,grisu2,6,135.964568
randomdigit,grisu2,7,137.864513
randomdigit,grisu2,8,140.614145
randomdigit,grisu2,9,144.027482
randomdigit,grisu2,10,145.686743
randomdigit,grisu2,11,150.434781
randomdigit,grisu2,12,153.096892
randomdigit,grisu2,13,155.055184
randomdigit,grisu2,14,157.429203
randomdigit,grisu2,15,159.890744
randomdigit,grisu2,16,164.033426
randomdigit,grisu2,17,171.370641
randomdigit,jkl,1,35.584762
randomdigit,jkl,2,39.344537
randomdigit,jkl,3,40.522430
randomdigit,jkl,4,40.234339
randomdigit,jkl,5,40.919923
randomdigit,jkl,6,41.346590
randomdigit,jkl,7,42.240039
randomdigit,jkl,8,41.426818
randomdigit,jkl,9,42.422375
randomdigit,jkl,10,43.964940
randomdigit,jkl,11,45.091779
randomdigit,jkl,12,44.340553
randomdigit,jkl,13,45.580440
randomdigit,jkl,14,47.440271
randomdigit,jkl,15,48.895315
randomdigit,jkl,16,48.610871
randomdigit,jkl,17,52.181016
randomdigit,milo,1,57.990252
randomdigit,milo,2,63.474930
randomdigit,milo,3,66.344904
randomdigit,milo,4,69.834822
randomdigit,milo,5,72.394824
randomdigit,milo,6,76.187420
randomdigit,milo,7,78.131125
randomdigit,milo,8,81.843493
randomdigit,milo,9,83.561102
randomdigit,milo,10,86.999965
randomdigit,milo,11,90.829029
randomdigit,milo,12,91.295810
randomdigit,milo,13,93.239515
randomdigit,milo,14,95.263449
randomdigit,milo,15,97.761457
randomdigit,milo,16,101.750976
randomdigit,milo,17,104.879868
randomdigit,milo_only_Grisu2,1,43.545567
randomdigit,milo_only_Grisu2,2,46.608817
randomdigit,milo_only_Grisu2,3,49.537139
randomdigit,milo_only_Grisu2,4,52.326885
randomdigit,milo_only_Grisu2,5,55.211446
randomdigit,milo_only_Grisu2,6,57.818856
randomdigit,milo_only_Grisu2,7,60.382505
randomdigit,milo_only_Grisu2,8,62.599715
randomdigit,milo_only_Grisu2,9,64.922680
randomdigit,milo_only_Grisu2,10,67.413395
randomdigit,milo_only_Grisu2,11,70.855905
randomdigit,milo_only_Grisu2,12,72.551633
randomdigit,milo_only_Grisu2,13,74.342176
randomdigit,milo_only_Grisu2,14,76.661494
randomdigit,milo_only_Grisu2,15,78.940699
randomdigit,milo_only_Grisu2,16,85.158368
randomdigit,milo_only_Grisu2,17,83.798139
randomdigit,null,1,1.316468
randomdigit,null,2,1.316468
randomdigit,null,3,1.316468
randomdigit,null,4,1.316468
randomdigit,null,5,1.334702
randomdigit,null,6,1.316468
randomdigit,null,7,1.316468
randomdigit,null,8,1.320115
randomdigit,null,9,1.320115
randomdigit,null,10,1.316468
randomdigit,null,11,1.316468
randomdigit,null,12,1.316468
randomdigit,null,13,1.316468
randomdigit,null,14,1.316468
randomdigit,null,15,1.316468
randomdigit,null,16,1.320115
randomdigit,null,17,1.316468
randomdigit,to_chars,1,82.802583
randomdigit,to_chars,2,83.779905
randomdigit,to_chars,3,86.989025
randomdigit,to_chars,4,83.057854
randomdigit,to_chars,5,75.706052
randomdigit,to_chars,6,73.809754
randomdigit,to_chars,7,71.701946
randomdigit,to_chars,8,69.550377
randomdigit,to_chars,9,67.934877
randomdigit,to_chars,10,68.088039
randomdigit,to_chars,11,65.411342
randomdigit,to_chars,12,63.398348
randomdigit,to_chars,13,62.647123
randomdigit,to_chars,14,61.841196
randomdigit,to_chars,15,60.470027
randomdigit,to_chars,16,59.149911
randomdigit,to_chars,17,60.185582
</textarea>
</div>
<div class="row" id="downloadDD" style="display: none">
<div class="btn-group pull-right" >
    <button class="btn dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-picture"></span></button>
    <ul class="dropdown-menu">
        <li><a tabindex="-1" href="#" dltype="image/jpeg">JPEG</a></li>
        <li><a tabindex="-1" href="#" dltype="image/png">PNG</a></li>
        <li><a tabindex="-1" href="#" dltype="application/pdf">PDF</a></li>
        <li><a tabindex="-1" href="#" dltype="image/svg+xml">SVG</a></li>
    </ul>
</div>
</div>
<form method="post" action="http://export.highcharts.com/" id="imageGetForm">
    <input type="hidden" name="filename" id="imageFilename" value="" />
    <input type="hidden" name="type" id="imageGetFormTYPE" value="" />
    <input type="hidden" name="width" value="900" />
    <input type="hidden" name="svg" value="" id="imageGetFormSVG" />
</form>
</div>
</body>
</html>