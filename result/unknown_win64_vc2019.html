<html>
<head>
<script src="http://code.jquery.com/jquery-1.8.2.js"></script>
<script src="http://www.google.com/jsapi?autoload={%22modules%22:[{%22name%22:%22visualization%22,%22version%22:%221%22,%22packages%22:[%22controls%22,%22charteditor%22]}]}"></script>
<script src="jquery.csv.js"></script>
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script>
$(function() {
	google.load("visualization", "1", {packages:["corechart"]});
  google.setOnLoadCallback(function() {

    var csv = $('#textInput').val();
    var data = $.csv.toArrays(csv, {
        onParseValue: $.csv.hooks.castToScalar
    });

    // Convert data for bar chart (summing all digits)
    var timeData = {};	// type -> table
    var funcRowMap;
    var maxDigit = 0;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
      var digit = data[i][2];
   		var time = data[i][3];
   		if (timeData[type] == null) {
   			timeData[type] = [["Function", "Time (ns)"/*, { role: "style" }*/]];
        if (digit != 0)
   			  funcRowMap = {};
   		}

   		var table = timeData[type];
   		
      if (digit != 0) {
     		if (funcRowMap[func] == null)
     			funcRowMap[func] = table.push([func, 0]) - 1;
     		
     		table[funcRowMap[func]][1] += time;
      }
      else 
        table.push([func, time]);

      maxDigit = Math.max(maxDigit, digit);
    }

    // Compute average
    for (var type in timeData) {
      var table = timeData[type];
      for (var i = 1; i < table.length; i++)
        table[i][1] /= maxDigit;
    }

    // Convert data for drawing line chart per random digit
    var timeDigitData = {}; // type -> table
    var funcColumnMap;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
		  var digit = data[i][2];
   		var time = data[i][3];

      if (digit == 0)
        continue;

   		if (timeDigitData[type] == null) {
   			timeDigitData[type] = [["Digit"]];
   			funcColumnMap = {};
   		}

   		var table = timeDigitData[type];

   		if (funcColumnMap[func] == null)
   			funcColumnMap[func] = table[0].push(func) - 1;

   		var row;
   		for (row = 1; row < table.length; row++)
   			if (table[row][0] == digit)
   				break;

    	if (row == table.length)
    		table.push([digit]);

		table[row][funcColumnMap[func]] = time;
	}

	for (var type in timeData) {
		$("#main").append(
      $("<a>", {name: type}),
      $("<h2>", {style: "padding-top: 70px; margin-top: -70px;"}).append(type)
    );

    $("#section").append($("<li>").append($("<a>", {href: "#" + type}).append(type)));

		drawTable(type, timeData[type]);
		drawBarChart(type, timeData[type]);
    if (timeDigitData[type] != null)
		  drawDigitChart(type, timeDigitData[type]);
	}

	$(".chart").each(function() {
		var chart = $(this);
		var d = $("#downloadDD").clone().css("display", "");
		$('li a', d).each(function() {
	        $(this).click(function() {
	            var svg = chart[0].getElementsByTagName('svg')[0].parentNode.innerHTML;
	            svg=sanitize(svg);
	            $('#imageFilename').val($("#title").html() + "_" + chart.data("filename"));
	            $('#imageGetFormTYPE').val($(this).attr('dltype'));
	            $('#imageGetFormSVG').val(svg);
	            $('#imageGetForm').submit();
	        });
	    });		
		$(this).after(d);
	});

  // Add configurations
  var thisConfig = "unknown_win64_vc2019";
  var configurations = ["corei7920@2.67_cygwin32_gcc4.8","corei7920@2.67_cygwin64_gcc4.8","corei7920@2.67_win32_vc2013","corei7920@2.67_win64_vc2013","unknown_mac32_clang7.0","unknown_mac64_clang7.0","unknown_win64_vc2019"];

  for (var i in configurations) {
    var c = configurations[i];
    $("#configuration").append($("<li>", {class : (c == thisConfig ? "active" : "")}).append($("<a>", {href: c + ".html"}).append(c)));
  }
  })
});

function drawTable(type, timeData) {
	var data = google.visualization.arrayToDataTable(timeData);
    data.addColumn('number', 'Speedup');
    data.sort([{ column: 1, desc: true }]);
    var formatter1 = new google.visualization.NumberFormat({ fractionDigits: 3 });
    formatter1.format(data, 1);

	var div = document.createElement("div");
	div.className = "tablechart";
	$("#main").append(div);
    var table = new google.visualization.Table(div);
    redrawTable(0);
    table.setSelection([{ row: 0, column: null}]);

    function redrawTable(selectedRow) {
        // Compute relative time using the first row as basis
        var basis = data.getValue(selectedRow, 1);
        for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
            data.setValue(rowIndex, 2, basis / data.getValue(rowIndex, 1));

        var formatter = new google.visualization.NumberFormat({suffix: 'x'});
        formatter.format(data, 2); // Apply formatter to second column

        table.draw(data);
    }

    google.visualization.events.addListener(table, 'select',
    function() {
        var selection = table.getSelection();
        if (selection.length > 0) {
            var item = selection[0];
            if (item.row != null)
                redrawTable(item.row);
        }
    });

}

function drawBarChart(type, timeData) {
    var defaultColors = ["#3366cc","#dc3912","#ff9900","#109618","#990099","#0099c6","#dd4477","#66aa00","#b82e2e","#316395","#994499","#22aa99","#aaaa11","#6633cc","#e67300","#8b0707","#651067","#329262","#5574a6","#3b3eac","#b77322","#16d620","#b91383","#f4359e","#9c5935","#a9c413","#2a778d","#668d1c","#bea413","#0c5922","#743411"];

	var data = google.visualization.arrayToDataTable(timeData);
	data.addColumn({ type: "string", role: "style" })
	for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
		data.setValue(rowIndex, 2, defaultColors[rowIndex]);

    data.sort([{ column: 1, desc: true }]);
	var options = { 
		title: type,
		chartArea: {'width': '70%', 'height': '70%'},
		width: 800,
		height: 300,
		legend: { position: "none" },
		hAxis: { title: "Time (ns)" }
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_time");
	$("#main").append(div);
	var chart = new google.visualization.BarChart(div);

	chart.draw(data, options);
}

function drawDigitChart(type, timeDigitData) {
	var data = google.visualization.arrayToDataTable(timeDigitData);

	var options = { 
		title: type,
		chartArea: {left:100, 'width': '60%', 'height': '80%'},
		hAxis: {
			title: "Digit",
			gridlines: { count: timeDigitData.length - 1 },
			maxAlternation: 1,
			minTextSpacing: 0
		},
		vAxis: {
			title: "Time (ns) in log scale",
			logScale: true,
			minorGridlines: { count: 0 },
      baseline: 0,
      viewWindow: {max: 150, min: 20},
      minorGridlines: {interval: [1,2,3,4,5,6,7,8,9,10]}
		},
		width: 800,
		height: 600
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_timedigit");
	$("#main").append(div);
	var chart = new google.visualization.LineChart(div);

	chart.draw(data, options);
}

// http://jsfiddle.net/P6XXM/
function sanitize(svg) {
    svg = svg
        .replace(/\<svg/,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1"')
        .replace(/zIndex="[^"]+"/g, '')
        .replace(/isShadow="[^"]+"/g, '')
        .replace(/symbolName="[^"]+"/g, '')
        .replace(/jQuery[0-9]+="[^"]+"/g, '')
        .replace(/isTracker="[^"]+"/g, '')
        .replace(/url\([^#]+#/g, 'url(#')
        .replace('<svg xmlns:xlink="http://www.w3.org/1999/xlink" ', '<svg ')
        .replace(/ href=/g, ' xlink:href=')
    /*.replace(/preserveAspectRatio="none">/g, 'preserveAspectRatio="none"/>')*/
    /* This fails in IE < 8
    .replace(/([0-9]+)\.([0-9]+)/g, function(s1, s2, s3) { // round off to save weight
    return s2 +'.'+ s3[0];
    })*/

    // IE specific
        .replace(/id=([^" >]+)/g, 'id="$1"')
        .replace(/class=([^" ]+)/g, 'class="$1"')
        .replace(/ transform /g, ' ')
        .replace(/:(path|rect)/g, '$1')
        .replace(/<img ([^>]*)>/gi, '<image $1 />')
        .replace(/<\/image>/g, '') // remove closing tags for images as they'll never have any content
        .replace(/<image ([^>]*)([^\/])>/gi, '<image $1$2 />') // closes image tags for firefox
        .replace(/width=(\d+)/g, 'width="$1"')
        .replace(/height=(\d+)/g, 'height="$1"')
        .replace(/hc-svg-href="/g, 'xlink:href="')
        .replace(/style="([^"]+)"/g, function (s) {
            return s.toLowerCase();
        });

    // IE9 beta bugs with innerHTML. Test again with final IE9.
    svg = svg.replace(/(url\(#highcharts-[0-9]+)&quot;/g, '$1')
        .replace(/&quot;/g, "'");
    if (svg.match(/ xmlns="/g).length == 2) {
        svg = svg.replace(/xmlns="[^"]+"/, '');
    }

    return svg;
}
</script>
<style type="text/css">
@media (min-width: 800px) {
  .container {
    max-width: 800px;
  }
}
textarea {
	font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace;
}
.tablechart {
	width: 700px;
	margin: auto;
	padding-top: 20px;
	padding-bottom: 20px;
}
.chart {
	padding-top: 20px;
	padding-bottom: 20px;
}
body { padding-top: 70px; }
</style>
</head>
<body>
<div class="container">
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://github.com/miloyip/dtoa-benchmark"><span class="glyphicon glyphicon-home"></span> dtoa-benchmark</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Configuration <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="configuration">
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Section <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="section">
          </ul>
        </li>
      </ul>
      <p class="navbar-text navbar-right">Developed by <a href="https://github.com/miloyip" class="navbar-link">Milo Yip</a></p>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
<div class="page-header">
<h1 id="title">unknown_win64_vc2019</h1>
</div>
<div id="main"></div>
<h2>Source CSV</h2>
<textarea id="textInput" class="form-control" rows="5" readonly>
  Type,Function,Digit,Time(ns)
randomdigit,doubleconv,1,96.197000
randomdigit,doubleconv,2,105.083000
randomdigit,doubleconv,3,118.340000
randomdigit,doubleconv,4,118.237000
randomdigit,doubleconv,5,128.739000
randomdigit,doubleconv,6,132.671000
randomdigit,doubleconv,7,133.475000
randomdigit,doubleconv,8,137.958000
randomdigit,doubleconv,9,143.560000
randomdigit,doubleconv,10,139.389000
randomdigit,doubleconv,11,145.617000
randomdigit,doubleconv,12,145.993000
randomdigit,doubleconv,13,151.152000
randomdigit,doubleconv,14,157.637000
randomdigit,doubleconv,15,160.676000
randomdigit,doubleconv,16,173.428000
randomdigit,doubleconv,17,171.758000
randomdigit,emyg,1,71.404000
randomdigit,emyg,2,82.114000
randomdigit,emyg,3,82.668000
randomdigit,emyg,4,85.740000
randomdigit,emyg,5,90.603000
randomdigit,emyg,6,93.435000
randomdigit,emyg,7,96.303000
randomdigit,emyg,8,97.691000
randomdigit,emyg,9,102.889000
randomdigit,emyg,10,105.899000
randomdigit,emyg,11,108.444000
randomdigit,emyg,12,110.824000
randomdigit,emyg,13,115.248000
randomdigit,emyg,14,116.861000
randomdigit,emyg,15,121.206000
randomdigit,emyg,16,122.172000
randomdigit,emyg,17,128.727000
randomdigit,floaxie,1,53.867000
randomdigit,floaxie,2,61.397000
randomdigit,floaxie,3,68.629000
randomdigit,floaxie,4,75.555000
randomdigit,floaxie,5,84.290000
randomdigit,floaxie,6,91.108000
randomdigit,floaxie,7,97.638000
randomdigit,floaxie,8,104.319000
randomdigit,floaxie,9,111.777000
randomdigit,floaxie,10,114.909000
randomdigit,floaxie,11,117.622000
randomdigit,floaxie,12,117.089000
randomdigit,floaxie,13,119.183000
randomdigit,floaxie,14,119.198000
randomdigit,floaxie,15,119.998000
randomdigit,floaxie,16,122.015000
randomdigit,floaxie,17,124.545000
randomdigit,fmt,1,105.909000
randomdigit,fmt,2,105.293000
randomdigit,fmt,3,113.579000
randomdigit,fmt,4,118.950000
randomdigit,fmt,5,119.931000
randomdigit,fmt,6,125.249000
randomdigit,fmt,7,161.062000
randomdigit,fmt,8,164.496000
randomdigit,fmt,9,126.881000
randomdigit,fmt,10,136.293000
randomdigit,fmt,11,141.199000
randomdigit,fmt,12,142.470000
randomdigit,fmt,13,145.236000
randomdigit,fmt,14,149.090000
randomdigit,fmt,15,150.286000
randomdigit,fmt,16,159.707000
randomdigit,fmt,17,155.124000
randomdigit,grisu2,1,104.053000
randomdigit,grisu2,2,115.099000
randomdigit,grisu2,3,113.903000
randomdigit,grisu2,4,113.160000
randomdigit,grisu2,5,115.650000
randomdigit,grisu2,6,118.367000
randomdigit,grisu2,7,121.196000
randomdigit,grisu2,8,119.275000
randomdigit,grisu2,9,124.722000
randomdigit,grisu2,10,126.297000
randomdigit,grisu2,11,130.442000
randomdigit,grisu2,12,130.656000
randomdigit,grisu2,13,132.456000
randomdigit,grisu2,14,134.016000
randomdigit,grisu2,15,139.041000
randomdigit,grisu2,16,140.992000
randomdigit,grisu2,17,153.351000
randomdigit,milo,1,61.840000
randomdigit,milo,2,70.154000
randomdigit,milo,3,75.064000
randomdigit,milo,4,78.878000
randomdigit,milo,5,78.201000
randomdigit,milo,6,82.032000
randomdigit,milo,7,85.769000
randomdigit,milo,8,112.149000
randomdigit,milo,9,121.872000
randomdigit,milo,10,122.871000
randomdigit,milo,11,100.041000
randomdigit,milo,12,101.585000
randomdigit,milo,13,106.709000
randomdigit,milo,14,108.928000
randomdigit,milo,15,111.439000
randomdigit,milo,16,109.803000
randomdigit,milo,17,114.200000
randomdigit,ryu,1,62.687000
randomdigit,ryu,2,61.939000
randomdigit,ryu,3,62.049000
randomdigit,ryu,4,60.240000
randomdigit,ryu,5,57.111000
randomdigit,ryu,6,55.933000
randomdigit,ryu,7,55.276000
randomdigit,ryu,8,53.199000
randomdigit,ryu,9,49.803000
randomdigit,ryu,10,50.706000
randomdigit,ryu,11,49.300000
randomdigit,ryu,12,46.716000
randomdigit,ryu,13,43.824000
randomdigit,ryu,14,43.464000
randomdigit,ryu,15,41.515000
randomdigit,ryu,16,41.469000
randomdigit,ryu,17,39.799000
randomdigit,dragonbox,1,43.616000
randomdigit,dragonbox,2,46.712000
randomdigit,dragonbox,3,44.131000
randomdigit,dragonbox,4,43.880000
randomdigit,dragonbox,5,43.194000
randomdigit,dragonbox,6,42.937000
randomdigit,dragonbox,7,42.374000
randomdigit,dragonbox,8,42.350000
randomdigit,dragonbox,9,45.151000
randomdigit,dragonbox,10,47.395000
randomdigit,dragonbox,11,46.243000
randomdigit,dragonbox,12,45.980000
randomdigit,dragonbox,13,44.525000
randomdigit,dragonbox,14,44.972000
randomdigit,dragonbox,15,44.897000
randomdigit,dragonbox,16,44.850000
randomdigit,dragonbox,17,47.033000
randomdigit,dragonbox_comp,1,55.255000
randomdigit,dragonbox_comp,2,58.534000
randomdigit,dragonbox_comp,3,56.632000
randomdigit,dragonbox_comp,4,55.965000
randomdigit,dragonbox_comp,5,53.827000
randomdigit,dragonbox_comp,6,52.489000
randomdigit,dragonbox_comp,7,53.391000
randomdigit,dragonbox_comp,8,52.360000
randomdigit,dragonbox_comp,9,56.042000
randomdigit,dragonbox_comp,10,58.259000
randomdigit,dragonbox_comp,11,56.035000
randomdigit,dragonbox_comp,12,54.945000
randomdigit,dragonbox_comp,13,56.478000
randomdigit,dragonbox_comp,14,56.673000
randomdigit,dragonbox_comp,15,55.051000
randomdigit,dragonbox_comp,16,55.303000
randomdigit,dragonbox_comp,17,58.040000
randomdigit,erthink,1,42.982000
randomdigit,erthink,2,43.121000
randomdigit,erthink,3,46.212000
randomdigit,erthink,4,47.114000
randomdigit,erthink,5,48.641000
randomdigit,erthink,6,51.619000
randomdigit,erthink,7,57.529000
randomdigit,erthink,8,65.666000
randomdigit,erthink,9,80.738000
randomdigit,erthink,10,81.655000
randomdigit,erthink,11,61.409000
randomdigit,erthink,12,61.480000
randomdigit,erthink,13,65.406000
randomdigit,erthink,14,68.248000
randomdigit,erthink,15,70.564000
randomdigit,erthink,16,73.354000
randomdigit,erthink,17,73.697000
randomdigit,erthink_shodan,1,45.509000
randomdigit,erthink_shodan,2,46.412000
randomdigit,erthink_shodan,3,48.792000
randomdigit,erthink_shodan,4,48.719000
randomdigit,erthink_shodan,5,48.987000
randomdigit,erthink_shodan,6,51.368000
randomdigit,erthink_shodan,7,54.927000
randomdigit,erthink_shodan,8,57.708000
randomdigit,erthink_shodan,9,58.244000
randomdigit,erthink_shodan,10,58.831000
randomdigit,erthink_shodan,11,60.404000
randomdigit,erthink_shodan,12,62.891000
randomdigit,erthink_shodan,13,64.672000
randomdigit,erthink_shodan,14,66.183000
randomdigit,erthink_shodan,15,67.595000
randomdigit,erthink_shodan,16,72.928000
randomdigit,erthink_shodan,17,74.716000
randomdigit,fmt_dragonbox,1,77.503000
randomdigit,fmt_dragonbox,2,80.549000
randomdigit,fmt_dragonbox,3,80.251000
randomdigit,fmt_dragonbox,4,82.101000
randomdigit,fmt_dragonbox,5,82.762000
randomdigit,fmt_dragonbox,6,81.721000
randomdigit,fmt_dragonbox,7,82.563000
randomdigit,fmt_dragonbox,8,82.043000
randomdigit,fmt_dragonbox,9,84.802000
randomdigit,fmt_dragonbox,10,87.501000
randomdigit,fmt_dragonbox,11,86.089000
randomdigit,fmt_dragonbox,12,86.059000
randomdigit,fmt_dragonbox,13,83.921000
randomdigit,fmt_dragonbox,14,85.520000
randomdigit,fmt_dragonbox,15,87.725000
randomdigit,fmt_dragonbox,16,88.436000
randomdigit,fmt_dragonbox,17,91.291000
randomdigit,fmt_dragonbox_comp,1,100.867000
randomdigit,fmt_dragonbox_comp,2,104.519000
randomdigit,fmt_dragonbox_comp,3,108.819000
randomdigit,fmt_dragonbox_comp,4,111.695000
randomdigit,fmt_dragonbox_comp,5,118.286000
randomdigit,fmt_dragonbox_comp,6,124.944000
randomdigit,fmt_dragonbox_comp,7,129.211000
randomdigit,fmt_dragonbox_comp,8,124.276000
randomdigit,fmt_dragonbox_comp,9,133.734000
randomdigit,fmt_dragonbox_comp,10,138.044000
randomdigit,fmt_dragonbox_comp,11,128.719000
randomdigit,fmt_dragonbox_comp,12,126.453000
randomdigit,fmt_dragonbox_comp,13,134.745000
randomdigit,fmt_dragonbox_comp,14,138.483000
randomdigit,fmt_dragonbox_comp,15,138.571000
randomdigit,fmt_dragonbox_comp,16,141.887000
randomdigit,fmt_dragonbox_comp,17,153.168000
</textarea>
</div>
<div class="row" id="downloadDD" style="display: none">
<div class="btn-group pull-right" >
    <button class="btn dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-picture"></span></button>
    <ul class="dropdown-menu">
        <li><a tabindex="-1" href="#" dltype="image/jpeg">JPEG</a></li>
        <li><a tabindex="-1" href="#" dltype="image/png">PNG</a></li>
        <li><a tabindex="-1" href="#" dltype="application/pdf">PDF</a></li>
        <li><a tabindex="-1" href="#" dltype="image/svg+xml">SVG</a></li>
    </ul>
</div>
</div>
<form method="post" action="http://export.highcharts.com/" id="imageGetForm">
    <input type="hidden" name="filename" id="imageFilename" value="" />
    <input type="hidden" name="type" id="imageGetFormTYPE" value="" />
    <input type="hidden" name="width" value="900" />
    <input type="hidden" name="svg" value="" id="imageGetFormSVG" />
</form>
</div>
</body>
</html>