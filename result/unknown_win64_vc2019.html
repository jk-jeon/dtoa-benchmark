<html>
<head>
<script src="http://code.jquery.com/jquery-1.8.2.js"></script>
<script src="http://www.google.com/jsapi?autoload={%22modules%22:[{%22name%22:%22visualization%22,%22version%22:%221%22,%22packages%22:[%22controls%22,%22charteditor%22]}]}"></script>
<script src="jquery.csv.js"></script>
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script>
$(function() {
	google.load("visualization", "1", {packages:["corechart"]});
  google.setOnLoadCallback(function() {

    var csv = $('#textInput').val();
    var data = $.csv.toArrays(csv, {
        onParseValue: $.csv.hooks.castToScalar
    });

    // Convert data for bar chart (summing all digits)
    var timeData = {};	// type -> table
    var funcRowMap;
    var maxDigit = 0;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
      var digit = data[i][2];
   		var time = data[i][3];
   		if (timeData[type] == null) {
   			timeData[type] = [["Function", "Time (ns)"/*, { role: "style" }*/]];
        if (digit != 0)
   			  funcRowMap = {};
   		}

   		var table = timeData[type];
   		
      if (digit != 0) {
     		if (funcRowMap[func] == null)
     			funcRowMap[func] = table.push([func, 0]) - 1;
     		
     		table[funcRowMap[func]][1] += time;
      }
      else 
        table.push([func, time]);

      maxDigit = Math.max(maxDigit, digit);
    }

    // Compute average
    for (var type in timeData) {
      var table = timeData[type];
      for (var i = 1; i < table.length; i++)
        table[i][1] /= maxDigit;
    }

    // Convert data for drawing line chart per random digit
    var timeDigitData = {}; // type -> table
    var funcColumnMap;

    for (var i = 1; i < data.length; i++) {
    	var type = data[i][0];
   		var func = data[i][1];
		  var digit = data[i][2];
   		var time = data[i][3];

      if (digit == 0)
        continue;

   		if (timeDigitData[type] == null) {
   			timeDigitData[type] = [["Digit"]];
   			funcColumnMap = {};
   		}

   		var table = timeDigitData[type];

   		if (funcColumnMap[func] == null)
   			funcColumnMap[func] = table[0].push(func) - 1;

   		var row;
   		for (row = 1; row < table.length; row++)
   			if (table[row][0] == digit)
   				break;

    	if (row == table.length)
    		table.push([digit]);

		table[row][funcColumnMap[func]] = time;
	}

	for (var type in timeData) {
		$("#main").append(
      $("<a>", {name: type}),
      $("<h2>", {style: "padding-top: 70px; margin-top: -70px;"}).append(type)
    );

    $("#section").append($("<li>").append($("<a>", {href: "#" + type}).append(type)));

		drawTable(type, timeData[type]);
		drawBarChart(type, timeData[type]);
    if (timeDigitData[type] != null)
		  drawDigitChart(type, timeDigitData[type]);
	}

	$(".chart").each(function() {
		var chart = $(this);
		var d = $("#downloadDD").clone().css("display", "");
		$('li a', d).each(function() {
	        $(this).click(function() {
	            var svg = chart[0].getElementsByTagName('svg')[0].parentNode.innerHTML;
	            svg=sanitize(svg);
	            $('#imageFilename').val($("#title").html() + "_" + chart.data("filename"));
	            $('#imageGetFormTYPE').val($(this).attr('dltype'));
	            $('#imageGetFormSVG').val(svg);
	            $('#imageGetForm').submit();
	        });
	    });		
		$(this).after(d);
	});

  // Add configurations
  var thisConfig = "unknown_win64_vc2019";
  var configurations = ["corei7920@2.67_cygwin32_gcc4.8","corei7920@2.67_cygwin64_gcc4.8","corei7920@2.67_win32_vc2013","corei7920@2.67_win64_vc2013","unknown_mac32_clang7.0","unknown_mac64_clang7.0","unknown_win64_vc2019"];

  for (var i in configurations) {
    var c = configurations[i];
    $("#configuration").append($("<li>", {class : (c == thisConfig ? "active" : "")}).append($("<a>", {href: c + ".html"}).append(c)));
  }
  })
});

function drawTable(type, timeData) {
	var data = google.visualization.arrayToDataTable(timeData);
    data.addColumn('number', 'Speedup');
    data.sort([{ column: 1, desc: true }]);
    var formatter1 = new google.visualization.NumberFormat({ fractionDigits: 3 });
    formatter1.format(data, 1);

	var div = document.createElement("div");
	div.className = "tablechart";
	$("#main").append(div);
    var table = new google.visualization.Table(div);
    redrawTable(0);
    table.setSelection([{ row: 0, column: null}]);

    function redrawTable(selectedRow) {
        // Compute relative time using the first row as basis
        var basis = data.getValue(selectedRow, 1);
        for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
            data.setValue(rowIndex, 2, basis / data.getValue(rowIndex, 1));

        var formatter = new google.visualization.NumberFormat({suffix: 'x'});
        formatter.format(data, 2); // Apply formatter to second column

        table.draw(data);
    }

    google.visualization.events.addListener(table, 'select',
    function() {
        var selection = table.getSelection();
        if (selection.length > 0) {
            var item = selection[0];
            if (item.row != null)
                redrawTable(item.row);
        }
    });

}

function drawBarChart(type, timeData) {
    var defaultColors = ["#3366cc","#dc3912","#ff9900","#109618","#990099","#0099c6","#dd4477","#66aa00","#b82e2e","#316395","#994499","#22aa99","#aaaa11","#6633cc","#e67300","#8b0707","#651067","#329262","#5574a6","#3b3eac","#b77322","#16d620","#b91383","#f4359e","#9c5935","#a9c413","#2a778d","#668d1c","#bea413","#0c5922","#743411"];

	var data = google.visualization.arrayToDataTable(timeData);
	data.addColumn({ type: "string", role: "style" })
	for (var rowIndex = 0; rowIndex < data.getNumberOfRows(); rowIndex++)
		data.setValue(rowIndex, 2, defaultColors[rowIndex]);

    data.sort([{ column: 1, desc: true }]);
	var options = { 
		title: type,
		chartArea: {'width': '70%', 'height': '70%'},
		width: 800,
		height: 300,
		legend: { position: "none" },
		hAxis: { title: "Time (ns)" }
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_time");
	$("#main").append(div);
	var chart = new google.visualization.BarChart(div);

	chart.draw(data, options);
}

function drawDigitChart(type, timeDigitData) {
	var data = google.visualization.arrayToDataTable(timeDigitData);

	var options = { 
		title: type,
		chartArea: {'width': '70%', 'height': '80%'},
		hAxis: {
			title: "Digit",
			gridlines: { count: timeDigitData.length - 1 },
			maxAlternation: 1,
			minTextSpacing: 0
		},
		vAxis: {
			title: "Time (ns) in log scale",
			logScale: true,
			minorGridlines: { count: 10 },
      baseline: 0
		},
		width: 800,
		height: 600
	};
	var div = document.createElement("div");
	div.className = "chart";
	$(div).data("filename", type + "_timedigit");
	$("#main").append(div);
	var chart = new google.visualization.LineChart(div);

	chart.draw(data, options);
}

// http://jsfiddle.net/P6XXM/
function sanitize(svg) {
    svg = svg
        .replace(/\<svg/,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1"')
        .replace(/zIndex="[^"]+"/g, '')
        .replace(/isShadow="[^"]+"/g, '')
        .replace(/symbolName="[^"]+"/g, '')
        .replace(/jQuery[0-9]+="[^"]+"/g, '')
        .replace(/isTracker="[^"]+"/g, '')
        .replace(/url\([^#]+#/g, 'url(#')
        .replace('<svg xmlns:xlink="http://www.w3.org/1999/xlink" ', '<svg ')
        .replace(/ href=/g, ' xlink:href=')
    /*.replace(/preserveAspectRatio="none">/g, 'preserveAspectRatio="none"/>')*/
    /* This fails in IE < 8
    .replace(/([0-9]+)\.([0-9]+)/g, function(s1, s2, s3) { // round off to save weight
    return s2 +'.'+ s3[0];
    })*/

    // IE specific
        .replace(/id=([^" >]+)/g, 'id="$1"')
        .replace(/class=([^" ]+)/g, 'class="$1"')
        .replace(/ transform /g, ' ')
        .replace(/:(path|rect)/g, '$1')
        .replace(/<img ([^>]*)>/gi, '<image $1 />')
        .replace(/<\/image>/g, '') // remove closing tags for images as they'll never have any content
        .replace(/<image ([^>]*)([^\/])>/gi, '<image $1$2 />') // closes image tags for firefox
        .replace(/width=(\d+)/g, 'width="$1"')
        .replace(/height=(\d+)/g, 'height="$1"')
        .replace(/hc-svg-href="/g, 'xlink:href="')
        .replace(/style="([^"]+)"/g, function (s) {
            return s.toLowerCase();
        });

    // IE9 beta bugs with innerHTML. Test again with final IE9.
    svg = svg.replace(/(url\(#highcharts-[0-9]+)&quot;/g, '$1')
        .replace(/&quot;/g, "'");
    if (svg.match(/ xmlns="/g).length == 2) {
        svg = svg.replace(/xmlns="[^"]+"/, '');
    }

    return svg;
}
</script>
<style type="text/css">
@media (min-width: 800px) {
  .container {
    max-width: 800px;
  }
}
textarea {
	font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace;
}
.tablechart {
	width: 700px;
	margin: auto;
	padding-top: 20px;
	padding-bottom: 20px;
}
.chart {
	padding-top: 20px;
	padding-bottom: 20px;
}
body { padding-top: 70px; }
</style>
</head>
<body>
<div class="container">
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://github.com/miloyip/dtoa-benchmark"><span class="glyphicon glyphicon-home"></span> dtoa-benchmark</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Configuration <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="configuration">
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Section <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu" id="section">
          </ul>
        </li>
      </ul>
      <p class="navbar-text navbar-right">Developed by <a href="https://github.com/miloyip" class="navbar-link">Milo Yip</a></p>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
<div class="page-header">
<h1 id="title">unknown_win64_vc2019</h1>
</div>
<div id="main"></div>
<h2>Source CSV</h2>
<textarea id="textInput" class="form-control" rows="5" readonly>
  Type,Function,Digit,Time(ns)
randomdigit,doubleconv,1,95.942000
randomdigit,doubleconv,2,106.075000
randomdigit,doubleconv,3,111.707000
randomdigit,doubleconv,4,122.866000
randomdigit,doubleconv,5,120.709000
randomdigit,doubleconv,6,125.623000
randomdigit,doubleconv,7,136.651000
randomdigit,doubleconv,8,132.177000
randomdigit,doubleconv,9,131.998000
randomdigit,doubleconv,10,136.483000
randomdigit,doubleconv,11,141.858000
randomdigit,doubleconv,12,143.851000
randomdigit,doubleconv,13,146.132000
randomdigit,doubleconv,14,154.257000
randomdigit,doubleconv,15,155.215000
randomdigit,doubleconv,16,167.123000
randomdigit,doubleconv,17,172.762000
randomdigit,emyg,1,73.318000
randomdigit,emyg,2,79.590000
randomdigit,emyg,3,84.076000
randomdigit,emyg,4,86.874000
randomdigit,emyg,5,90.642000
randomdigit,emyg,6,92.330000
randomdigit,emyg,7,95.936000
randomdigit,emyg,8,94.434000
randomdigit,emyg,9,96.126000
randomdigit,emyg,10,98.309000
randomdigit,emyg,11,104.140000
randomdigit,emyg,12,105.624000
randomdigit,emyg,13,109.246000
randomdigit,emyg,14,111.890000
randomdigit,emyg,15,114.032000
randomdigit,emyg,16,116.387000
randomdigit,emyg,17,121.405000
randomdigit,floaxie,1,48.604000
randomdigit,floaxie,2,57.917000
randomdigit,floaxie,3,65.249000
randomdigit,floaxie,4,72.400000
randomdigit,floaxie,5,79.126000
randomdigit,floaxie,6,88.529000
randomdigit,floaxie,7,94.331000
randomdigit,floaxie,8,102.529000
randomdigit,floaxie,9,109.797000
randomdigit,floaxie,10,113.630000
randomdigit,floaxie,11,118.827000
randomdigit,floaxie,12,117.987000
randomdigit,floaxie,13,116.390000
randomdigit,floaxie,14,120.662000
randomdigit,floaxie,15,121.344000
randomdigit,floaxie,16,122.130000
randomdigit,floaxie,17,125.373000
randomdigit,fmt,1,100.500000
randomdigit,fmt,2,102.429000
randomdigit,fmt,3,106.891000
randomdigit,fmt,4,113.755000
randomdigit,fmt,5,117.189000
randomdigit,fmt,6,118.499000
randomdigit,fmt,7,123.629000
randomdigit,fmt,8,127.551000
randomdigit,fmt,9,127.678000
randomdigit,fmt,10,130.742000
randomdigit,fmt,11,133.255000
randomdigit,fmt,12,137.975000
randomdigit,fmt,13,136.653000
randomdigit,fmt,14,141.059000
randomdigit,fmt,15,141.809000
randomdigit,fmt,16,145.779000
randomdigit,fmt,17,152.410000
randomdigit,grisu2,1,124.589000
randomdigit,grisu2,2,130.898000
randomdigit,grisu2,3,126.056000
randomdigit,grisu2,4,127.608000
randomdigit,grisu2,5,130.916000
randomdigit,grisu2,6,131.815000
randomdigit,grisu2,7,133.238000
randomdigit,grisu2,8,137.183000
randomdigit,grisu2,9,140.081000
randomdigit,grisu2,10,142.711000
randomdigit,grisu2,11,144.915000
randomdigit,grisu2,12,149.648000
randomdigit,grisu2,13,150.700000
randomdigit,grisu2,14,153.155000
randomdigit,grisu2,15,153.900000
randomdigit,grisu2,16,159.080000
randomdigit,grisu2,17,162.934000
randomdigit,milo,1,61.394000
randomdigit,milo,2,67.865000
randomdigit,milo,3,71.018000
randomdigit,milo,4,74.171000
randomdigit,milo,5,76.821000
randomdigit,milo,6,80.382000
randomdigit,milo,7,84.026000
randomdigit,milo,8,86.648000
randomdigit,milo,9,89.843000
randomdigit,milo,10,91.855000
randomdigit,milo,11,95.464000
randomdigit,milo,12,98.828000
randomdigit,milo,13,102.263000
randomdigit,milo,14,104.347000
randomdigit,milo,15,107.021000
randomdigit,milo,16,110.099000
randomdigit,milo,17,115.192000
randomdigit,ryu,1,78.444000
randomdigit,ryu,2,80.485000
randomdigit,ryu,3,76.594000
randomdigit,ryu,4,76.289000
randomdigit,ryu,5,75.047000
randomdigit,ryu,6,71.462000
randomdigit,ryu,7,68.087000
randomdigit,ryu,8,67.525000
randomdigit,ryu,9,64.390000
randomdigit,ryu,10,64.898000
randomdigit,ryu,11,61.926000
randomdigit,ryu,12,60.999000
randomdigit,ryu,13,58.722000
randomdigit,ryu,14,56.619000
randomdigit,ryu,15,54.904000
randomdigit,ryu,16,53.615000
randomdigit,ryu,17,54.741000
randomdigit,dragonbox,1,44.596000
randomdigit,dragonbox,2,44.274000
randomdigit,dragonbox,3,43.828000
randomdigit,dragonbox,4,44.701000
randomdigit,dragonbox,5,41.892000
randomdigit,dragonbox,6,42.014000
randomdigit,dragonbox,7,40.899000
randomdigit,dragonbox,8,41.662000
randomdigit,dragonbox,9,45.431000
randomdigit,dragonbox,10,46.594000
randomdigit,dragonbox,11,44.559000
randomdigit,dragonbox,12,44.592000
randomdigit,dragonbox,13,44.413000
randomdigit,dragonbox,14,47.408000
randomdigit,dragonbox,15,45.922000
randomdigit,dragonbox,16,43.997000
randomdigit,dragonbox,17,47.218000
randomdigit,dragonbox_comp,1,58.310000
randomdigit,dragonbox_comp,2,60.158000
randomdigit,dragonbox_comp,3,58.948000
randomdigit,dragonbox_comp,4,57.282000
randomdigit,dragonbox_comp,5,55.748000
randomdigit,dragonbox_comp,6,54.659000
randomdigit,dragonbox_comp,7,54.264000
randomdigit,dragonbox_comp,8,55.454000
randomdigit,dragonbox_comp,9,58.566000
randomdigit,dragonbox_comp,10,60.696000
randomdigit,dragonbox_comp,11,58.926000
randomdigit,dragonbox_comp,12,58.943000
randomdigit,dragonbox_comp,13,56.821000
randomdigit,dragonbox_comp,14,56.679000
randomdigit,dragonbox_comp,15,57.425000
randomdigit,dragonbox_comp,16,56.900000
randomdigit,dragonbox_comp,17,59.136000
randomdigit,fmt_dragonbox,1,78.117000
randomdigit,fmt_dragonbox,2,81.167000
randomdigit,fmt_dragonbox,3,79.960000
randomdigit,fmt_dragonbox,4,79.438000
randomdigit,fmt_dragonbox,5,80.560000
randomdigit,fmt_dragonbox,6,78.588000
randomdigit,fmt_dragonbox,7,79.830000
randomdigit,fmt_dragonbox,8,81.524000
randomdigit,fmt_dragonbox,9,85.662000
randomdigit,fmt_dragonbox,10,85.937000
randomdigit,fmt_dragonbox,11,87.046000
randomdigit,fmt_dragonbox,12,86.004000
randomdigit,fmt_dragonbox,13,86.061000
randomdigit,fmt_dragonbox,14,86.156000
randomdigit,fmt_dragonbox,15,86.800000
randomdigit,fmt_dragonbox,16,86.231000
randomdigit,fmt_dragonbox,17,88.231000
randomdigit,fmt_dragonbox_comp,1,91.623000
randomdigit,fmt_dragonbox_comp,2,93.971000
randomdigit,fmt_dragonbox_comp,3,93.292000
randomdigit,fmt_dragonbox_comp,4,93.486000
randomdigit,fmt_dragonbox_comp,5,95.423000
randomdigit,fmt_dragonbox_comp,6,94.582000
randomdigit,fmt_dragonbox_comp,7,94.814000
randomdigit,fmt_dragonbox_comp,8,93.674000
randomdigit,fmt_dragonbox_comp,9,98.466000
randomdigit,fmt_dragonbox_comp,10,98.108000
randomdigit,fmt_dragonbox_comp,11,98.257000
randomdigit,fmt_dragonbox_comp,12,98.196000
randomdigit,fmt_dragonbox_comp,13,99.353000
randomdigit,fmt_dragonbox_comp,14,98.841000
randomdigit,fmt_dragonbox_comp,15,99.199000
randomdigit,fmt_dragonbox_comp,16,97.994000
randomdigit,fmt_dragonbox_comp,17,97.509000
</textarea>
</div>
<div class="row" id="downloadDD" style="display: none">
<div class="btn-group pull-right" >
    <button class="btn dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-picture"></span></button>
    <ul class="dropdown-menu">
        <li><a tabindex="-1" href="#" dltype="image/jpeg">JPEG</a></li>
        <li><a tabindex="-1" href="#" dltype="image/png">PNG</a></li>
        <li><a tabindex="-1" href="#" dltype="application/pdf">PDF</a></li>
        <li><a tabindex="-1" href="#" dltype="image/svg+xml">SVG</a></li>
    </ul>
</div>
</div>
<form method="post" action="http://export.highcharts.com/" id="imageGetForm">
    <input type="hidden" name="filename" id="imageFilename" value="" />
    <input type="hidden" name="type" id="imageGetFormTYPE" value="" />
    <input type="hidden" name="width" value="900" />
    <input type="hidden" name="svg" value="" id="imageGetFormSVG" />
</form>
</div>
</body>
</html>